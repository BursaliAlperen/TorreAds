<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TorreAds</title>

  <!-- GigaPub Ad Script -->
  <script src="https://ad.gigapub.tech/script?id=986"></script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#0a84ff;--muted:#666}
    *{box-sizing:border-box}
    body{font-family:"Nunito",sans-serif;margin:0;background:var(--bg);color:#111}
    #app{max-width:520px;margin:0 auto;padding-bottom:100px}
    header{display:flex;align-items:center;padding:18px;border-bottom:1px solid #e6eaf0;background:var(--card)}
    #user-photo{width:56px;height:56px;border-radius:50%;object-fit:cover;margin-right:12px;border:2px solid var(--accent)}
    h1{font-size:1.1rem;margin:0}
    p.sub{margin:4px 0 0;color:var(--muted);font-weight:600}
    main{padding:16px}
    .grid{display:grid;gap:12px}
    .card{background:var(--card);padding:14px;border-radius:12px;border:1px solid #e6eaf0}
    .stat{display:flex;justify-content:space-between;align-items:center}
    .big{font-size:1.35rem;font-weight:700;color:var(--accent)}
    #referral-link{flex:1;padding:10px;border-radius:8px;border:1px dashed #cfd8e3;background:#fafbff;font-size:0.9rem}
    button.btn{padding:12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .task{display:flex;flex-direction:column;gap:10px}
    .bottom-nav{position:fixed;left:0;right:0;bottom:0;background:var(--card);max-width:520px;margin:0 auto;display:flex;justify-content:space-around;padding:10px;border-top:1px solid #e6eaf0;z-index:9999}
    .nav-btn{background:transparent;border:0;display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--muted);cursor:pointer}
    .nav-btn.active{color:var(--accent);font-weight:700}
    form .form-group{margin-bottom:12px}
    label{display:block;font-weight:700;margin-bottom:6px}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eaf0;background:#fff}
    .note{font-size:0.9rem;color:#333;background:#fff;padding:10px;border-radius:8px;border:1px solid #f0f0f0}
    .loader{width:18px;height:18px;border:3px solid rgba(255,255,255,0.4);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div id="app" class="card">
    <header>
      <img id="user-photo" src="https://i.imgur.com/placeholder.png" alt="user">
      <div>
        <h1 id="user-name">Guest User <i class="fas fa-check-circle" style="color:var(--accent);margin-left:6px"></i></h1>
        <p class="sub"> Balance: $<span id="user-balance">0.00</span></p>
      </div>
    </header>

    <main id="main-content">
      <!-- Home -->
      <section id="home-page" class="page">
        <h2>Dashboard</h2>
        <div class="grid">
          <div class="card stat">
            <div>
              <div class="big" id="daily-ads-watched">0</div>
              <div style="font-size:0.9rem;color:var(--muted)">Daily Ads</div>
            </div>
            <div>
              <div class="big" id="referral-count">0</div>
              <div style="font-size:0.9rem;color:var(--muted)">Referrals</div>
            </div>
          </div>

          <div class="card">
            <div style="display:flex;gap:8px;align-items:center">
              <input id="referral-link" readonly value="">
              <button id="copy-ref-link-btn" class="btn">Copy</button>
            </div>
            <p style="font-size:0.9rem;margin-top:6px">Earn $0.02 per referral.</p>
          </div>
        </div>
      </section>

      <!-- Tasks -->
      <section id="tasks-page" class="page" style="display:none">
        <h2>Tasks</h2>
        <div class="card task">
          <div><strong>Watch Ad</strong> â€“ earn $0.25</div>
          <button id="watch-ad-btn" class="btn">Watch Ad</button>
        </div>
        <div class="card task">
          <div><strong>Join Channel / Group</strong></div>
          <a href="https://t.me/Torrelabs" target="_blank" class="btn">Channel</a>
          <a href="https://t.me/torreAdsChat" target="_blank" class="btn">Group</a>
        </div>
      </section>

      <!-- Withdraw -->
      <section id="withdraw-page" class="page" style="display:none">
        <h2>Withdraw (TON)</h2>
        <form id="withdraw-form" class="card">
          <div class="form-group">
            <label for="withdraw-amount">Amount ($)</label>
            <input type="number" id="withdraw-amount" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="ton-address">TON Address</label>
            <input type="text" id="ton-address" required>
          </div>
          <div class="note" id="ton-warning">Fetching current TON price...</div>
          <button id="withdraw-submit-btn" class="btn" type="submit">Send Request</button>
        </form>
      </section>
    </main>

    <nav class="bottom-nav">
      <button class="nav-btn active" data-page="home-page"><i class="fas fa-home"></i>Home</button>
      <button class="nav-btn" data-page="tasks-page"><i class="fas fa-play"></i>Tasks</button>
      <button class="nav-btn" data-page="withdraw-page"><i class="fas fa-wallet"></i>Withdraw</button>
    </nav>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
  (function(){
    const XOR_KEY = 23;
    const BIN_ID_ARR = [33,47,115,118,32,33,113,118,115,39,114,118,47,47,38,113,35,39,47,113,38,37,35,47];
    const API_KEY_ARR = [51,37,118,51,38,39,51,92,83,57,32,102,109,92,102,98,98,86,33,110,93,117,91,100,85,88,69,69,88,99,96,122,78,116,56,114,47,115,65,111,79,109,116,109,103,126,68,81,97,110,103,111,94,66,46,121,118,126,46,80];
    function decode(arr){return arr.map(n=>String.fromCharCode(n^XOR_KEY)).join('');}
    const BIN_ID=decode(BIN_ID_ARR), API_KEY=decode(API_KEY_ARR);
    const PIPEDREAM="https://eo3h4zf914hhqv7.m.pipedream.net";
    const REF_REWARD=0.02,AD_REWARD=0.25,MIN_WD=0.02;
    const PRICE_URL="https://api.coingecko.com/api/v3/simple/price?ids=toncoin&vs_currencies=usd";

    let userState={balance_usd:0,referrals:[],dailyAds:0,userId:null};

    const tg=(window.Telegram&&window.Telegram.WebApp)?window.Telegram.WebApp:{initDataUnsafe:{},ready:()=>{},HapticFeedback:{notificationOccurred:()=>{}}};

    function updateUI(){
      document.getElementById('user-balance').textContent=(+userState.balance_usd).toFixed(2);
      document.getElementById('referral-count').textContent=(userState.referrals||[]).length;
      document.getElementById('referral-link').value=`${location.origin}${location.pathname}?start=ref_${userState.userId}`;
    }

    async function init(){
      const user=tg.initDataUnsafe.user;
      if(user&&user.id){
        userState.userId=user.id;
        document.getElementById('user-name').innerText=`${user.first_name||''} ${user.last_name||''}`;
        if(user.photo_url)document.getElementById('user-photo').src=user.photo_url;
      }else{
        userState.userId='guest_'+(localStorage.getItem('guest_id')||(function(){const id='g'+Date.now();localStorage.setItem('guest_id',id);return id})());
        document.getElementById('user-name').innerText="Guest User";
        document.getElementById('user-photo').src="https://i.imgur.com/placeholder.png";
      }
      updateUI();
    }

    // nav
    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.page').forEach(p=>p.style.display='none');
        document.getElementById(btn.dataset.page).style.display='block';
      });
    });

    // copy ref
    document.getElementById('copy-ref-link-btn').onclick=()=>{navigator.clipboard.writeText(document.getElementById('referral-link').value);alert('Referral link copied');};

    init();
  })();
  </script>
</body>
</html>
