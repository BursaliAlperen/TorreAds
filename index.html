<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TorreAds</title>
    
    <!-- GigaPub SDK -->
    <script src="https://ad.gigapub.tech/script?id=986"></script>

    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* CSS Code - Beyaz Mavi Tema */
        :root {
            --tg-theme-bg-color: #f5f9ff; --tg-theme-text-color: #1a365d; --tg-theme-button-color: #2c7be5;
            --tg-theme-button-text-color: #ffffff; --tg-theme-hint-color: #5a7ba7; --success-color: #00d97e;
            --warning-color: #f6c343; --danger-color: #e63757; --secondary-bg-color: #ffffff; --border-color: #d1e3ff;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0;
            padding: 20px 15px 90px 15px; background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
            display: flex; flex-direction: column; align-items: center; text-align: center; min-height: 100vh; box-sizing: border-box;
        }
        .container { width: 100%; max-width: 500px; }
        .view { display: none; width: 100%; animation: fadeIn 0.3s ease-in-out; }
        #home-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { margin-bottom: 25px; }
        .header h1 { font-size: 32px; font-weight: 700; margin-bottom: 5px; color: #1a365d; }
        .header p { color: var(--tg-theme-hint-color); font-size: 16px; }
        .card {
            background-color: var(--secondary-bg-color); padding: 25px; border-radius: 16px; margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0, 123, 255, 0.1); border: 1px solid var(--border-color);
        }
        .card h2 {
            margin: 0 0 12px 0; font-size: 16px; color: var(--tg-theme-hint-color); font-weight: 500;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .balance-amount { font-size: 42px; font-weight: 700; color: #1a365d; margin-bottom: 10px; }
        .ad-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; }
        .ad-info-item h3 { font-size: 20px; font-weight: 600; margin: 0 0 5px 0; color: #1a365d; }
        .ad-info-item p { font-size: 14px; color: var(--tg-theme-hint-color); margin: 0; }
        .ad-buttons { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        .btn {
            width: 100%; padding: 16px; font-size: 18px; font-weight: 600; border: none; border-radius: 12px; cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9); color: var(--tg-theme-button-text-color);
            box-shadow: 0 4px 10px rgba(44, 123, 229, 0.2);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(44, 123, 229, 0.3); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #c5d9ff; color: #8ba7d0; cursor: not-allowed; box-shadow: none; transform: none; }
        #mainWithdrawBtn { background: linear-gradient(145deg, var(--success-color), #00b86c); box-shadow: 0 4px 10px rgba(0, 217, 126, 0.2); }
        #mainWithdrawBtn:disabled { background: #c5d9ff; box-shadow: none; }
        .status-message {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 480px;
            padding: 12px 15px; border-radius: 10px; font-weight: 500; display: none; animation: fadeIn 0.3s;
            z-index: 1000; box-sizing: border-box;
        }
        .success { display: block; background-color: rgba(0, 217, 126, 0.15); border-left: 5px solid var(--success-color); color: #008a50; }
        .error { display: block; background-color: rgba(230, 55, 87, 0.15); border-left: 5px solid var(--danger-color); color: #c41a3a; }
        .info { display: block; background-color: rgba(44, 123, 229, 0.15); border-left: 5px solid var(--tg-theme-button-color); color: #1a6fd9; }
        .footer-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--secondary-bg-color); display: flex;
            justify-content: space-around; padding: 10px 0; box-shadow: 0 -4px 12px rgba(0, 123, 255, 0.1);
            border-top: 1px solid var(--border-color); z-index: 999;
        }
        .nav-btn {
            background: none; border: none; color: var(--tg-theme-hint-color); display: flex; flex-direction: column;
            align-items: center; font-size: 12px; font-weight: 500; cursor: pointer; padding: 5px 15px;
            border-radius: 12px; transition: color 0.2s, background-color 0.2s;
        }
        .nav-btn.active { color: var(--tg-theme-button-color); }
        .nav-btn:hover:not(.active) { color: #1a365d; }
        .nav-btn .icon { width: 28px; height: 28px; margin-bottom: 4px; }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--tg-theme-hint-color); font-size: 14px; font-weight: 500; }
        .input-group input, .input-group textarea {
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--border-color);
            background-color: #f5f9ff; color: var(--tg-theme-text-color); font-size: 16px; box-sizing: border-box;
        }
        .input-group input:focus, .input-group textarea:focus { outline: none; border-color: var(--tg-theme-button-color); box-shadow: 0 0 0 3px rgba(44, 123, 229, 0.2); }
        #referralLink {
            background-color: #f0f7ff; padding: 15px; border-radius: 10px; word-wrap: break-word;
            border: 1px dashed var(--tg-theme-hint-color); margin-top: 15px; cursor: pointer; color: #1a365d;
            transition: background-color 0.2s; text-align: left;
        }
        #referralLink:hover { background-color: #e1efff; }
        .admin-panel {
            display: none; margin-top: 30px; padding: 15px; border: 1px solid var(--warning-color);
            border-radius: 10px; background-color: rgba(246, 195, 67, 0.1);
        }
        .admin-panel h3 { color: var(--warning-color); margin-top: 0; }
        
        /* Yeni referans giriÅŸ kutusu stilleri */
        .referral-input-container {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-bg-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .referral-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .referral-input-group input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: #f5f9ff;
            color: var(--tg-theme-text-color);
        }
        
        .referral-input-group button {
            padding: 12px 20px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Loading indicator */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* USDT Price Chart Styles */
        .price-chart {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }
        
        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: bold;
        }
        
        .price-change {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .price-change.positive {
            background-color: rgba(0, 217, 126, 0.15);
            color: var(--success-color);
        }
        
        .price-change.negative {
            background-color: rgba(230, 55, 87, 0.15);
            color: var(--danger-color);
        }
        
        .chart-placeholder {
            height: 60px;
            background: linear-gradient(90deg, #e1efff 0%, #d1e3ff 50%, #e1efff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }

        /* Referans kod kutusu */
        .referral-code-box {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--tg-theme-hint-color);
            margin-top: 15px;
            cursor: pointer;
            color: #1a365d;
            transition: background-color 0.2s;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
        }
        
        .referral-code-box:hover {
            background-color: #e1efff;
        }
        
        /* Admin View Styles */
        #admin-view { display: none; }
        
        .admin-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .admin-stat-card {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .admin-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }
        
        .admin-stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            text-transform: uppercase;
        }
        
        .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .admin-control-btn {
            padding: 12px;
            background: linear-gradient(145deg, var(--warning-color), #e6b400);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .admin-control-btn.danger {
            background: linear-gradient(145deg, var(--danger-color), #c41a3a);
        }
        
        .admin-user-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            text-align: left;
        }
        
        .admin-user-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-user-info {
            flex: 1;
        }
        
        .admin-user-id {
            font-weight: bold;
            color: #1a365d;
        }
        
        .admin-user-balance {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .admin-user-actions {
            display: flex;
            gap: 5px;
        }
        
        .admin-action-btn {
            padding: 5px 10px;
            background-color: var(--tg-theme-button-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* Task View Styles */
        #tasks-view { display: none; }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .task-item {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-info {
            flex: 1;
            text-align: left;
        }
        
        .task-title {
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }
        
        .task-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }
        
        .task-reward {
            font-weight: bold;
            color: var(--success-color);
        }
        
        .task-btn {
            padding: 8px 15px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* About View Styles */
        #about-view { display: none; }
        
        .about-content {
            text-align: left;
            line-height: 1.6;
        }
        
        .about-section {
            margin-bottom: 20px;
        }
        
        .about-section h3 {
            color: #1a365d;
            margin-bottom: 10px;
        }
        
        .about-section p {
            color: var(--tg-theme-hint-color);
            margin-bottom: 10px;
        }
        
        .roadmap-item {
            margin-bottom: 15px;
            padding-left: 15px;
            border-left: 3px solid var(--tg-theme-button-color);
        }
        
        .roadmap-date {
            font-weight: bold;
            color: #1a365d;
        }
        
        .roadmap-content {
            color: var(--tg-theme-hint-color);
        }
        
        /* Withdraw Requests Styles */
        .withdraw-requests-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            text-align: left;
        }
        
        .withdraw-request-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .withdraw-request-info {
            flex: 1;
        }
        
        .withdraw-request-user {
            font-weight: bold;
            color: #1a365d;
        }
        
        .withdraw-request-details {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .withdraw-request-actions {
            display: flex;
            gap: 5px;
        }
        
        .withdraw-action-btn {
            padding: 5px 10px;
            background-color: var(--tg-theme-button-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .withdraw-action-btn.approve {
            background-color: var(--success-color);
        }
        
        .withdraw-action-btn.reject {
            background-color: var(--danger-color);
        }
        
        /* Task Creation Styles */
        .task-creation-form {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-bg-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .form-row .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        /* Task Marketplace Styles */
        #task-marketplace-view { display: none; }
        
        .marketplace-task-item {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
            text-align: left;
        }
        
        .marketplace-task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .marketplace-task-title {
            font-weight: bold;
            color: #1a365d;
            font-size: 16px;
        }
        
        .marketplace-task-cost {
            font-weight: bold;
            color: var(--danger-color);
        }
        
        .marketplace-task-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 10px;
        }
        
        .marketplace-task-details {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 10px;
        }
        
        .marketplace-task-timer {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .marketplace-task-actions {
            display: flex;
            gap: 10px;
        }
        
        .marketplace-task-btn {
            flex: 1;
            padding: 8px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .marketplace-task-btn:disabled {
            background: #c5d9ff;
            color: #8ba7d0;
            cursor: not-allowed;
        }
        
        /* Task Creation View */
        #task-creation-view { display: none; }
        
        /* Referral Link Styles */
        .referral-link-box {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--tg-theme-hint-color);
            margin-top: 15px;
            cursor: pointer;
            color: #1a365d;
            transition: background-color 0.2s;
            text-align: center;
            font-weight: bold;
            word-break: break-all;
        }
        
        .referral-link-box:hover {
            background-color: #e1efff;
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .referral-stat-item {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .referral-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }
        
        .referral-stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        /* Progress bar for tasks */
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e1efff;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(145deg, var(--success-color), #00b86c);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .task-progress {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            text-align: center;
        }

        /* Percentage selector styles */
        .percentage-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .percentage-btn {
            flex: 1;
            padding: 10px;
            background-color: #f5f9ff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .percentage-btn.active {
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border-color: var(--tg-theme-button-color);
        }
        
        /* Admin advanced panel */
        .admin-advanced-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(246, 195, 67, 0.1);
            border-radius: 10px;
            border: 1px solid var(--warning-color);
        }
        
        .admin-advanced-panel h3 {
            color: var(--warning-color);
            margin-top: 0;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .admin-tab {
            padding: 8px 15px;
            background-color: #f5f9ff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .admin-tab.active {
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border-color: var(--tg-theme-button-color);
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home / Task View -->
        <div id="home-view" class="view">
            <div class="header"><h1>TorreAds</h1><p>Reklam Ä°zle ve USDT Kazan</p></div>
            
            <!-- USDT Price Chart -->
            <div class="price-chart">
                <div class="price-info">
                    <div class="current-price">USDT: $<span id="usdtPrice">1.00</span></div>
                    <div class="price-change" id="priceChange">0.00%</div>
                </div>
                <div class="chart-placeholder" id="chartPlaceholder">
                    CanlÄ± USDT Fiyat GrafiÄŸi
                </div>
            </div>
            
            <div class="card">
                <h2>Mevcut Bakiye</h2>
                <div class="balance-amount" id="balanceDisplay">USDT 0.00</div>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Toplam Ä°zlenen Reklam</p></div>
                    <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0 / 100</h3><p>BugÃ¼nkÃ¼ Reklamlar</p></div>
                </div>
            </div>
            <div class="ad-buttons"><button class="btn" id="rewardedBtn">Reklam Ä°zle (+0.002 USDT)</button></div>
            <button class="btn" id="mainWithdrawBtn" disabled>Ã‡ekim Yapmak Ä°Ã§in 0.50 USDT'ye UlaÅŸ</button>
            
            <!-- Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <h3>ðŸ‘‘ YÃ¶netici Paneli</h3>
                <p id="userInfo"></p>
            </div>
        </div>

        <!-- Withdraw View -->
        <div id="withdraw-view" class="view">
            <div class="header"><h1>Para Ã‡ekme</h1><p>KazancÄ±nÄ±zÄ± talep edin</p></div>
            <div class="card">
                <h2>Bakiyeniz</h2>
                <div class="balance-amount" id="withdrawBalanceDisplay">USDT 0.00</div>
                <p style="color: var(--tg-theme-hint-color); margin-top: 15px;">Minimum Ã§ekim miktarÄ± 0.50 USDT'dir.</p>
            </div>
            <div class="card">
                <h2>Ã–deme DetaylarÄ±</h2>
                <div class="input-group">
                    <label for="paymentAddress">USDT CÃ¼zdan Adresiniz (TRC20)</label>
                    <input type="text" id="paymentAddress" placeholder="Ã¶rn: T... (TRC20 Adresi)">
                </div>
                <button class="btn" id="finalWithdrawBtn" disabled>Para Ã‡ek</button>
            </div>
        </div>
        
        <!-- Referral View -->
        <div id="referral-view" class="view">
            <div class="header"><h1>Referanslar</h1><p>ArkadaÅŸlarÄ±nÄ± davet et ve daha fazla kazan!</p></div>
            
            <div class="card">
                <h2>Referans Ä°statistikleriniz</h2>
                <div class="referral-stats">
                    <div class="referral-stat-item">
                        <div class="referral-stat-value" id="referralCountDisplay">0</div>
                        <div class="referral-stat-label">Toplam Referans</div>
                    </div>
                    <div class="referral-stat-item">
                        <div class="referral-stat-value" id="referralBonusDisplay">USDT 0.00</div>
                        <div class="referral-stat-label">Referans KazancÄ±</div>
                    </div>
                </div>
            </div>
            
            <!-- Manuel Referans GiriÅŸ Kutusu -->
            <div class="card">
                <h2>Referans Kodunu Girin</h2>
                <p>EÄŸer birisi sizi referans ettiyse, bonus almak iÃ§in kodunu buraya girin!</p>
                <div class="referral-input-container">
                    <div class="referral-input-group">
                        <input type="text" id="referralCodeInput" placeholder="Referans kodunu girin">
                        <button id="submitReferralBtn">GÃ¶nder</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Referans Kodunuz</h2>
                <p>Bu kodu arkadaÅŸlarÄ±nÄ±zla paylaÅŸÄ±n. KatÄ±lan her onaylanmÄ±ÅŸ arkadaÅŸ iÃ§in 0.02 USDT kazanÄ±rsÄ±nÄ±z!</p>
                <div class="referral-code-box" id="referralCodeBox" title="Kopyalamak iÃ§in tÄ±klayÄ±n">
                    <span id="userReferralCode">YÃ¼kleniyor...</span>
                </div>
                <p style="font-size:12px; color:var(--tg-theme-hint-color); margin-top:15px;">Kodu kopyalamak iÃ§in Ã¼zerine tÄ±klayÄ±n</p>
            </div>
            
            <div class="card">
                <h2>Referans Linkiniz</h2>
                <p>AÅŸaÄŸÄ±daki linki arkadaÅŸlarÄ±nÄ±zla paylaÅŸarak daha hÄ±zlÄ± kazanÄ±n!</p>
                <div class="referral-link-box" id="referralLinkBox" title="Kopyalamak iÃ§in tÄ±klayÄ±n">
                    <span id="userReferralLink">YÃ¼kleniyor...</span>
                </div>
                <p style="font-size:12px; color:var(--tg-theme-hint-color); margin-top:15px;">Linki kopyalamak iÃ§in Ã¼zerine tÄ±klayÄ±n</p>
            </div>
        </div>
        
        <!-- Tasks View -->
        <div id="tasks-view" class="view">
            <div class="header"><h1>GÃ¶revler</h1><p>Ek gÃ¶revlerle daha fazla kazanÄ±n</p></div>
            
            <div class="card">
                <h2>Mevcut GÃ¶revler</h2>
                <div class="task-list" id="manualTasksList">
                    <!-- Manuel gÃ¶revler buraya eklenecek -->
                </div>
            </div>
            
            <div class="card">
                <h2>GÃ¶rev Ä°lerlemeniz</h2>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="completedTasks">0</h3><p>Tamamlanan GÃ¶revler</p></div>
                    <div class="ad-info-item"><h3 id="taskEarnings">USDT 0.00</h3><p>GÃ¶rev KazancÄ±</p></div>
                </div>
            </div>
        </div>
        
        <!-- Task Marketplace View -->
        <div id="task-marketplace-view" class="view">
            <div class="header"><h1>GÃ¶rev PazarÄ±</h1><p>DiÄŸer kullanÄ±cÄ±larÄ±n gÃ¶revlerini tamamlayarak kazanÄ±n</p></div>
            
            <div class="card">
                <h2>Mevcut GÃ¶revler</h2>
                <div id="marketplaceTasksList">
                    <!-- GÃ¶rev pazarÄ± gÃ¶revleri buraya eklenecek -->
                </div>
            </div>
        </div>
        
        <!-- Task Creation View -->
        <div id="task-creation-view" class="view">
            <div class="header"><h1>GÃ¶rev OluÅŸtur</h1><p>Kendi gÃ¶revinizi oluÅŸturun ve diÄŸer kullanÄ±cÄ±lar tamamlasÄ±n</p></div>
            
            <div class="card">
                <h2>Yeni GÃ¶rev OluÅŸtur</h2>
                <div class="task-creation-form">
                    <div class="input-group">
                        <label for="taskTitle">GÃ¶rev BaÅŸlÄ±ÄŸÄ±</label>
                        <input type="text" id="taskTitle" placeholder="GÃ¶rev baÅŸlÄ±ÄŸÄ±nÄ± girin">
                    </div>
                    <div class="input-group">
                        <label for="taskDescription">GÃ¶rev AÃ§Ä±klamasÄ±</label>
                        <textarea id="taskDescription" placeholder="GÃ¶rev aÃ§Ä±klamasÄ±nÄ± girin" rows="3"></textarea>
                    </div>
                    <div class="input-group">
                        <label for="taskLink">Kanal/Bot Linki</label>
                        <input type="text" id="taskLink" placeholder="https://t.me/kanal_adi">
                    </div>
                    
                    <!-- Percentage Selector -->
                    <div class="input-group">
                        <label>GÃ¶rev BÃ¼tÃ§esi (Bakiyenizin YÃ¼zdesi)</label>
                        <div class="percentage-selector">
                            <button type="button" class="percentage-btn" data-percentage="25">%25</button>
                            <button type="button" class="percentage-btn" data-percentage="50">%50</button>
                            <button type="button" class="percentage-btn" data-percentage="75">%75</button>
                            <button type="button" class="percentage-btn" data-percentage="100">%100</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="input-group">
                            <label for="taskReward">KiÅŸi BaÅŸÄ± Ã–dÃ¼l (USDT)</label>
                            <input type="number" id="taskReward" step="0.001" min="0.001" value="0.002" readonly>
                        </div>
                        <div class="input-group">
                            <label for="taskMembers">Gerekli Ãœye SayÄ±sÄ±</label>
                            <input type="number" id="taskMembers" min="1" value="10" readonly>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="taskCost">Toplam Maliyet: <span id="totalCost">0.00</span> USDT</label>
                        <p style="font-size:12px; color:var(--tg-theme-hint-color);">Bu gÃ¶rev iÃ§in bakiyenizden <span id="costAmount">0.00</span> USDT dÃ¼ÅŸÃ¼lecek</p>
                    </div>
                    <button class="btn" id="createTaskBtn">GÃ¶rev OluÅŸtur</button>
                </div>
            </div>
        </div>
        
        <!-- About View -->
        <div id="about-view" class="view">
            <div class="header"><h1>HakkÄ±mÄ±zda</h1><p>TorreAds ve Torre Labs</p></div>
            
            <div class="card">
                <div class="about-content">
                    <div class="about-section">
                        <h3>TorreAds HakkÄ±nda</h3>
                        <p>TorreAds, Torre Labs tarafÄ±ndan geliÅŸtirilen yenilikÃ§i bir reklam platformudur. Bu proje, sÃ¼rdÃ¼rÃ¼lebilirlik ilkelerine dayalÄ± olarak tasarlanmÄ±ÅŸ olup, geleneksel reklam modellerinden farklÄ±laÅŸarak kullanÄ±cÄ± odaklÄ± bir yaklaÅŸÄ±m benimser. Projenin temel amacÄ±, reklam gelirlerinin %40'Ä±nÄ± doÄŸrudan kullanÄ±cÄ±lara daÄŸÄ±tarak hem ekosistemi teÅŸvik etmek hem de adil bir deÄŸer paylaÅŸÄ±mÄ± saÄŸlamaktÄ±r.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>SÃ¼rdÃ¼rÃ¼lebilirlik</h3>
                        <p>SÃ¼rdÃ¼rÃ¼lebilirlik aÃ§Ä±sÄ±ndan, TorreAds enerji verimli teknolojiler ve Ã§evre dostu veri iÅŸleme yÃ¶ntemleri kullanarak karbon ayak izini minimize eder; Ã¶rneÄŸin, yenilenebilir enerji kaynaklÄ± sunucular ve optimize edilmiÅŸ algoritmalarla reklam teslimatÄ±nÄ± gerÃ§ekleÅŸtirir. Bu sayede, hem reklamverenler iÃ§in maliyet etkin hem de kullanÄ±cÄ±lar iÃ§in kazanÃ§lÄ± bir model sunar.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Teknoloji</h3>
                        <p>Proje, blockchain entegrasyonuyla ÅŸeffaflÄ±ÄŸÄ± artÄ±rÄ±r ve kullanÄ±cÄ±larÄ±n reklam etkileÅŸimlerinden (gÃ¶rme, tÄ±klama veya dÃ¶nÃ¼ÅŸÃ¼m) elde edilen Ã¶dÃ¼lleri akÄ±llÄ± sÃ¶zleÅŸmeler aracÄ±lÄ±ÄŸÄ±yla otomatik olarak alÄ±r. Torre Labs'in geliÅŸtirdiÄŸi Ã¶zel bir yapay zeka algoritmasÄ±, reklamlarÄ± kullanÄ±cÄ± ilgi alanlarÄ±na gÃ¶re optimize ederek daha ilgili ve etkili reklam deneyimleri sunar.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin View -->
        <div id="admin-view" class="view">
            <div class="header"><h1>YÃ¶netici Paneli</h1><p>Sistem yÃ¶netimi ve istatistikler</p></div>
            
            <div class="card">
                <h2>Sistem Ä°statistikleri</h2>
                <div class="admin-stats-grid">
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalUsers">0</div>
                        <div class="admin-stat-label">Toplam KullanÄ±cÄ±</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalAds">0</div>
                        <div class="admin-stat-label">Toplam Reklam</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalWithdrawals">0</div>
                        <div class="admin-stat-label">Toplam Ã‡ekim</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalReferrals">0</div>
                        <div class="admin-stat-label">Toplam Referans</div>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Admin Panel -->
            <div class="admin-advanced-panel">
                <h3>GeliÅŸmiÅŸ YÃ¶netim</h3>
                
                <div class="admin-tabs">
                    <div class="admin-tab active" data-tab="users">KullanÄ±cÄ±lar</div>
                    <div class="admin-tab" data-tab="tasks">GÃ¶revler</div>
                    <div class="admin-tab" data-tab="withdrawals">Ã‡ekimler</div>
                    <div class="admin-tab" data-tab="settings">Ayarlar</div>
                </div>
                
                <!-- Users Tab -->
                <div class="admin-tab-content active" id="users-tab">
                    <div class="input-group">
                        <label for="adminUserSearch">KullanÄ±cÄ± Ara (ID veya Kod)</label>
                        <input type="text" id="adminUserSearch" placeholder="KullanÄ±cÄ± ID veya referans kodu">
                        <button class="btn" id="adminSearchUser">Ara</button>
                    </div>
                    
                    <div id="adminUserResult" style="display: none;">
                        <div class="admin-user-item">
                            <div class="admin-user-info">
                                <div class="admin-user-id">KullanÄ±cÄ± ID: <span id="foundUserId"></span></div>
                                <div class="admin-user-balance">Bakiye: <span id="foundUserBalance"></span> USDT | Reklam: <span id="foundUserAds"></span></div>
                            </div>
                            <div class="admin-user-actions">
                                <button class="admin-action-btn" id="adminAddBalance">+0.10 USDT</button>
                                <button class="admin-action-btn" id="adminResetUser">SÄ±fÄ±rla</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-user-list" id="adminUserList">
                        <!-- KullanÄ±cÄ± listesi buraya eklenecek -->
                    </div>
                </div>
                
                <!-- Tasks Tab -->
                <div class="admin-tab-content" id="tasks-tab">
                    <div class="task-creation-form">
                        <h4>Yeni GÃ¶rev Ekle</h4>
                        <div class="input-group">
                            <label for="adminTaskTitle">GÃ¶rev BaÅŸlÄ±ÄŸÄ±</label>
                            <input type="text" id="adminTaskTitle" placeholder="GÃ¶rev baÅŸlÄ±ÄŸÄ±nÄ± girin">
                        </div>
                        <div class="input-group">
                            <label for="adminTaskDescription">GÃ¶rev AÃ§Ä±klamasÄ±</label>
                            <textarea id="adminTaskDescription" placeholder="GÃ¶rev aÃ§Ä±klamasÄ±nÄ± girin" rows="3"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="adminTaskLink">Kanal/Bot Linki</label>
                            <input type="text" id="adminTaskLink" placeholder="https://t.me/kanal_adi">
                        </div>
                        <div class="input-group">
                            <label for="adminTaskReward">Ã–dÃ¼l (USDT)</label>
                            <input type="number" id="adminTaskReward" step="0.001" min="0.001" value="0.002">
                        </div>
                        <button class="btn" id="adminAddTaskBtn">GÃ¶rev Ekle</button>
                    </div>
                    
                    <h4>Mevcut GÃ¶revler</h4>
                    <div id="adminTasksList">
                        <!-- GÃ¶rev listesi buraya eklenecek -->
                    </div>
                </div>
                
                <!-- Withdrawals Tab -->
                <div class="admin-tab-content" id="withdrawals-tab">
                    <div class="withdraw-requests-list" id="withdrawRequestsList">
                        <!-- Ã‡ekim talepleri buraya eklenecek -->
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="admin-tab-content" id="settings-tab">
                    <div class="admin-controls">
                        <button class="admin-control-btn" id="adminResetDaily">GÃ¼nlÃ¼k Limitleri SÄ±fÄ±rla</button>
                        <button class="admin-control-btn" id="adminExportData">Verileri DÄ±ÅŸa Aktar</button>
                        <button class="admin-control-btn danger" id="adminClearAll">TÃ¼m Verileri Temizle</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage"></div>

    <!-- Footer Navigation -->
    <div class="footer-nav">
        <button class="nav-btn active" data-view="home-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            Ana Sayfa
        </button>
        <button class="nav-btn" data-view="tasks-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
            GÃ¶revler
        </button>
        <button class="nav-btn" data-view="task-marketplace-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4-2h2v12h-2z"/></svg>
            Pazar
        </button>
        <button class="nav-btn" data-view="task-creation-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            OluÅŸtur
        </button>
        <button class="nav-btn" data-view="withdraw-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M17 7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h10c2.76 0 5-2.24 5-5s-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/></svg>
            Ã‡ekim
        </button>
        <button class="nav-btn" data-view="referral-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
            Referans
        </button>
        <button class="nav-btn" data-view="about-view">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
            HakkÄ±nda
        </button>
        <button class="nav-btn" data-view="admin-view" id="navAdmin" style="display: none;">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
            YÃ¶netici
        </button>
    </div>

    <script>
        // JSONBin.io Configuration
        const JSONBIN_BIN_ID = '68dd124bae596e708f0254ac';
        const JSONBIN_API_KEY = '$2a$10$Fv9Ec7a8u59so/FlxU1buOBqSrJZbj7FD8hxVsGCtRPqxQ6cpXBY.';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        // Telegram WebApp
        const tg = window.Telegram.WebApp;

        // Global State
        let appData = {
            users: {},
            tasks: {
                manual: [],
                marketplace: []
            },
            withdrawRequests: [],
            systemStats: {
                totalUsers: 0,
                totalAds: 0,
                totalWithdrawals: 0,
                totalReferrals: 0,
                lastReset: new Date().toDateString()
            }
        };

        let currentUser = {
            id: null,
            balance: 0,
            adCount: 0,
            dailyAdCount: 0,
            lastAdDate: null,
            referralCode: '',
            referredBy: null,
            referralCount: 0,
            referralBonus: 0,
            completedTasks: [],
            taskEarnings: 0,
            paymentAddress: '',
            isAdmin: false
        };

        // Initialize App
        async function initApp() {
            try {
                showStatus('Uygulama baÅŸlatÄ±lÄ±yor...', 'info');
                
                // Load data from JSONBin
                await loadAppData();
                
                // Initialize current user
                await initCurrentUser();
                
                // Update UI
                updateUI();
                
                // Load USDT price
                loadUSDTPrice();
                
                showStatus('Uygulama hazÄ±r!', 'success', 2000);
                
            } catch (error) {
                console.error('App initialization error:', error);
                showStatus('Uygulama baÅŸlatÄ±lÄ±rken hata oluÅŸtu', 'error');
            }
        }

        // Load app data from JSONBin
        async function loadAppData() {
            try {
                const response = await fetch(JSONBIN_URL + '/latest', {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.record) {
                        appData = data.record;
                        console.log('App data loaded successfully');
                    }
                }
            } catch (error) {
                console.error('Error loading app data:', error);
            }
        }

        // Save app data to JSONBin
        async function saveAppData() {
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(appData)
                });
                
                if (response.ok) {
                    console.log('App data saved successfully');
                    return true;
                }
            } catch (error) {
                console.error('Error saving app data:', error);
            }
            return false;
        }

        // Initialize current user
        async function initCurrentUser() {
            const user = tg.initDataUnsafe.user;
            if (!user || !user.id) {
                showStatus('KullanÄ±cÄ± bilgileri alÄ±namadÄ±', 'error');
                return;
            }
            
            currentUser.id = user.id.toString();
            
            // Check if user exists
            if (appData.users[currentUser.id]) {
                currentUser = { ...currentUser, ...appData.users[currentUser.id] };
            } else {
                // Create new user
                currentUser.referralCode = generateReferralCode();
                currentUser.isAdmin = [7904032877, 8401848644, 6357701459].includes(parseInt(currentUser.id));
                
                // Check for referral code in URL
                const urlParams = new URLSearchParams(window.location.search);
                const startParam = urlParams.get('start');
                if (startParam) {
                    await applyReferral(startParam);
                }
                
                // Save new user
                appData.users[currentUser.id] = { ...currentUser };
                appData.systemStats.totalUsers = Object.keys(appData.users).length;
                await saveAppData();
            }
            
            // Check daily reset
            checkDailyReset();
        }

        // Generate referral code
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // Apply referral
        async function applyReferral(referralCode) {
            if (currentUser.referredBy) {
                showStatus('Zaten bir referans kodu kullandÄ±nÄ±z', 'error');
                return;
            }
            
            // Find referrer
            for (const userId in appData.users) {
                const user = appData.users[userId];
                if (user.referralCode === referralCode && userId !== currentUser.id) {
                    currentUser.referredBy = userId;
                    
                    // Add bonuses
                    currentUser.balance += 0.02;
                    currentUser.referralBonus += 0.02;
                    
                    user.referralCount += 1;
                    user.referralBonus += 0.02;
                    user.balance += 0.02;
                    
                    appData.systemStats.totalReferrals += 1;
                    
                    showStatus('Referans baÅŸarÄ±yla uygulandÄ±! +0.02 USDT bonus', 'success');
                    await saveAppData();
                    return;
                }
            }
            
            showStatus('GeÃ§ersiz referans kodu', 'error');
        }

        // Check daily reset
        function checkDailyReset() {
            const today = new Date().toDateString();
            if (currentUser.lastAdDate !== today) {
                currentUser.dailyAdCount = 0;
                currentUser.lastAdDate = today;
                saveUserData();
            }
        }

        // Save current user data
        async function saveUserData() {
            appData.users[currentUser.id] = { ...currentUser };
            await saveAppData();
        }

        // Update UI
        function updateUI() {
            // Update balances and counts
            document.getElementById('balanceDisplay').textContent = `USDT ${currentUser.balance.toFixed(3)}`;
            document.getElementById('adCountDisplay').textContent = currentUser.adCount;
            document.getElementById('dailyAdCountDisplay').textContent = `${currentUser.dailyAdCount} / 100`;
            document.getElementById('withdrawBalanceDisplay').textContent = `USDT ${currentUser.balance.toFixed(3)}`;
            
            // Update referral info
            document.getElementById('referralCountDisplay').textContent = currentUser.referralCount;
            document.getElementById('referralBonusDisplay').textContent = `USDT ${currentUser.referralBonus.toFixed(3)}`;
            document.getElementById('userReferralCode').textContent = currentUser.referralCode;
            document.getElementById('userReferralLink').textContent = `https://t.me/TorreAds_Bot?start=${currentUser.referralCode}`;
            
            // Update task info
            document.getElementById('completedTasks').textContent = currentUser.completedTasks.length;
            document.getElementById('taskEarnings').textContent = `USDT ${currentUser.taskEarnings.toFixed(3)}`;
            
            // Update withdraw buttons
            updateWithdrawButtons();
            
            // Update payment address
            const paymentAddressInput = document.getElementById('paymentAddress');
            paymentAddressInput.value = currentUser.paymentAddress || '';
            paymentAddressInput.addEventListener('input', function() {
                currentUser.paymentAddress = this.value;
                updateWithdrawButtons();
                saveUserData();
            });
            
            // Setup referral copy
            setupReferralCopy();
            
            // Load tasks
            loadManualTasks();
            loadMarketplaceTasks();
            
            // Setup percentage selector
            setupPercentageSelector();
            
            // Update admin panel
            updateAdminPanel();
            
            // Show/hide admin nav
            document.getElementById('navAdmin').style.display = currentUser.isAdmin ? 'flex' : 'none';
            document.getElementById('adminPanel').style.display = currentUser.isAdmin ? 'block' : 'none';
        }

        // Update withdraw buttons
        function updateWithdrawButtons() {
            const mainBtn = document.getElementById('mainWithdrawBtn');
            const finalBtn = document.getElementById('finalWithdrawBtn');
            
            if (currentUser.balance >= 0.50 && currentUser.paymentAddress) {
                mainBtn.disabled = false;
                mainBtn.textContent = `Para Ã‡ek (${currentUser.balance.toFixed(3)} USDT)`;
                finalBtn.disabled = false;
            } else {
                mainBtn.disabled = true;
                finalBtn.disabled = true;
                if (currentUser.balance < 0.50) {
                    mainBtn.textContent = `Ã‡ekim Ä°Ã§in ${(0.50 - currentUser.balance).toFixed(3)} USDT Gerekli`;
                } else {
                    mainBtn.textContent = 'CÃ¼zdan Adresi Girin';
                }
            }
        }

        // Setup referral copy
        function setupReferralCopy() {
            document.getElementById('referralCodeBox').onclick = function() {
                navigator.clipboard.writeText(currentUser.referralCode).then(() => {
                    showStatus('Referans kodu kopyalandÄ±!', 'success');
                });
            };
            
            document.getElementById('referralLinkBox').onclick = function() {
                navigator.clipboard.writeText(`https://t.me/TorreAds_Bot?start=${currentUser.referralCode}`).then(() => {
                    showStatus('Referans linki kopyalandÄ±!', 'success');
                });
            };
        }

        // Setup percentage selector
        function setupPercentageSelector() {
            const percentageBtns = document.querySelectorAll('.percentage-btn');
            percentageBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    percentageBtns.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    const percentage = parseInt(this.dataset.percentage);
                    calculateTaskCost(percentage);
                });
            });
            
            // Set default to 25%
            percentageBtns[0].click();
        }

        // Calculate task cost based on percentage
        function calculateTaskCost(percentage) {
            const maxCost = (currentUser.balance * percentage) / 100;
            const rewardInput = document.getElementById('taskReward');
            const membersInput = document.getElementById('taskMembers');
            const totalCost = document.getElementById('totalCost');
            const costAmount = document.getElementById('costAmount');
            
            // Calculate optimal values
            const reward = 0.002; // Fixed reward
            const maxMembers = Math.floor(maxCost / reward);
            const actualMembers = Math.min(maxMembers, 100); // Cap at 100 members
            const actualCost = reward * actualMembers;
            
            // Update displays
            rewardInput.value = reward.toFixed(3);
            membersInput.value = actualMembers;
            totalCost.textContent = actualCost.toFixed(3);
            costAmount.textContent = actualCost.toFixed(3);
            
            // Update create button
            const createBtn = document.getElementById('createTaskBtn');
            createBtn.disabled = actualCost > currentUser.balance || actualMembers < 1;
            createBtn.textContent = createBtn.disabled ? 'Yetersiz Bakiye' : 'GÃ¶rev OluÅŸtur';
        }

        // Load manual tasks
        function loadManualTasks() {
            const tasksList = document.getElementById('manualTasksList');
            tasksList.innerHTML = '';
            
            if (appData.tasks.manual.length === 0) {
                tasksList.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">HenÃ¼z gÃ¶rev bulunmuyor.</p>';
                return;
            }
            
            appData.tasks.manual.forEach((task, index) => {
                const isCompleted = currentUser.completedTasks.includes(task.id);
                
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                    </div>
                    <div class="task-reward">+${task.reward} USDT</div>
                    <button class="task-btn" onclick="completeManualTask('${task.id}')" ${isCompleted ? 'disabled' : ''}>
                        ${isCompleted ? 'TamamlandÄ±' : 'KatÄ±l'}
                    </button>
                `;
                
                tasksList.appendChild(taskElement);
            });
        }

        // Load marketplace tasks
        function loadMarketplaceTasks() {
            const tasksList = document.getElementById('marketplaceTasksList');
            tasksList.innerHTML = '';
            
            // Filter out expired tasks
            const now = Date.now();
            appData.tasks.marketplace = appData.tasks.marketplace.filter(task => {
                return now - task.createdAt < (48 * 60 * 60 * 1000); // 48 hours
            });
            
            if (appData.tasks.marketplace.length === 0) {
                tasksList.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">HenÃ¼z gÃ¶rev bulunmuyor.</p>';
                return;
            }
            
            appData.tasks.marketplace.forEach((task, index) => {
                const isCompleted = currentUser.completedTasks.includes(task.id);
                const timeLeft = task.createdAt + (48 * 60 * 60 * 1000) - now;
                const hoursLeft = Math.floor(timeLeft / (60 * 60 * 1000));
                const completedCount = task.completedBy ? task.completedBy.length : 0;
                const progressPercent = (completedCount / task.members) * 100;
                
                const taskElement = document.createElement('div');
                taskElement.className = 'marketplace-task-item';
                taskElement.innerHTML = `
                    <div class="marketplace-task-header">
                        <div class="marketplace-task-title">${task.title}</div>
                        <div class="marketplace-task-cost">-${task.cost} USDT</div>
                    </div>
                    <div class="marketplace-task-description">${task.description}</div>
                    <div class="marketplace-task-details">
                        <div>Ã–dÃ¼l: ${task.reward} USDT/kiÅŸi</div>
                        <div>Hedef: ${task.members} Ã¼ye</div>
                        <div class="marketplace-task-timer">${hoursLeft}sa kaldÄ±</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                    <div class="task-progress">${completedCount}/${task.members} tamamlandÄ±</div>
                    <div class="marketplace-task-actions">
                        <button class="marketplace-task-btn" onclick="acceptMarketplaceTask('${task.id}')" 
                            ${isCompleted || currentUser.balance < task.cost || completedCount >= task.members ? 'disabled' : ''}>
                            ${isCompleted ? 'TamamlandÄ±' : (currentUser.balance < task.cost ? 'Yetersiz Bakiye' : (completedCount >= task.members ? 'Kota Doldu' : 'GÃ¶revi Al'))}
                        </button>
                        <a href="${task.link}" target="_blank" class="marketplace-task-btn" style="text-decoration: none; text-align: center;">
                            Linke Git
                        </a>
                    </div>
                `;
                
                tasksList.appendChild(taskElement);
            });
        }

        // Complete manual task
        async function completeManualTask(taskId) {
            const task = appData.tasks.manual.find(t => t.id === taskId);
            if (!task) return;
            
            if (currentUser.completedTasks.includes(taskId)) {
                showStatus('Bu gÃ¶revi zaten tamamladÄ±nÄ±z', 'error');
                return;
            }
            
            currentUser.completedTasks.push(taskId);
            currentUser.balance += task.reward;
            currentUser.taskEarnings += task.reward;
            
            showStatus(`Tebrikler! ${task.reward} USDT kazandÄ±nÄ±z.`, 'success');
            await saveUserData();
            updateUI();
        }

        // Accept marketplace task
        async function acceptMarketplaceTask(taskId) {
            const task = appData.tasks.marketplace.find(t => t.id === taskId);
            if (!task) return;
            
            if (currentUser.completedTasks.includes(taskId)) {
                showStatus('Bu gÃ¶revi zaten tamamladÄ±nÄ±z', 'error');
                return;
            }
            
            if (currentUser.balance < task.cost) {
                showStatus('Yetersiz bakiye', 'error');
                return;
            }
            
            const completedCount = task.completedBy ? task.completedBy.length : 0;
            if (completedCount >= task.members) {
                showStatus('Bu gÃ¶revin kotasÄ± dolmuÅŸ', 'error');
                return;
            }
            
            // Deduct cost
            currentUser.balance -= task.cost;
            currentUser.completedTasks.push(taskId);
            
            // Update task completion
            if (!task.completedBy) task.completedBy = [];
            task.completedBy.push(currentUser.id);
            
            showStatus(`GÃ¶rev alÄ±ndÄ±! ${task.cost} USDT dÃ¼ÅŸÃ¼ldÃ¼.`, 'success');
            await saveAppData();
            await saveUserData();
            updateUI();
        }

        // Create marketplace task
        async function createMarketplaceTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const link = document.getElementById('taskLink').value.trim();
            const reward = parseFloat(document.getElementById('taskReward').value);
            const members = parseInt(document.getElementById('taskMembers').value);
            const cost = reward * members;
            
            if (!title || !description || !link) {
                showStatus('LÃ¼tfen tÃ¼m alanlarÄ± doldurun', 'error');
                return;
            }
            
            if (cost > currentUser.balance) {
                showStatus('Yetersiz bakiye', 'error');
                return;
            }
            
            // Deduct cost
            currentUser.balance -= cost;
            
            // Create task
            const task = {
                id: 'task_' + Date.now(),
                title,
                description,
                link,
                reward,
                members,
                cost,
                creator: currentUser.id,
                createdAt: Date.now(),
                completedBy: []
            };
            
            appData.tasks.marketplace.push(task);
            
            // Clear form
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskLink').value = '';
            
            showStatus('GÃ¶rev oluÅŸturuldu!', 'success');
            await saveAppData();
            await saveUserData();
            updateUI();
            showView('task-marketplace-view');
        }

        // Load USDT price
        function loadUSDTPrice() {
            // Simulate price data
            const price = 1.00 + (Math.random() - 0.5) * 0.01;
            const change = (price - 1.00) / 1.00 * 100;
            
            document.getElementById('usdtPrice').textContent = price.toFixed(4);
            const changeElement = document.getElementById('priceChange');
            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeElement.className = `price-change ${change >= 0 ? 'positive' : 'negative'}`;
        }

        // Show status message
        function showStatus(message, type, duration = 3000) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message ${type}`;
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, duration);
        }

        // Show view
        function showView(viewId) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.style.display = 'none';
            });
            
            // Show target view
            document.getElementById(viewId).style.display = 'block';
            
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${viewId}"]`).classList.add('active');
            
            // Special handling for admin view
            if (viewId === 'admin-view' && currentUser.isAdmin) {
                updateAdminPanel();
            }
        }

        // Update admin panel
        function updateAdminPanel() {
            if (!currentUser.isAdmin) return;
            
            // Update stats
            document.getElementById('totalUsers').textContent = Object.keys(appData.users).length;
            document.getElementById('totalAds').textContent = appData.systemStats.totalAds;
            document.getElementById('totalWithdrawals').textContent = appData.systemStats.totalWithdrawals;
            document.getElementById('totalReferrals').textContent = appData.systemStats.totalReferrals;
            
            // Update user list
            updateAdminUserList();
            
            // Update tasks list
            updateAdminTasksList();
            
            // Update withdraw requests
            updateWithdrawRequestsList();
        }

        // Update admin user list
        function updateAdminUserList() {
            const userList = document.getElementById('adminUserList');
            userList.innerHTML = '';
            
            const users = Object.entries(appData.users).slice(0, 10); // Show first 10 users
            
            users.forEach(([userId, user]) => {
                const userElement = document.createElement('div');
                userElement.className = 'admin-user-item';
                userElement.innerHTML = `
                    <div class="admin-user-info">
                        <div class="admin-user-id">${userId}</div>
                        <div class="admin-user-balance">
                            Bakiye: ${user.balance.toFixed(3)} USDT | 
                            Reklam: ${user.adCount} | 
                            Referans: ${user.referralCount}
                        </div>
                    </div>
                `;
                userList.appendChild(userElement);
            });
        }

        // Update admin tasks list
        function updateAdminTasksList() {
            const tasksList = document.getElementById('adminTasksList');
            tasksList.innerHTML = '';
            
            appData.tasks.manual.forEach((task, index) => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                    </div>
                    <div class="task-reward">+${task.reward} USDT</div>
                    <button class="task-btn" onclick="deleteManualTask(${index})">Sil</button>
                `;
                tasksList.appendChild(taskElement);
            });
        }

        // Update withdraw requests list
        function updateWithdrawRequestsList() {
            const requestsList = document.getElementById('withdrawRequestsList');
            requestsList.innerHTML = '';
            
            if (appData.withdrawRequests.length === 0) {
                requestsList.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">Bekleyen Ã§ekim talebi yok.</p>';
                return;
            }
            
            appData.withdrawRequests.forEach((request, index) => {
                const user = appData.users[request.userId];
                const requestElement = document.createElement('div');
                requestElement.className = 'withdraw-request-item';
                requestElement.innerHTML = `
                    <div class="withdraw-request-info">
                        <div class="withdraw-request-user">KullanÄ±cÄ± ID: ${request.userId}</div>
                        <div class="withdraw-request-details">
                            Miktar: ${request.amount} USDT | 
                            Adres: ${request.address}
                        </div>
                    </div>
                    <div class="withdraw-request-actions">
                        <button class="withdraw-action-btn approve" onclick="approveWithdraw(${index})">Onayla</button>
                        <button class="withdraw-action-btn reject" onclick="rejectWithdraw(${index})">Reddet</button>
                    </div>
                `;
                requestsList.appendChild(requestElement);
            });
        }

        // Admin: Add manual task
        async function addManualTask() {
            const title = document.getElementById('adminTaskTitle').value.trim();
            const description = document.getElementById('adminTaskDescription').value.trim();
            const link = document.getElementById('adminTaskLink').value.trim();
            const reward = parseFloat(document.getElementById('adminTaskReward').value);
            
            if (!title || !description) {
                showStatus('LÃ¼tfen gÃ¶rev baÅŸlÄ±ÄŸÄ± ve aÃ§Ä±klamasÄ± girin', 'error');
                return;
            }
            
            const task = {
                id: 'manual_' + Date.now(),
                title,
                description,
                link: link || '#',
                reward,
                type: 'manual'
            };
            
            appData.tasks.manual.push(task);
            
            // Clear form
            document.getElementById('adminTaskTitle').value = '';
            document.getElementById('adminTaskDescription').value = '';
            document.getElementById('adminTaskLink').value = '';
            document.getElementById('adminTaskReward').value = '0.002';
            
            showStatus('GÃ¶rev eklendi!', 'success');
            await saveAppData();
            updateAdminPanel();
        }

        // Admin: Delete manual task
        async function deleteManualTask(index) {
            if (confirm('Bu gÃ¶revi silmek istediÄŸinizden emin misiniz?')) {
                appData.tasks.manual.splice(index, 1);
                await saveAppData();
                updateAdminPanel();
                showStatus('GÃ¶rev silindi!', 'success');
            }
        }

        // Admin: Approve withdraw
        async function approveWithdraw(index) {
            const request = appData.withdrawRequests[index];
            appData.systemStats.totalWithdrawals += parseFloat(request.amount);
            appData.withdrawRequests.splice(index, 1);
            await saveAppData();
            updateAdminPanel();
            showStatus('Ã‡ekim talebi onaylandÄ±!', 'success');
        }

        // Admin: Reject withdraw
        async function rejectWithdraw(index) {
            const request = appData.withdrawRequests[index];
            
            // Return balance to user
            if (appData.users[request.userId]) {
                appData.users[request.userId].balance += parseFloat(request.amount);
            }
            
            appData.withdrawRequests.splice(index, 1);
            await saveAppData();
            updateAdminPanel();
            showStatus('Ã‡ekim talebi reddedildi!', 'success');
        }

        // Handle rewarded ad
        async function handleRewardedAd() {
            if (currentUser.dailyAdCount >= 100) {
                showStatus('GÃ¼nlÃ¼k reklam limitine ulaÅŸtÄ±nÄ±z', 'error');
                return;
            }
            
            const btn = document.getElementById('rewardedBtn');
            btn.disabled = true;
            btn.classList.add('btn-loading');
            
            try {
                // Simulate ad viewing
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Add reward
                currentUser.balance += 0.002;
                currentUser.adCount += 1;
                currentUser.dailyAdCount += 1;
                appData.systemStats.totalAds += 1;
                
                showStatus('Reklam izlendi! +0.002 USDT eklendi', 'success');
                await saveUserData();
                updateUI();
                
            } catch (error) {
                showStatus('Reklam yÃ¼klenirken hata oluÅŸtu', 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('btn-loading');
            }
        }

        // Handle withdraw
        async function handleWithdraw() {
            if (currentUser.balance < 0.50) {
                showStatus('Minimum Ã§ekim miktarÄ± 0.50 USDT', 'error');
                return;
            }
            
            if (!currentUser.paymentAddress) {
                showStatus('LÃ¼tfen USDT cÃ¼zdan adresinizi girin', 'error');
                return;
            }
            
            // Add to withdraw requests
            appData.withdrawRequests.push({
                userId: currentUser.id,
                amount: currentUser.balance.toFixed(3),
                address: currentUser.paymentAddress,
                timestamp: new Date().toISOString()
            });
            
            // Reset balance
            currentUser.balance = 0;
            
            showStatus('Ã‡ekim talebiniz alÄ±ndÄ±! OnaylandÄ±ktan sonra Ã¶demeniz yapÄ±lacak.', 'success');
            await saveAppData();
            await saveUserData();
            updateUI();
            showView('home-view');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showView(this.dataset.view);
                });
            });
            
            // Rewarded ad
            document.getElementById('rewardedBtn').addEventListener('click', handleRewardedAd);
            
            // Withdraw
            document.getElementById('finalWithdrawBtn').addEventListener('click', handleWithdraw);
            
            // Referral submission
            document.getElementById('submitReferralBtn').addEventListener('click', async function() {
                const code = document.getElementById('referralCodeInput').value.trim().toUpperCase();
                if (!code) {
                    showStatus('LÃ¼tfen bir referans kodu girin', 'error');
                    return;
                }
                await applyReferral(code);
                updateUI();
            });
            
            // Task creation
            document.getElementById('createTaskBtn').addEventListener('click', createMarketplaceTask);
            
            // Admin task addition
            document.getElementById('adminAddTaskBtn').addEventListener('click', addManualTask);
            
            // Admin tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab + '-tab').classList.add('active');
                });
            });
            
            // Initialize app
            tg.ready();
            tg.expand();
            initApp();
        });

        // Make functions global for onclick handlers
        window.completeManualTask = completeManualTask;
        window.acceptMarketplaceTask = acceptMarketplaceTask;
        window.addManualTask = addManualTask;
        window.deleteManualTask = deleteManualTask;
        window.approveWithdraw = approveWithdraw;
        window.rejectWithdraw = rejectWithdraw;
        window.showView = showView;
    </script>
</body>
</html>
