<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TorreAds</title>
    
    <!-- GigaPub SDK -->
    <script src="https://ad.gigapub.tech/script?id=986"></script>

    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --tg-theme-bg-color: #121212; --tg-theme-text-color: #e0e0e0; --tg-theme-button-color: #007bff;
            --tg-theme-button-text-color: #ffffff; --tg-theme-hint-color: #8a8a8a; --success-color: #28a745;
            --warning-color: #ffc107; --danger-color: #dc3545; --secondary-bg-color: #1e1e1e; --border-color: #333333;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0;
            padding: 20px 15px 90px 15px; background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
            display: flex; flex-direction: column; align-items: center; text-align: center; min-height: 100vh; box-sizing: border-box;
        }
        .container { width: 100%; max-width: 500px; }
        .view { display: none; width: 100%; animation: fadeIn 0.3s ease-in-out; }
        #home-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { margin-bottom: 25px; }
        .header h1 { font-size: 32px; font-weight: 700; margin-bottom: 5px; color: #ffffff; }
        .header p { color: var(--tg-theme-hint-color); font-size: 16px; }
        .card {
            background-color: var(--secondary-bg-color); padding: 25px; border-radius: 16px; margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color);
        }
        .card h2 {
            margin: 0 0 12px 0; font-size: 16px; color: var(--tg-theme-hint-color); font-weight: 500;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .balance-amount { font-size: 42px; font-weight: 700; color: #ffffff; margin-bottom: 10px; }
        .ad-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; }
        .ad-info-item h3 { font-size: 20px; font-weight: 600; margin: 0 0 5px 0; color: #ffffff; }
        .ad-info-item p { font-size: 14px; color: var(--tg-theme-hint-color); margin: 0; }
        .ad-buttons { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        .btn {
            width: 100%; padding: 16px; font-size: 18px; font-weight: 600; border: none; border-radius: 12px; cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3); color: var(--tg-theme-button-text-color);
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #555; color: #888; cursor: not-allowed; box-shadow: none; transform: none; }
        #mainWithdrawBtn { background: linear-gradient(145deg, var(--success-color), #1e7e34); box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2); }
        #mainWithdrawBtn:disabled { background: #555; box-shadow: none; }
        .status-message {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 480px;
            padding: 12px 15px; border-radius: 10px; font-weight: 500; display: none; animation: fadeIn 0.3s;
            z-index: 1000; box-sizing: border-box;
        }
        .success { display: block; background-color: rgba(40, 167, 69, 0.25); border-left: 5px solid var(--success-color); color: var(--success-color); }
        .error { display: block; background-color: rgba(220, 53, 69, 0.25); border-left: 5px solid var(--danger-color); color: var(--danger-color); }
        .info { display: block; background-color: rgba(0, 123, 255, 0.25); border-left: 5px solid var(--tg-theme-button-color); color: #008cff; }
        .footer-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--secondary-bg-color); display: flex;
            justify-content: space-around; padding: 10px 0; box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
            border-top: 1px solid var(--border-color); z-index: 999;
        }
        .nav-btn {
            background: none; border: none; color: var(--tg-theme-hint-color); display: flex; flex-direction: column;
            align-items: center; font-size: 12px; font-weight: 500; cursor: pointer; padding: 5px 15px;
            border-radius: 12px; transition: color 0.2s, background-color 0.2s;
        }
        .nav-btn.active { color: var(--tg-theme-button-color); }
        .nav-btn:hover:not(.active) { color: #ffffff; }
        .nav-btn .icon { width: 28px; height: 28px; margin-bottom: 4px; }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--tg-theme-hint-color); font-size: 14px; font-weight: 500; }
        .input-group input {
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--border-color);
            background-color: #333; color: var(--tg-theme-text-color); font-size: 16px; box-sizing: border-box;
        }
        .input-group input:focus { outline: none; border-color: var(--tg-theme-button-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
        #referralLink {
            background-color: #111; padding: 15px; border-radius: 10px; word-wrap: break-word;
            border: 1px dashed var(--tg-theme-hint-color); margin-top: 15px; cursor: pointer; color: #e0e0e0;
            transition: background-color 0.2s; text-align: left;
        }
        #referralLink:hover { background-color: #2a2a2a; }
        
        /* Yeni referans giri≈ü kutusu stilleri */
        .referral-input-container {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-bg-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .referral-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .referral-input-group input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: #333;
            color: var(--tg-theme-text-color);
        }
        
        .referral-input-group button {
            padding: 12px 20px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Loading indicator */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* USDT Price Chart Styles */
        .price-chart {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }
        
        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: bold;
        }
        
        .price-change {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .price-change.positive {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }
        
        .price-change.negative {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }
        
        .chart-placeholder {
            height: 60px;
            background: linear-gradient(90deg, #333 0%, #444 50%, #333 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }

        /* Referans kod kutusu */
        .referral-code-box {
            background-color: #111;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--tg-theme-hint-color);
            margin-top: 15px;
            cursor: pointer;
            color: #e0e0e0;
            transition: background-color 0.2s;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
        }
        
        .referral-code-box:hover {
            background-color: #2a2a2a;
        }

        /* Admin Panel Stilleri */
        .admin-panel {
            display: none;
            margin-top: 30px;
            padding: 15px;
            border: 1px solid var(--warning-color);
            border-radius: 10px;
            background-color: rgba(255, 193, 7, 0.1);
        }
        
        .admin-panel h3 {
            color: var(--warning-color);
            margin-top: 0;
        }
        
        .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .admin-btn {
            padding: 10px 15px;
            background: linear-gradient(145deg, var(--warning-color), #e0a800);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
        }
        
        .admin-btn.danger {
            background: linear-gradient(145deg, var(--danger-color), #c82333);
            color: white;
        }
        
        .admin-stats {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 14px;
            text-align: left;
        }
        
        /* Hakkƒ±mƒ±zda B√∂l√ºm√º */
        .about-section {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--secondary-bg-color);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        
        .about-section h2 {
            color: #ffffff;
            margin-top: 0;
            font-size: 20px;
        }
        
        .about-section p {
            color: var(--tg-theme-hint-color);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .about-section ul {
            color: var(--tg-theme-hint-color);
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .about-section li {
            margin-bottom: 8px;
        }
        
        /* Geli≈ütirilmi≈ü Admin Panel */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        
        .admin-tab {
            padding: 8px 15px;
            background-color: #333;
            border: none;
            border-radius: 8px;
            color: var(--tg-theme-text-color);
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .admin-tab.active {
            background-color: var(--warning-color);
            color: #000;
        }
        
        .admin-content {
            display: none;
        }
        
        .admin-content.active {
            display: block;
        }
        
        .withdrawals-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .withdrawal-item {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            text-align: left;
            border-left: 4px solid var(--warning-color);
        }
        
        .withdrawal-item.approved {
            border-left-color: var(--success-color);
        }
        
        .withdrawal-item.rejected {
            border-left-color: var(--danger-color);
        }
        
        .user-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .user-item {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            text-align: left;
        }
        
        .user-balance {
            font-weight: bold;
            color: var(--success-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home / Task View -->
        <div id="home-view" class="view">
            <div class="header"><h1>TorreAds</h1><p>Reklam ƒ∞zle ve USDT Kazan</p></div>
            
            <!-- USDT Price Chart -->
            <div class="price-chart">
                <div class="price-info">
                    <div class="current-price">USDT: $<span id="usdtPrice">1.00</span></div>
                    <div class="price-change" id="priceChange">0.00%</div>
                </div>
                <div class="chart-placeholder" id="chartPlaceholder">
                    Canlƒ± USDT Fiyat Grafiƒüi
                </div>
            </div>
            
            <div class="card">
                <h2>Mevcut Bakiye</h2>
                <div class="balance-amount" id="balanceDisplay">USDT 0.00</div>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Toplam ƒ∞zlenen Reklam</p></div>
                    <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0 / 100</h3><p>Bug√ºnk√º Reklamlar</p></div>
                </div>
            </div>
            <div class="ad-buttons"><button class="btn" id="rewardedBtn">Reklam ƒ∞zle (+0.002 USDT)</button></div>
            <button class="btn" id="mainWithdrawBtn" disabled>√áekim Yapmak ƒ∞√ßin 0.50 USDT'ye Ula≈ü</button>
            
            <!-- Hakkƒ±mƒ±zda B√∂l√ºm√º -->
            <div class="about-section">
                <h2>Hakkƒ±mƒ±zda</h2>
                <p>TorreAds, Torre Labs tarafƒ±ndan geli≈ütirilen yenilik√ßi bir reklam platformudur. Bu proje, s√ºrd√ºr√ºlebilirlik ilkelerine dayalƒ± olarak tasarlanmƒ±≈ü olup, geleneksel reklam modellerinden farklƒ±la≈üarak kullanƒ±cƒ± odaklƒ± bir yakla≈üƒ±m benimser.</p>
                
                <p>Projenin temel amacƒ±, reklam gelirlerinin %40'ƒ±nƒ± doƒürudan kullanƒ±cƒ±lara daƒüƒ±tarak hem ekosistemi te≈üvik etmek hem de adil bir deƒüer payla≈üƒ±mƒ± saƒülamaktƒ±r. S√ºrd√ºr√ºlebilirlik a√ßƒ±sƒ±ndan, TorreAds enerji verimli teknolojiler ve √ßevre dostu veri i≈üleme y√∂ntemleri kullanarak karbon ayak izini minimize eder.</p>
                
                <h2>Yol Haritasƒ±</h2>
                <ul>
                    <li><strong>Q4 2025:</strong> Beta s√ºr√ºm yayƒ±nlama, ilk kullanƒ±cƒ± testleri ve %40 gelir payla≈üƒ±m modelinin pilot uygulamasƒ±.</li>
                    <li><strong>Q1 2026:</strong> Ana aƒü lansmanƒ±, pop√ºler platformlarla entegrasyonlar. Kullanƒ±cƒ± tabanƒ±nƒ± 100.000'e √ßƒ±karma hedefi.</li>
                    <li><strong>Q2 2026:</strong> AI algoritmalarƒ±nƒ±n geli≈ütirilmesiyle hedefleme verimliliƒüini %30 artƒ±rma. Yeni pazarlara giri≈ü.</li>
                </ul>
            </div>
            
            <!-- Geni≈ületilmi≈ü Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <h3>üëë Admin Paneli</h3>
                <p id="userInfo"></p>
                
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="stats">ƒ∞statistikler</button>
                    <button class="admin-tab" data-tab="withdrawals">√áekim Talepleri</button>
                    <button class="admin-tab" data-tab="users">Kullanƒ±cƒ±lar</button>
                    <button class="admin-tab" data-tab="settings">Ayarlar</button>
                </div>
                
                <div class="admin-content active" id="statsTab">
                    <div class="admin-stats" id="adminStats">
                        <p><strong>Genel ƒ∞statistikler:</strong></p>
                        <p>Toplam Kullanƒ±cƒ±: <span id="totalUsers">0</span></p>
                        <p>Toplam ƒ∞zlenen Reklam: <span id="totalAds">0</span></p>
                        <p>Toplam Daƒüƒ±tƒ±lan USDT: <span id="totalUSDT">0.00</span></p>
                        <p>Toplam Referans: <span id="totalReferrals">0</span></p>
                        <p>Toplam √áekim Talebi: <span id="totalWithdrawals">0</span></p>
                    </div>
                    
                    <div class="admin-controls">
                        <button class="admin-btn" id="resetAllBtn">T√ºm Kullanƒ±cƒ± ƒ∞statistiklerini Sƒ±fƒ±rla</button>
                        <button class="admin-btn" id="resetReferralsBtn">T√ºm Referanslarƒ± Sƒ±fƒ±rla</button>
                        <button class="admin-btn danger" id="deleteAllBtn">T√ºm Kullanƒ±cƒ± Verilerini Sil</button>
                        <button class="admin-btn" id="refreshStatsBtn">ƒ∞statistikleri Yenile</button>
                    </div>
                </div>
                
                <div class="admin-content" id="withdrawalsTab">
                    <h4>Bekleyen √áekim Talepleri</h4>
                    <div class="withdrawals-list" id="withdrawalsList">
                        <p>√áekim talebi bulunmamaktadƒ±r.</p>
                    </div>
                    
                    <div class="admin-controls">
                        <button class="admin-btn" id="refreshWithdrawalsBtn">√áekim Taleplerini Yenile</button>
                        <button class="admin-btn" id="approveAllWithdrawalsBtn">T√ºm√ºn√º Onayla</button>
                    </div>
                </div>
                
                <div class="admin-content" id="usersTab">
                    <h4>Kullanƒ±cƒ± Listesi</h4>
                    <div class="user-list" id="userList">
                        <p>Kullanƒ±cƒ± y√ºkleniyor...</p>
                    </div>
                    
                    <div class="admin-controls">
                        <button class="admin-btn" id="refreshUsersBtn">Kullanƒ±cƒ±larƒ± Yenile</button>
                        <button class="admin-btn" id="exportUsersBtn">Kullanƒ±cƒ±larƒ± Dƒ±≈üa Aktar</button>
                    </div>
                </div>
                
                <div class="admin-content" id="settingsTab">
                    <h4>Sistem Ayarlarƒ±</h4>
                    <div class="admin-stats">
                        <p><strong>Bot Durumu:</strong> <span id="botStatus">Aktif</span></p>
                        <p><strong>Bakƒ±m Modu:</strong> <span id="maintenanceStatus">Kapalƒ±</span></p>
                        <p><strong>Reklam Durumu:</strong> <span id="adStatus">Aktif</span></p>
                    </div>
                    
                    <div class="admin-controls">
                        <button class="admin-btn" id="toggleMaintenanceBtn">Bakƒ±m Modunu A√ß/Kapat</button>
                        <button class="admin-btn" id="toggleBotBtn">Botu Aktif/Pasif Yap</button>
                        <button class="admin-btn" id="toggleAdsBtn">Reklamlarƒ± A√ß/Kapat</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Withdraw View -->
        <div id="withdraw-view" class="view">
            <div class="header"><h1>√áekim Yap</h1><p>Kazancƒ±nƒ±zƒ± talep edin</p></div>
            <div class="card">
                <h2>Bakiyeniz</h2>
                <div class="balance-amount" id="withdrawBalanceDisplay">USDT 0.00</div>
                <p style="color: var(--tg-theme-hint-color); margin-top: 15px;">Minimum √ßekim miktarƒ± 0.50 USDT'dir.</p>
            </div>
            <div class="card">
                <h2>√ñdeme Detaylarƒ±</h2>
                <div class="input-group">
                    <label for="paymentAddress">USDT C√ºzdan Adresiniz (TRC20)</label>
                    <input type="text" id="paymentAddress" placeholder="√∂rn: T... (TRC20 Adresi)">
                </div>
                <button class="btn" id="finalWithdrawBtn" disabled>√áekim Yap</button>
            </div>
        </div>
        
        <!-- Referral View -->
        <div id="referral-view" class="view">
            <div class="header"><h1>Referanslar</h1><p>Arkada≈ülarƒ±nƒ± davet et ve daha fazla kazan!</p></div>
            <div class="card">
                <h2>Referans ƒ∞statistikleriniz</h2>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="referralCountDisplay">0</h3><p>Toplam Referans</p></div>
                    <div class="ad-info-item"><h3 id="referralBonusDisplay">USDT 0.00</h3><p>Referans Kazancƒ±</p></div>
                </div>
            </div>
            
            <!-- Manuel Referans Giri≈ü Kutusu -->
            <div class="card">
                <h2>Referans Kodunu Girin</h2>
                <p>Eƒüer birisi sizi referans ettiyse, bonus almak i√ßin kodunu buraya girin!</p>
                <div class="referral-input-container">
                    <div class="referral-input-group">
                        <input type="text" id="referralCodeInput" placeholder="Referans kodunu girin">
                        <button id="submitReferralBtn">G√∂nder</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Referans Kodunuz</h2>
                <p>Bu kodu arkada≈ülarƒ±nƒ±zla payla≈üƒ±n. Katƒ±lan her onaylanmƒ±≈ü arkada≈ü i√ßin 0.02 USDT kazanƒ±rsƒ±nƒ±z!</p>
                <div class="referral-code-box" id="referralCodeBox" title="Kopyalamak i√ßin tƒ±klayƒ±n">
                    <span id="userReferralCode">Y√ºkleniyor...</span>
                </div>
                <p style="font-size:12px; color:var(--tg-theme-hint-color); margin-top:15px;">Kodu kopyalamak i√ßin yukarƒ±daki kutuya tƒ±klayƒ±n</p>
            </div>
        </div>

        <!-- Common Elements -->
        <div class="status-message" id="statusMessage"></div>
    </div>

    <!-- Footer Navigation -->
    <footer class="footer-nav">
        <button class="nav-btn active" id="navHome"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>Ana Sayfa</span></button>
        <button class="nav-btn" id="navWithdraw"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.31 8.91a1 1 0 0 0-1.42 0l-4.24 4.24-2.12-2.12a1 1 0 1 0-1.42 1.42l2.83 2.83a1 1 0 0 0 1.42 0l5-5a1 1 0 0 0 0-1.42zM20 12a8 8 0 1 1-8-8 8 8 0 0 1 8 8zm-2 0a6 6 0 1 0-6 6 6 6 0 0 0 6-6z"/></svg></span><span>√áekim</span></button>
        <button class="nav-btn" id="navRefer"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V18h14v-1.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V18h6v-1.5c0-2.33-4.67-3.5-7-3.5z"/></svg></span><span>Referanslar</span></button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tg = window.Telegram.WebApp;

            // --- DOM Elements ---
            const balanceDisplay = document.getElementById('balanceDisplay'), 
                  adCountDisplay = document.getElementById('adCountDisplay'),
                  dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay'), 
                  rewardedBtn = document.getElementById('rewardedBtn'),
                  mainWithdrawBtn = document.getElementById('mainWithdrawBtn'), 
                  statusMessage = document.getElementById('statusMessage'),
                  withdrawBalanceDisplay = document.getElementById('withdrawBalanceDisplay'), 
                  paymentAddressInput = document.getElementById('paymentAddress'),
                  finalWithdrawBtn = document.getElementById('finalWithdrawBtn'), 
                  referralCountDisplay = document.getElementById('referralCountDisplay'), 
                  referralBonusDisplay = document.getElementById('referralBonusDisplay'), 
                  adminPanel = document.getElementById('adminPanel'), 
                  userInfoDisplay = document.getElementById('userInfo'), 
                  referralCodeInput = document.getElementById('referralCodeInput'), 
                  submitReferralBtn = document.getElementById('submitReferralBtn'), 
                  userReferralCodeDisplay = document.getElementById('userReferralCode'),
                  referralCodeBox = document.getElementById('referralCodeBox'), 
                  usdtPriceDisplay = document.getElementById('usdtPrice'), 
                  priceChangeDisplay = document.getElementById('priceChange'), 
                  chartPlaceholder = document.getElementById('chartPlaceholder'),
                  totalUsersDisplay = document.getElementById('totalUsers'), 
                  totalAdsDisplay = document.getElementById('totalAds'),
                  totalUSDTDisplay = document.getElementById('totalUSDT'), 
                  totalReferralsDisplay = document.getElementById('totalReferrals'),
                  resetAllBtn = document.getElementById('resetAllBtn'), 
                  resetReferralsBtn = document.getElementById('resetReferralsBtn'),
                  deleteAllBtn = document.getElementById('deleteAllBtn'), 
                  refreshStatsBtn = document.getElementById('refreshStatsBtn'),
                  withdrawalsList = document.getElementById('withdrawalsList'),
                  userList = document.getElementById('userList'),
                  refreshWithdrawalsBtn = document.getElementById('refreshWithdrawalsBtn'),
                  refreshUsersBtn = document.getElementById('refreshUsersBtn'),
                  approveAllWithdrawalsBtn = document.getElementById('approveAllWithdrawalsBtn'),
                  exportUsersBtn = document.getElementById('exportUsersBtn'),
                  toggleMaintenanceBtn = document.getElementById('toggleMaintenanceBtn'),
                  toggleBotBtn = document.getElementById('toggleBotBtn'),
                  toggleAdsBtn = document.getElementById('toggleAdsBtn'),
                  botStatusDisplay = document.getElementById('botStatus'),
                  maintenanceStatusDisplay = document.getElementById('maintenanceStatus'),
                  adStatusDisplay = document.getElementById('adStatus');

            // --- App Constants & Configuration ---
            const ADMIN_IDS = [6357701459, 8401848644, 7904032877];
            const BOT_USERNAME = 'TorreAds_Bot';
            const WEBAPP_URL = 'https://torreads.onrender.com';
            const WITHDRAW_WEBHOOK_URL = 'https://eo3h4zf914hhqv7.m.pipedream.net';
            
            // JSONBin.io Configuration - G√úNCELLENDƒ∞
            const JSONBIN_BIN_ID = '68dcfa1fae596e708f0235a7';
            const JSONBIN_API_KEY = '$2a$10$t0i.TuifzioNY0cd8HzoDOxB94YLcVc.gbHkv.qmFQzFJcbl9uVrK';
            const JSONBIN_BASE_URL = 'https://api.jsonbin.io/v3/b';
            
            const WITHDRAW_THRESHOLD = 0.50;
            const AD_REWARD_CENTS = 0.2; // 0.002 USDT
            const REFERRAL_BONUS_USDT = 0.02; // Referans olana 0.02 USDT
            const REFERRER_BONUS_USDT = 0.02; // Referans verene 0.02 USDT
            const DAILY_AD_LIMIT = 100;

            // --- App State ---
            let state = {
                balanceInCents: 0,
                totalAdCount: 0,
                dailyAdCount: 0,
                lastAdDate: null,
                referralCount: 0,
                referredBy: null,
                hasClaimedReferral: false,
                referralCode: null,
                userId: null,
                referredUsers: [],
                points: 0,
                dailyAdWatchCount: 0,
                lastAdWatchDate: null,
                referrals: [],
                hasJoinedChannel: false,
                hasJoinedGroup: false
            };

            // USDT Price Data
            let usdtPriceData = {
                current: 1.00,
                change: 0.00,
                history: []
            };

            // Admin Data
            let adminData = {
                maintenanceMode: false,
                botActive: true,
                adsActive: true,
                withdrawals: []
            };

            // ---- JSONBin.io Entegrasyonu ----
            class JsonBinManager {
                constructor(binId, apiKey) {
                    this.binId = binId;
                    this.apiKey = apiKey;
                    this.baseUrl = JSONBIN_BASE_URL;
                }

                async loadData() {
                    try {
                        console.log('Loading data from JSONBin...');
                        const response = await fetch(`${this.baseUrl}/${this.binId}/latest`, {
                            method: 'GET',
                            headers: {
                                'X-Master-Key': this.apiKey,
                                'X-Bin-Meta': 'false'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const data = await response.json();
                        console.log('Data loaded successfully:', data);
                        return data;
                    } catch (error) {
                        console.error('Error loading data from JSONBin:', error);
                        return this.getDefaultData();
                    }
                }

                async saveData(data) {
                    try {
                        console.log('Saving data to JSONBin...', data);
                        const response = await fetch(`${this.baseUrl}/${this.binId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Master-Key': this.apiKey
                            },
                            body: JSON.stringify(data)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        console.log('Data saved successfully:', result);
                        return result;
                    } catch (error) {
                        console.error('Error saving data to JSONBin:', error);
                        throw error;
                    }
                }

                getDefaultData() {
                    return {
                        users: {},
                        adminData: {
                            maintenanceMode: false,
                            botActive: true,
                            adsActive: true,
                            withdrawals: []
                        }
                    };
                }
            }

            // JSONBin Manager instance
            const jsonBinManager = new JsonBinManager(JSONBIN_BIN_ID, JSONBIN_API_KEY);

            // ---- Data Management ----
            async function loadUserData() {
                try {
                    const data = await jsonBinManager.loadData();
                    const userId = state.userId.toString();
                    
                    if (data.users && data.users[userId]) {
                        Object.assign(state, data.users[userId]);
                    }
                    
                    if (data.adminData) {
                        Object.assign(adminData, data.adminData);
                    }
                    
                    updateUI();
                    updateAdminPanel();
                    console.log('User data loaded:', state);
                } catch (error) {
                    console.error('Error loading user data:', error);
                    showStatus('Veri y√ºklenirken hata olu≈ütu', 'error');
                }
            }

            async function saveUserData() {
                try {
                    const data = await jsonBinManager.loadData();
                    const userId = state.userId.toString();
                    
                    if (!data.users) data.users = {};
                    data.users[userId] = state;
                    
                    data.adminData = adminData;
                    
                    await jsonBinManager.saveData(data);
                    console.log('User data saved:', state);
                } catch (error) {
                    console.error('Error saving user data:', error);
                    showStatus('Veri kaydedilirken hata olu≈ütu', 'error');
                }
            }

            async function loadAllUsers() {
                try {
                    const data = await jsonBinManager.loadData();
                    return data.users || {};
                } catch (error) {
                    console.error('Error loading all users:', error);
                    return {};
                }
            }

            // ---- Telegram WebApp Initialization ----
            function initTelegramWebApp() {
                tg.expand();
                tg.enableClosingConfirmation();
                tg.BackButton.hide();
                
                // Get user data from Telegram
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    state.userId = user.id;
                    state.firstName = user.first_name || 'Kullanƒ±cƒ±';
                    state.lastName = user.last_name || '';
                    state.username = user.username || '';
                    
                    // Generate referral code if not exists
                    if (!state.referralCode) {
                        state.referralCode = generateReferralCode();
                    }
                    
                    // Check if user is admin
                    if (ADMIN_IDS.includes(state.userId)) {
                        adminPanel.style.display = 'block';
                        userInfoDisplay.textContent = `Admin: ${state.firstName} (ID: ${state.userId})`;
                    }
                    
                    loadUserData();
                } else {
                    showStatus('Telegram kullanƒ±cƒ± bilgileri alƒ±namadƒ±', 'error');
                }
                
                // Check for referral parameter
                const startParam = tg.initDataUnsafe?.start_param;
                if (startParam && !state.referredBy) {
                    state.referredBy = startParam;
                    showStatus(`Referans kodu algƒ±landƒ±: ${startParam}`, 'info');
                    saveUserData();
                }
            }

            // ---- UI Functions ----
            function updateUI() {
                // Update balance and ad counts
                const balanceUSDT = (state.balanceInCents / 100).toFixed(3);
                balanceDisplay.textContent = `USDT ${balanceUSDT}`;
                withdrawBalanceDisplay.textContent = `USDT ${balanceUSDT}`;
                adCountDisplay.textContent = state.totalAdCount;
                dailyAdCountDisplay.textContent = `${state.dailyAdCount} / ${DAILY_AD_LIMIT}`;
                
                // Update referral counts
                referralCountDisplay.textContent = state.referralCount;
                const referralBonusUSDT = (state.referralCount * REFERRAL_BONUS_USDT).toFixed(2);
                referralBonusDisplay.textContent = `USDT ${referralBonusUSDT}`;
                
                // Update referral code display
                userReferralCodeDisplay.textContent = state.referralCode || 'Y√ºkleniyor...';
                
                // Update withdraw button state
                const canWithdraw = (state.balanceInCents / 100) >= WITHDRAW_THRESHOLD;
                mainWithdrawBtn.disabled = !canWithdraw;
                mainWithdrawBtn.textContent = canWithdraw ? 
                    `${balanceUSDT} USDT √áek` : 
                    `√áekim Yapmak ƒ∞√ßin ${WITHDRAW_THRESHOLD} USDT'ye Ula≈ü`;
                
                // Update final withdraw button
                finalWithdrawBtn.disabled = !canWithdraw || !paymentAddressInput.value.trim();
                finalWithdrawBtn.textContent = canWithdraw ? 
                    `${balanceUSDT} USDT √áek` : 
                    `Minimum ${WITHDRAW_THRESHOLD} USDT Gerekli`;
            }

            function showStatus(message, type = 'info') {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message ' + type;
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }

            // ---- Ad Reward System ----
            rewardedBtn.addEventListener('click', async function () {
                if (adminData.maintenanceMode) {
                    showStatus('Sistem bakƒ±m modunda. L√ºtfen daha sonra tekrar deneyin.', 'error');
                    return;
                }
                
                if (!adminData.adsActive) {
                    showStatus('Reklamlar ≈üu anda ge√ßici olarak devre dƒ±≈üƒ±.', 'error');
                    return;
                }
                
                // Check daily limit
                if (state.dailyAdCount >= DAILY_AD_LIMIT) {
                    showStatus('G√ºnl√ºk reklam limitine ula≈ütƒ±nƒ±z. Yarƒ±n tekrar deneyin!', 'error');
                    return;
                }
                
                // Add loading state
                rewardedBtn.classList.add('btn-loading');
                rewardedBtn.disabled = true;
                
                try {
                    // Simulate ad watching
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Update state
                    state.balanceInCents += AD_REWARD_CENTS * 100;
                    state.totalAdCount++;
                    state.dailyAdCount++;
                    
                    // Reset daily count if it's a new day
                    const today = new Date().toDateString();
                    if (state.lastAdDate !== today) {
                        state.dailyAdCount = 1;
                        state.lastAdDate = today;
                    }
                    
                    // Save data and update UI
                    await saveUserData();
                    updateUI();
                    
                    showStatus(`Tebrikler! ${AD_REWARD_CENTS} USDT kazandƒ±nƒ±z!`, 'success');
                    
                } catch (error) {
                    console.error('Error processing ad reward:', error);
                    showStatus('Reklam izlenirken bir hata olu≈ütu', 'error');
                } finally {
                    rewardedBtn.classList.remove('btn-loading');
                    rewardedBtn.disabled = false;
                }
            });

            // ---- Withdrawal System ----
            mainWithdrawBtn.addEventListener('click', function () {
                if ((state.balanceInCents / 100) >= WITHDRAW_THRESHOLD) {
                    showView('withdraw-view');
                }
            });

            paymentAddressInput.addEventListener('input', function () {
                finalWithdrawBtn.disabled = (state.balanceInCents / 100) < WITHDRAW_THRESHOLD || !this.value.trim();
            });

            finalWithdrawBtn.addEventListener('click', async function () {
                const amount = state.balanceInCents / 100;
                const address = paymentAddressInput.value.trim();
                
                if (amount < WITHDRAW_THRESHOLD) {
                    showStatus(`Minimum √ßekim miktarƒ± ${WITHDRAW_THRESHOLD} USDT'dir`, 'error');
                    return;
                }
                
                if (!address) {
                    showStatus('L√ºtfen USDT c√ºzdan adresinizi girin', 'error');
                    return;
                }
                
                // Add loading state
                finalWithdrawBtn.classList.add('btn-loading');
                finalWithdrawBtn.disabled = true;
                
                try {
                    // Create withdrawal record
                    const withdrawal = {
                        id: Date.now().toString(),
                        userId: state.userId,
                        username: state.username || `${state.firstName} ${state.lastName}`.trim(),
                        amount: amount,
                        address: address,
                        timestamp: new Date().toISOString(),
                        status: 'pending'
                    };
                    
                    // Add to admin withdrawals list
                    adminData.withdrawals.push(withdrawal);
                    
                    // Reset user balance
                    state.balanceInCents = 0;
                    
                    // Save data
                    await saveUserData();
                    
                    // Update UI
                    updateUI();
                    showStatus(`√áekim talebiniz alƒ±ndƒ±: ${amount} USDT. Onaylandƒ±ktan sonra √∂demeniz yapƒ±lacak.`, 'success');
                    
                    // Return to home view
                    setTimeout(() => {
                        showView('home-view');
                        paymentAddressInput.value = '';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error processing withdrawal:', error);
                    showStatus('√áekim i≈ülemi sƒ±rasƒ±nda bir hata olu≈ütu', 'error');
                } finally {
                    finalWithdrawBtn.classList.remove('btn-loading');
                    finalWithdrawBtn.disabled = false;
                }
            });

            // ---- Referral System ----
            submitReferralBtn.addEventListener('click', async function () {
                const referralCode = referralCodeInput.value.trim();
                
                if (!referralCode) {
                    showStatus('L√ºtfen bir referans kodu girin', 'error');
                    return;
                }
                
                if (state.referredBy) {
                    showStatus('Zaten bir referans kodu kullandƒ±nƒ±z', 'error');
                    return;
                }
                
                // Add loading state
                submitReferralBtn.classList.add('btn-loading');
                submitReferralBtn.disabled = true;
                
                try {
                    // Load all users to find the referrer
                    const allUsers = await loadAllUsers();
                    let referrerFound = false;
                    
                    for (const userId in allUsers) {
                        const user = allUsers[userId];
                        if (user.referralCode === referralCode && parseInt(userId) !== state.userId) {
                            // Update current user
                            state.referredBy = referralCode;
                            
                            // Update referrer's data
                            user.referralCount = (user.referralCount || 0) + 1;
                            user.balanceInCents = (user.balanceInCents || 0) + (REFERRER_BONUS_USDT * 100);
                            
                            // Save both users
                            allUsers[state.userId.toString()] = state;
                            await jsonBinManager.saveData({ users: allUsers, adminData });
                            
                            referrerFound = true;
                            break;
                        }
                    }
                    
                    if (referrerFound) {
                        showStatus('Referans kodunuz ba≈üarƒ±yla kaydedildi! Bonusunuz hesabƒ±nƒ±za eklendi.', 'success');
                        referralCodeInput.value = '';
                        updateUI();
                    } else {
                        showStatus('Ge√ßersiz referans kodu', 'error');
                    }
                    
                } catch (error) {
                    console.error('Error processing referral:', error);
                    showStatus('Referans i≈ülemi sƒ±rasƒ±nda bir hata olu≈ütu', 'error');
                } finally {
                    submitReferralBtn.classList.remove('btn-loading');
                    submitReferralBtn.disabled = false;
                }
            });

            // Copy referral code
            referralCodeBox.addEventListener('click', function () {
                if (state.referralCode) {
                    navigator.clipboard.writeText(state.referralCode).then(() => {
                        showStatus('Referans kodu panoya kopyalandƒ±!', 'success');
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        showStatus('Kopyalama ba≈üarƒ±sƒ±z', 'error');
                    });
                }
            });

            // ---- Navigation ----
            function showView(viewId) {
                document.querySelectorAll('.view').forEach(view => {
                    view.style.display = 'none';
                });
                document.getElementById(viewId).style.display = 'block';
                
                // Update nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (viewId === 'home-view') document.getElementById('navHome').classList.add('active');
                if (viewId === 'withdraw-view') document.getElementById('navWithdraw').classList.add('active');
                if (viewId === 'referral-view') document.getElementById('navRefer').classList.add('active');
            }

            document.getElementById('navHome').addEventListener('click', () => showView('home-view'));
            document.getElementById('navWithdraw').addEventListener('click', () => showView('withdraw-view'));
            document.getElementById('navRefer').addEventListener('click', () => showView('referral-view'));

            // ---- USDT Price Simulation ----
            function updateUSDTPrice() {
                // Simulate small price fluctuations around $1.00
                const change = (Math.random() - 0.5) * 0.002; // -0.1% to +0.1%
                usdtPriceData.current = 1.00 + change;
                usdtPriceData.change = change * 100;
                
                // Update display
                usdtPriceDisplay.textContent = usdtPriceData.current.toFixed(4);
                priceChangeDisplay.textContent = `${usdtPriceData.change >= 0 ? '+' : ''}${usdtPriceData.change.toFixed(2)}%`;
                priceChangeDisplay.className = `price-change ${usdtPriceData.change >= 0 ? 'positive' : 'negative'}`;
                
                // Add to history for chart simulation
                usdtPriceData.history.push(usdtPriceData.current);
                if (usdtPriceData.history.length > 20) {
                    usdtPriceData.history.shift();
                }
                
                // Update chart placeholder text
                chartPlaceholder.textContent = `USDT Fiyatƒ±: $${usdtPriceData.current.toFixed(4)} (${usdtPriceData.change >= 0 ? '+' : ''}${usdtPriceData.change.toFixed(2)}%)`;
            }

            // Update price every 30 seconds
            setInterval(updateUSDTPrice, 30000);
            updateUSDTPrice(); // Initial update

            // ---- Admin Functions ----
            function updateAdminPanel() {
                // Update status displays
                botStatusDisplay.textContent = adminData.botActive ? 'Aktif' : 'Pasif';
                maintenanceStatusDisplay.textContent = adminData.maintenanceMode ? 'A√ßƒ±k' : 'Kapalƒ±';
                adStatusDisplay.textContent = adminData.adsActive ? 'Aktif' : 'Kapalƒ±';
                
                // Update button texts
                toggleMaintenanceBtn.textContent = adminData.maintenanceMode ? 'Bakƒ±m Modunu Kapat' : 'Bakƒ±m Modunu A√ß';
                toggleBotBtn.textContent = adminData.botActive ? 'Botu Pasif Yap' : 'Botu Aktif Yap';
                toggleAdsBtn.textContent = adminData.adsActive ? 'Reklamlarƒ± Kapat' : 'Reklamlarƒ± A√ß';
            }

            // Admin tab switching
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.admin-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });

            // Admin control buttons
            refreshStatsBtn.addEventListener('click', refreshAdminStats);
            resetAllBtn.addEventListener('click', resetAllUserStats);
            resetReferralsBtn.addEventListener('click', resetAllReferrals);
            deleteAllBtn.addEventListener('click', deleteAllUserData);
            refreshWithdrawalsBtn.addEventListener('click', refreshWithdrawals);
            refreshUsersBtn.addEventListener('click', refreshUserList);
            approveAllWithdrawalsBtn.addEventListener('click', approveAllWithdrawals);
            exportUsersBtn.addEventListener('click', exportUserData);
            toggleMaintenanceBtn.addEventListener('click', toggleMaintenanceMode);
            toggleBotBtn.addEventListener('click', toggleBotStatus);
            toggleAdsBtn.addEventListener('click', toggleAdsStatus);

            async function refreshAdminStats() {
                try {
                    const allUsers = await loadAllUsers();
                    let totalUsers = 0, totalAds = 0, totalUSDT = 0, totalReferrals = 0;
                    
                    for (const userId in allUsers) {
                        const user = allUsers[userId];
                        totalUsers++;
                        totalAds += user.totalAdCount || 0;
                        totalUSDT += (user.balanceInCents || 0) / 100;
                        totalReferrals += user.referralCount || 0;
                    }
                    
                    totalUsersDisplay.textContent = totalUsers;
                    totalAdsDisplay.textContent = totalAds;
                    totalUSDTDisplay.textContent = totalUSDT.toFixed(2);
                    totalReferralsDisplay.textContent = totalReferrals;
                    totalWithdrawalsDisplay.textContent = adminData.withdrawals.length;
                    
                    showStatus('ƒ∞statistikler g√ºncellendi', 'success');
                } catch (error) {
                    console.error('Error refreshing admin stats:', error);
                    showStatus('ƒ∞statistikler y√ºklenirken hata olu≈ütu', 'error');
                }
            }

            async function resetAllUserStats() {
                if (!confirm('T√úM kullanƒ±cƒ± istatistiklerini sƒ±fƒ±rlamak istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                    return;
                }
                
                try {
                    const allUsers = await loadAllUsers();
                    
                    for (const userId in allUsers) {
                        const user = allUsers[userId];
                        user.balanceInCents = 0;
                        user.totalAdCount = 0;
                        user.dailyAdCount = 0;
                        user.points = 0;
                    }
                    
                    await jsonBinManager.saveData({ users: allUsers, adminData });
                    showStatus('T√ºm kullanƒ±cƒ± istatistikleri sƒ±fƒ±rlandƒ±', 'success');
                    refreshAdminStats();
                } catch (error) {
                    console.error('Error resetting user stats:', error);
                    showStatus('ƒ∞statistikler sƒ±fƒ±rlanƒ±rken hata olu≈ütu', 'error');
                }
            }

            async function resetAllReferrals() {
                if (!confirm('T√úM referans verilerini sƒ±fƒ±rlamak istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                    return;
                }
                
                try {
                    const allUsers = await loadAllUsers();
                    
                    for (const userId in allUsers) {
                        const user = allUsers[userId];
                        user.referralCount = 0;
                        user.referredBy = null;
                        user.hasClaimedReferral = false;
                    }
                    
                    await jsonBinManager.saveData({ users: allUsers, adminData });
                    showStatus('T√ºm referans verileri sƒ±fƒ±rlandƒ±', 'success');
                    refreshAdminStats();
                } catch (error) {
                    console.error('Error resetting referrals:', error);
                    showStatus('Referanslar sƒ±fƒ±rlanƒ±rken hata olu≈ütu', 'error');
                }
            }

            async function deleteAllUserData() {
                if (!confirm('T√úM kullanƒ±cƒ± verilerini silmek istediƒüinizden emin misiniz? Bu i≈ülem GERƒ∞ ALINAMAZ!')) {
                    return;
                }
                
                try {
                    await jsonBinManager.saveData({ users: {}, adminData });
                    showStatus('T√ºm kullanƒ±cƒ± verileri silindi', 'success');
                    refreshAdminStats();
                } catch (error) {
                    console.error('Error deleting user data:', error);
                    showStatus('Veriler silinirken hata olu≈ütu', 'error');
                }
            }

            async function refreshWithdrawals() {
                try {
                    const pendingWithdrawals = adminData.withdrawals.filter(w => w.status === 'pending');
                    
                    if (pendingWithdrawals.length === 0) {
                        withdrawalsList.innerHTML = '<p>Bekleyen √ßekim talebi bulunmamaktadƒ±r.</p>';
                    } else {
                        withdrawalsList.innerHTML = pendingWithdrawals.map(withdrawal => `
                            <div class="withdrawal-item">
                                <p><strong>Kullanƒ±cƒ±:</strong> ${withdrawal.username} (ID: ${withdrawal.userId})</p>
                                <p><strong>Miktar:</strong> ${withdrawal.amount} USDT</p>
                                <p><strong>Adres:</strong> ${withdrawal.address}</p>
                                <p><strong>Tarih:</strong> ${new Date(withdrawal.timestamp).toLocaleString()}</p>
                                <button class="admin-btn" onclick="approveWithdrawal('${withdrawal.id}')">Onayla</button>
                                <button class="admin-btn danger" onclick="rejectWithdrawal('${withdrawal.id}')">Reddet</button>
                            </div>
                        `).join('');
                    }
                    
                    showStatus('√áekim talepleri g√ºncellendi', 'success');
                } catch (error) {
                    console.error('Error refreshing withdrawals:', error);
                    showStatus('√áekim talepleri y√ºklenirken hata olu≈ütu', 'error');
                }
            }

            async function refreshUserList() {
                try {
                    const allUsers = await loadAllUsers();
                    const userListArray = Object.entries(allUsers).slice(0, 50); // Show first 50 users
                    
                    if (userListArray.length === 0) {
                        userList.innerHTML = '<p>Kayƒ±tlƒ± kullanƒ±cƒ± bulunmamaktadƒ±r.</p>';
                    } else {
                        userList.innerHTML = userListArray.map(([userId, user]) => `
                            <div class="user-item">
                                <p><strong>ID:</strong> ${userId}</p>
                                <p><strong>Ad:</strong> ${user.firstName || 'Bilinmiyor'} ${user.lastName || ''}</p>
                                <p><strong>Kullanƒ±cƒ± Adƒ±:</strong> ${user.username || 'Yok'}</p>
                                <p><strong>Bakiye:</strong> <span class="user-balance">USDT ${((user.balanceInCents || 0) / 100).toFixed(2)}</span></p>
                                <p><strong>Reklamlar:</strong> ${user.totalAdCount || 0}</p>
                                <p><strong>Referanslar:</strong> ${user.referralCount || 0}</p>
                            </div>
                        `).join('');
                    }
                    
                    showStatus('Kullanƒ±cƒ± listesi g√ºncellendi', 'success');
                } catch (error) {
                    console.error('Error refreshing user list:', error);
                    showStatus('Kullanƒ±cƒ± listesi y√ºklenirken hata olu≈ütu', 'error');
                }
            }

            async function approveAllWithdrawals() {
                if (!confirm('T√ºm bekleyen √ßekim taleplerini onaylamak istediƒüinizden emin misiniz?')) {
                    return;
                }
                
                try {
                    for (const withdrawal of adminData.withdrawals) {
                        if (withdrawal.status === 'pending') {
                            withdrawal.status = 'approved';
                            withdrawal.approvedAt = new Date().toISOString();
                        }
                    }
                    
                    await saveUserData();
                    showStatus('T√ºm √ßekim talepleri onaylandƒ±', 'success');
                    refreshWithdrawals();
                } catch (error) {
                    console.error('Error approving withdrawals:', error);
                    showStatus('√áekim talepleri onaylanƒ±rken hata olu≈ütu', 'error');
                }
            }

            async function exportUserData() {
                try {
                    const allUsers = await loadAllUsers();
                    const csvContent = Object.entries(allUsers).map(([userId, user]) => 
                        `${userId},${user.firstName || ''},${user.lastName || ''},${user.username || ''},${((user.balanceInCents || 0) / 100).toFixed(2)},${user.totalAdCount || 0},${user.referralCount || 0}`
                    ).join('\n');
                    
                    const blob = new Blob(['User ID,First Name,Last Name,Username,Balance,Total Ads,Referrals\n' + csvContent], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `torreads_users_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showStatus('Kullanƒ±cƒ± verileri dƒ±≈üa aktarƒ±ldƒ±', 'success');
                } catch (error) {
                    console.error('Error exporting user data:', error);
                    showStatus('Veriler dƒ±≈üa aktarƒ±lƒ±rken hata olu≈ütu', 'error');
                }
            }

            async function toggleMaintenanceMode() {
                adminData.maintenanceMode = !adminData.maintenanceMode;
                await saveUserData();
                updateAdminPanel();
                showStatus(`Bakƒ±m modu ${adminData.maintenanceMode ? 'a√ßƒ±ldƒ±' : 'kapatƒ±ldƒ±'}`, 'success');
            }

            async function toggleBotStatus() {
                adminData.botActive = !adminData.botActive;
                await saveUserData();
                updateAdminPanel();
                showStatus(`Bot ${adminData.botActive ? 'aktif edildi' : 'pasif edildi'}`, 'success');
            }

            async function toggleAdsStatus() {
                adminData.adsActive = !adminData.adsActive;
                await saveUserData();
                updateAdminPanel();
                showStatus(`Reklamlar ${adminData.adsActive ? 'a√ßƒ±ldƒ±' : 'kapatƒ±ldƒ±'}`, 'success');
            }

            // Global functions for withdrawal actions (needed for inline onclick handlers)
            window.approveWithdrawal = async function(withdrawalId) {
                try {
                    const withdrawal = adminData.withdrawals.find(w => w.id === withdrawalId);
                    if (withdrawal) {
                        withdrawal.status = 'approved';
                        withdrawal.approvedAt = new Date().toISOString();
                        await saveUserData();
                        showStatus('√áekim talebi onaylandƒ±', 'success');
                        refreshWithdrawals();
                    }
                } catch (error) {
                    console.error('Error approving withdrawal:', error);
                    showStatus('√áekim onaylanƒ±rken hata olu≈ütu', 'error');
                }
            };

            window.rejectWithdrawal = async function(withdrawalId) {
                try {
                    const withdrawal = adminData.withdrawals.find(w => w.id === withdrawalId);
                    if (withdrawal) {
                        withdrawal.status = 'rejected';
                        await saveUserData();
                        showStatus('√áekim talebi reddedildi', 'success');
                        refreshWithdrawals();
                    }
                } catch (error) {
                    console.error('Error rejecting withdrawal:', error);
                    showStatus('√áekim reddedilirken hata olu≈ütu', 'error');
                }
            };

            // ---- Utility Functions ----
            function generateReferralCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = '';
                for (let i = 0; i < 8; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }

            // ---- Initialize App ----
            initTelegramWebApp();
        });
    </script>
</body>
</html>
