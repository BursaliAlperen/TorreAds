<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TorreAds</title>
    
    <!-- GigaPub SDK -->
    <script src="https://ad.gigapub.tech/script?id=986"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --tg-theme-bg-color: #f5f9ff; --tg-theme-text-color: #1a365d; --tg-theme-button-color: #2c7be5;
            --tg-theme-button-text-color: #ffffff; --tg-theme-hint-color: #5a7ba7; --success-color: #00d97e;
            --warning-color: #f6c343; --danger-color: #e63757; --secondary-bg-color: #ffffff; --border-color: #d1e3ff;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0;
            padding: 20px 15px 90px 15px; background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
            display: flex; flex-direction: column; align-items: center; text-align: center; min-height: 100vh; box-sizing: border-box;
        }
        .container { width: 100%; max-width: 500px; }
        .view { display: none; width: 100%; animation: fadeIn 0.3s ease-in-out; }
        #home-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { margin-bottom: 25px; position: relative; }
        .header h1 { font-size: 32px; font-weight: 700; margin-bottom: 5px; color: #1a365d; }
        .header p { color: var(--tg-theme-hint-color); font-size: 16px; }
        .card {
            background-color: var(--secondary-bg-color); padding: 25px; border-radius: 16px; margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0, 123, 255, 0.1); border: 1px solid var(--border-color);
        }
        .card h2 {
            margin: 0 0 12px 0; font-size: 16px; color: var(--tg-theme-hint-color); font-weight: 500;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .balance-amount { font-size: 42px; font-weight: 700; color: #1a365d; margin-bottom: 10px; }
        .ad-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; }
        .ad-info-item h3 { font-size: 20px; font-weight: 600; margin: 0 0 5px 0; color: #1a365d; }
        .ad-info-item p { font-size: 14px; color: var(--tg-theme-hint-color); margin: 0; }
        .ad-buttons { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        .btn {
            width: 100%; padding: 16px; font-size: 18px; font-weight: 600; border: none; border-radius: 12px; cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9); color: var(--tg-theme-button-text-color);
            box-shadow: 0 4px 10px rgba(44, 123, 229, 0.2);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(44, 123, 229, 0.3); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #c5d9ff; color: #8ba7d0; cursor: not-allowed; box-shadow: none; transform: none; }
        #mainWithdrawBtn { background: linear-gradient(145deg, var(--success-color), #00b86c); box-shadow: 0 4px 10px rgba(0, 217, 126, 0.2); }
        #mainWithdrawBtn:disabled { background: #c5d9ff; box-shadow: none; }
        .status-message {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 480px;
            padding: 12px 15px; border-radius: 10px; font-weight: 500; display: none; animation: fadeIn 0.3s;
            z-index: 1000; box-sizing: border-box;
        }
        .success { display: block; background-color: rgba(0, 217, 126, 0.15); border-left: 5px solid var(--success-color); color: #008a50; }
        .error { display: block; background-color: rgba(230, 55, 87, 0.15); border-left: 5px solid var(--danger-color); color: #c41a3a; }
        .info { display: block; background-color: rgba(44, 123, 229, 0.15); border-left: 5px solid var(--tg-theme-button-color); color: #1a6fd9; }
        .footer-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--secondary-bg-color); display: flex;
            justify-content: space-around; padding: 10px 0; box-shadow: 0 -4px 12px rgba(0, 123, 255, 0.1);
            border-top: 1px solid var(--border-color); z-index: 999;
        }
        .nav-btn {
            background: none; border: none; color: var(--tg-theme-hint-color); display: flex; flex-direction: column;
            align-items: center; font-size: 12px; font-weight: 500; cursor: pointer; padding: 5px 15px;
            border-radius: 12px; transition: color 0.2s, background-color 0.2s;
        }
        .nav-btn.active { color: var(--tg-theme-button-color); }
        .nav-btn:hover:not(.active) { color: #1a365d; }
        .nav-btn .icon { width: 28px; height: 28px; margin-bottom: 4px; }
        
        .admin-header-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(145deg, var(--warning-color), #e6b400);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--tg-theme-hint-color); font-size: 14px; font-weight: 500; }
        .input-group input, .input-group textarea {
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--border-color);
            background-color: #f5f9ff; color: var(--tg-theme-text-color); font-size: 16px; box-sizing: border-box;
        }
        .input-group input:focus, .input-group textarea:focus { outline: none; border-color: var(--tg-theme-button-color); box-shadow: 0 0 0 3px rgba(44, 123, 229, 0.2); }
        
        .referral-input-container {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-bg-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .referral-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .referral-input-group input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: #f5f9ff;
            color: var(--tg-theme-text-color);
        }
        
        .referral-input-group button {
            padding: 12px 20px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .referral-code-box {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--tg-theme-hint-color);
            margin-top: 15px;
            cursor: pointer;
            color: #1a365d;
            transition: background-color 0.2s;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
        }
        
        .referral-code-box:hover {
            background-color: #e1efff;
        }
        
        #admin-view { display: none; }
        
        .admin-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .admin-stat-card {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .admin-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }
        
        .admin-stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            text-transform: uppercase;
        }
        
        .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .admin-control-btn {
            padding: 12px;
            background: linear-gradient(145deg, var(--warning-color), #e6b400);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .admin-control-btn.danger {
            background: linear-gradient(145deg, var(--danger-color), #c41a3a);
        }
        
        .admin-user-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            text-align: left;
        }
        
        .admin-user-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-user-info {
            flex: 1;
        }
        
        .admin-user-id {
            font-weight: bold;
            color: #1a365d;
        }
        
        .admin-user-balance {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .admin-user-actions {
            display: flex;
            gap: 5px;
        }
        
        .admin-action-btn {
            padding: 5px 10px;
            background-color: var(--tg-theme-button-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        #tasks-view { display: none; }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .task-item {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-info {
            flex: 1;
            text-align: left;
        }
        
        .task-title {
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }
        
        .task-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }
        
        .task-reward {
            font-weight: bold;
            color: var(--success-color);
        }
        
        .task-btn {
            padding: 8px 15px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #1a6fd9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        #about-view { display: none; }
        
        .about-content {
            text-align: left;
            line-height: 1.6;
        }
        
        .about-section {
            margin-bottom: 20px;
        }
        
        .about-section h3 {
            color: #1a365d;
            margin-bottom: 10px;
        }
        
        .about-section p {
            color: var(--tg-theme-hint-color);
            margin-bottom: 10px;
        }
        
        .withdraw-requests-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            text-align: left;
        }
        
        .withdraw-request-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .withdraw-request-info {
            flex: 1;
        }
        
        .withdraw-request-user {
            font-weight: bold;
            color: #1a365d;
        }
        
        .withdraw-request-details {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .withdraw-request-actions {
            display: flex;
            gap: 5px;
        }
        
        .withdraw-action-btn {
            padding: 5px 10px;
            background-color: var(--tg-theme-button-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .withdraw-action-btn.approve {
            background-color: var(--success-color);
        }
        
        .withdraw-action-btn.reject {
            background-color: var(--danger-color);
        }
        
        .task-creation-form {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-bg-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .form-row .input-group {
            flex: 1;
            margin-bottom: 0;
        }

        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="home-view" class="view">
            <div class="header">
                <h1>TorreAds</h1>
                <p>Reklam İzle ve USDT Kazan</p>
                <button class="admin-header-btn" id="adminHeaderBtn" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                    </svg>
                    Admin
                </button>
            </div>
            
            <div class="card">
                <h2>Mevcut Bakiye</h2>
                <div class="balance-amount" id="balanceDisplay">USDT 0.00</div>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Toplam İzlenen Reklam</p></div>
                    <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0 / 100</h3><p>Bugünkü Reklamlar</p></div>
                </div>
            </div>
            <div class="ad-buttons">
                <button class="btn" id="rewardedBtn">Reklam İzle (+0.002 USDT)</button>
            </div>
            <button class="btn" id="mainWithdrawBtn" disabled>Çekim Yapmak İçin 0.50 USDT'ye Ulaş</button>
        </div>

        <div id="withdraw-view" class="view">
            <div class="header"><h1>Para Çekme</h1><p>Kazancınızı talep edin</p></div>
            <div class="card">
                <h2>Bakiyeniz</h2>
                <div class="balance-amount" id="withdrawBalanceDisplay">USDT 0.00</div>
                <p style="color: var(--tg-theme-hint-color); margin-top: 15px;">Minimum çekim miktarı 0.50 USDT'dir.</p>
            </div>
            <div class="card">
                <h2>Ödeme Detayları</h2>
                <div class="input-group">
                    <label for="paymentAddress">USDT Cüzdan Adresiniz (TRC20)</label>
                    <input type="text" id="paymentAddress" placeholder="örn: T... (TRC20 Adresi)">
                </div>
                <button class="btn" id="finalWithdrawBtn" disabled>Para Çek</button>
            </div>
        </div>
        
        <div id="referral-view" class="view">
            <div class="header"><h1>Referanslar</h1><p>Arkadaşlarını davet et ve daha fazla kazan!</p></div>
            
            <div class="card">
                <h2>Referans İstatistikleriniz</h2>
                <div class="ad-info-grid">
                    <div class="ad-info-item">
                        <h3 id="referralCountDisplay">0</h3>
                        <p>Toplam Referans</p>
                    </div>
                    <div class="ad-info-item">
                        <h3 id="referralBonusDisplay">USDT 0.00</h3>
                        <p>Referans Kazancı</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Referans Kodunu Girin</h2>
                <p>Eğer birisi sizi referans ettiyse, bonus almak için kodunu buraya girin!</p>
                <div class="referral-input-container">
                    <div class="referral-input-group">
                        <input type="text" id="referralCodeInput" placeholder="Referans kodunu girin">
                        <button id="submitReferralBtn">Gönder</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Referans Kodunuz</h2>
                <p>Bu kodu arkadaşlarınızla paylaşın. Katılan her onaylanmış arkadaş için 0.02 USDT kazanırsınız!</p>
                <div class="referral-code-box" id="referralCodeBox" title="Kopyalamak için tıklayın">
                    <span id="userReferralCode">Yükleniyor...</span>
                </div>
                <p style="font-size:12px; color:var(--tg-theme-hint-color); margin-top:15px;">Kodu kopyalamak için üzerine tıklayın</p>
            </div>
            
            <div class="card">
                <h2>Referans Linkiniz</h2>
                <p>Aşağıdaki linki arkadaşlarınızla paylaşarak daha hızlı kazanın!</p>
                <div class="referral-code-box" id="referralLinkBox" title="Kopyalamak için tıklayın">
                    <span id="userReferralLink">Yükleniyor...</span>
                </div>
                <p style="font-size:12px; color:var(--tg-theme-hint-color); margin-top:15px;">Linki kopyalamak için üzerine tıklayın</p>
            </div>
        </div>
        
        <div id="tasks-view" class="view">
            <div class="header"><h1>Görevler</h1><p>Ek görevlerle daha fazla kazanın</p></div>
            
            <div class="card">
                <h2>Mevcut Görevler</h2>
                <div class="task-list" id="manualTasksList">
                </div>
            </div>
            
            <div class="card">
                <h2>Görev İlerlemeniz</h2>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="completedTasks">0</h3><p>Tamamlanan Görevler</p></div>
                    <div class="ad-info-item"><h3 id="taskEarnings">USDT 0.00</h3><p>Görev Kazancı</p></div>
                </div>
            </div>
        </div>
        
        <div id="admin-view" class="view">
            <div class="header"><h1>Admin Paneli</h1><p>Uygulama yönetimi ve kullanıcı kontrolü</p></div>
            
            <div class="card">
                <h2>Genel İstatistikler</h2>
                <div class="admin-stats-grid">
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalUsers">0</div>
                        <div class="admin-stat-label">Toplam Kullanıcı</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalAds">0</div>
                        <div class="admin-stat-label">Toplam Reklam</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalWithdrawals">0</div>
                        <div class="admin-stat-label">Toplam Çekim</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="totalBalance">USDT 0.00</div>
                        <div class="admin-stat-label">Toplam Bakiye</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Kullanıcı Yönetimi</h2>
                <div class="input-group">
                    <label for="userSearch">Kullanıcı Ara (ID veya İsim)</label>
                    <input type="text" id="userSearch" placeholder="Kullanıcı ID veya isim girin">
                </div>
                <button class="btn" id="searchUserBtn">Ara</button>
                
                <div class="admin-user-list" id="adminUserList">
                </div>
            </div>
            
            <div class="card">
                <h2>Görev Yönetimi</h2>
                <div class="task-creation-form">
                    <div class="input-group">
                        <label for="adminTaskTitle">Görev Başlığı</label>
                        <input type="text" id="adminTaskTitle" placeholder="Görev başlığını girin">
                    </div>
                    <div class="input-group">
                        <label for="adminTaskDescription">Görev Açıklaması</label>
                        <textarea id="adminTaskDescription" placeholder="Görev açıklamasını girin" rows="3"></textarea>
                    </div>
                    <div class="input-group">
                        <label for="adminTaskLink">Kanal/Bot Linki</label>
                        <input type="text" id="adminTaskLink" placeholder="https://t.me/kanal_adi">
                    </div>
                    <div class="input-group">
                        <label for="adminTaskReward">Ödül (USDT)</label>
                        <input type="number" id="adminTaskReward" step="0.001" min="0.001" value="0.005">
                    </div>
                    <button class="btn" id="adminAddTaskBtn">Görev Ekle</button>
                </div>
                
                <h3 style="margin-top: 20px;">Mevcut Görevler</h3>
                <div class="task-list" id="adminTasksList">
                </div>
            </div>
            
            <div class="card">
                <h2>Çekim Talepleri</h2>
                <div class="withdraw-requests-list" id="withdrawRequestsList">
                </div>
            </div>
            
            <div class="card">
                <h2>Sistem Ayarları</h2>
                <div class="admin-controls">
                    <button class="admin-control-btn" id="resetAdsBtn">Günlük Reklamları Sıfırla</button>
                    <button class="admin-control-btn" id="updateRewardsBtn">Ödülleri Güncelle</button>
                    <button class="admin-control-btn danger" id="clearDataBtn">Tüm Verileri Temizle</button>
                </div>
            </div>
        </div>
        
        <div id="about-view" class="view">
            <div class="header"><h1>Hakkında</h1><p>TorreAds hakkında bilgiler</p></div>
            
            <div class="card">
                <h2>Uygulama Bilgileri</h2>
                <div class="about-content">
                    <div class="about-section">
                        <h3>TorreAds Nedir?</h3>
                        <p>TorreAds, Telegram kullanıcılarının reklam izleyerek ve görevleri tamamlayarak USDT kazanabileceği bir platformdur.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Nasıl Çalışır?</h3>
                        <p>1. Reklam izleyerek USDT kazanın<br>2. Arkadaşlarınızı davet ederek ekstra kazanın<br>3. Görevleri tamamlayarak kazancınızı artırın<br>4. Bakiyeniz 0.50 USDT'ye ulaştığında çekim yapın</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>İletişim</h3>
                        <p>Herhangi bir sorunuz veya öneriniz varsa, lütfen destek ekibimizle iletişime geçin.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="status-message" id="statusMessage"></div>

    <div class="footer-nav">
        <button class="nav-btn active" data-view="home-view">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            Ana Sayfa
        </button>
        <button class="nav-btn" data-view="referral-view">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
            </svg>
            Referans
        </button>
        <button class="nav-btn" data-view="tasks-view">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
            Görevler
        </button>
        <button class="nav-btn" data-view="about-view">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            Hakkında
        </button>
    </div>

    <script>
        // JSONBIN.IO KONFİGÜRASYONU - YENİ BİN ID VE API KEY
        const JSONBIN_API_KEY = '$2a$10$Fv9Ec7a8u59so/FlxU1buOBqSrJZbj7FD8hxVsGCtRPqxQ6cpXBY.';
        const JSONBIN_BIN_ID = '68de237cae596e708f0333b0';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`;
        const JSONBIN_UPDATE_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        let tg;
        try {
            tg = window.Telegram.WebApp;
            tg.expand();
            tg.enableClosingConfirmation();
            tg.MainButton.hide();
        } catch (error) {
            tg = {
                initDataUnsafe: { user: { id: 'test_user_' + Date.now(), first_name: 'Test User' } }
            };
        }
        
        const ADMIN_USER_IDS = ['8401848644', '7904032877'];
        
        let userData = {
            userId: '',
            balance: 0,
            adCount: 0,
            dailyAdCount: 0,
            lastAdDate: '',
            referralCode: '',
            referredBy: '',
            referrals: [],
            referralBonus: 0,
            completedTasks: [],
            taskEarnings: 0,
            withdrawHistory: [],
            paymentAddress: '',
            firstName: '',
            lastUpdated: Date.now()
        };
        
        let appData = {
            adReward: 0.002,
            minWithdraw: 0.50,
            referralReward: 0.02,
            manualTasks: [],
            withdrawRequests: [],
            users: {},
            lastUpdated: Date.now()
        };
        
        const views = document.querySelectorAll('.view');
        const navButtons = document.querySelectorAll('.nav-btn');
        const statusMessage = document.getElementById('statusMessage');
        const adminHeaderBtn = document.getElementById('adminHeaderBtn');
        
        // Veri senkronizasyonu için değişkenler
        let isDataSyncing = false;
        let lastSyncTime = 0;
        const SYNC_INTERVAL = 30000; // 30 saniyede bir senkronizasyon
        
        async function initApp() {
            const initData = tg.initDataUnsafe || {};
            const user = initData.user || {};
            
            userData.userId = user.id || 'test_user_' + Date.now();
            userData.firstName = user.first_name || 'Kullanıcı';
            
            // Admin kontrolü
            if (ADMIN_USER_IDS.includes(userData.userId.toString())) {
                adminHeaderBtn.style.display = 'flex';
            }
            
            // JSONBin'den verileri yükle
            await loadAppData();
            
            // Eğer kullanıcı verisi yoksa veya güncel değilse, yeni kullanıcı oluştur
            if (!appData.users[userData.userId]) {
                userData.referralCode = generateReferralCode();
                appData.users[userData.userId] = userData;
                await saveAppData();
            } else {
                userData = appData.users[userData.userId];
                userData.lastUpdated = Date.now();
            }
            
            // UI'ı güncelle
            updateUI();
            
            // Reklam butonunu etkinleştir
            document.getElementById('rewardedBtn').addEventListener('click', showRewardedAd);
            
            // Çekim butonlarını etkinleştir
            document.getElementById('mainWithdrawBtn').addEventListener('click', () => showView('withdraw-view'));
            document.getElementById('finalWithdrawBtn').addEventListener('click', processWithdrawal);
            
            // Referans butonlarını etkinleştir
            document.getElementById('submitReferralBtn').addEventListener('click', submitReferralCode);
            document.getElementById('referralCodeBox').addEventListener('click', copyReferralCode);
            document.getElementById('referralLinkBox').addEventListener('click', copyReferralLink);
            
            // Admin butonlarını etkinleştir
            adminHeaderBtn.addEventListener('click', () => showView('admin-view'));
            document.getElementById('searchUserBtn').addEventListener('click', searchUser);
            document.getElementById('adminAddTaskBtn').addEventListener('click', addTask);
            document.getElementById('resetAdsBtn').addEventListener('click', resetAllDailyAds);
            document.getElementById('updateRewardsBtn').addEventListener('click', updateRewards);
            document.getElementById('clearDataBtn').addEventListener('click', clearAllData);
            
            // Navigasyon butonlarını etkinleştir
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const viewId = button.getAttribute('data-view');
                    showView(viewId);
                    
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                });
            });
            
            // Periyodik senkronizasyon başlat
            setInterval(syncData, SYNC_INTERVAL);
            
            // Sayfa yüklendiğinde senkronizasyon yap
            setTimeout(syncData, 2000);
        }
        
        // JSONBin'den verileri yükle
        async function loadAppData() {
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.record) {
                        appData = result.record;
                        console.log('JSONBin verileri başarıyla yüklendi');
                    }
                } else {
                    console.error('JSONBin yükleme hatası:', response.status);
                }
            } catch (error) {
                console.error('JSONBin yükleme hatası:', error);
            }
        }
        
        // JSONBin'e verileri kaydet
        async function saveAppData() {
            if (isDataSyncing) return;
            
            isDataSyncing = true;
            appData.lastUpdated = Date.now();
            
            try {
                const response = await fetch(JSONBIN_UPDATE_URL, {
                    method: 'PUT',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(appData)
                });
                
                if (response.ok) {
                    console.log('JSONBin verileri başarıyla kaydedildi');
                    lastSyncTime = Date.now();
                } else {
                    console.error('JSONBin kaydetme hatası:', response.status);
                }
            } catch (error) {
                console.error('JSONBin kaydetme hatası:', error);
            } finally {
                isDataSyncing = false;
            }
        }
        
        // Veri senkronizasyonu
        async function syncData() {
            if (isDataSyncing) return;
            
            try {
                await loadAppData();
                
                // Kullanıcı verilerini güncelle
                if (appData.users[userData.userId]) {
                    const remoteData = appData.users[userData.userId];
                    
                    // Yerel veriler daha güncelse, uzaktakini güncelle
                    if (userData.lastUpdated > remoteData.lastUpdated) {
                        appData.users[userData.userId] = userData;
                        await saveAppData();
                    } else if (remoteData.lastUpdated > userData.lastUpdated) {
                        // Uzaktaki veriler daha güncelse, yereli güncelle
                        userData = remoteData;
                        updateUI();
                    }
                } else {
                    // Kullanıcı verisi yoksa, ekle
                    appData.users[userData.userId] = userData;
                    await saveAppData();
                }
            } catch (error) {
                console.error('Senkronizasyon hatası:', error);
            }
        }
        
        function updateUI() {
            // Ana sayfa güncellemeleri
            document.getElementById('balanceDisplay').textContent = `USDT ${userData.balance.toFixed(3)}`;
            document.getElementById('adCountDisplay').textContent = userData.adCount;
            document.getElementById('dailyAdCountDisplay').textContent = `${userData.dailyAdCount} / 100`;
            
            // Çekim butonunu güncelle
            const mainWithdrawBtn = document.getElementById('mainWithdrawBtn');
            if (userData.balance >= appData.minWithdraw) {
                mainWithdrawBtn.disabled = false;
                mainWithdrawBtn.textContent = `Para Çek (USDT ${userData.balance.toFixed(3)})`;
            } else {
                mainWithdrawBtn.disabled = true;
                mainWithdrawBtn.textContent = `Çekim Yapmak İçin ${appData.minWithdraw.toFixed(2)} USDT'ye Ulaş`;
            }
            
            // Çekim sayfası güncellemeleri
            document.getElementById('withdrawBalanceDisplay').textContent = `USDT ${userData.balance.toFixed(3)}`;
            const finalWithdrawBtn = document.getElementById('finalWithdrawBtn');
            if (userData.balance >= appData.minWithdraw && userData.paymentAddress) {
                finalWithdrawBtn.disabled = false;
            } else {
                finalWithdrawBtn.disabled = true;
            }
            
            // Referans sayfası güncellemeleri
            document.getElementById('referralCountDisplay').textContent = userData.referrals.length;
            document.getElementById('referralBonusDisplay').textContent = `USDT ${userData.referralBonus.toFixed(3)}`;
            document.getElementById('userReferralCode').textContent = userData.referralCode;
            document.getElementById('userReferralLink').textContent = `https://t.me/torre_ads_bot?start=${userData.referralCode}`;
            
            // Görevler sayfası güncellemeleri
            document.getElementById('completedTasks').textContent = userData.completedTasks.length;
            document.getElementById('taskEarnings').textContent = `USDT ${userData.taskEarnings.toFixed(3)}`;
            updateTasksList();
            
            // Admin paneli güncellemeleri
            updateAdminPanel();
        }
        
        function showView(viewId) {
            views.forEach(view => view.style.display = 'none');
            document.getElementById(viewId).style.display = 'block';
            
            if (viewId === 'admin-view') {
                updateAdminPanel();
            }
        }
        
        function showStatusMessage(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
        
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // GigaPub reklam gösterimi
        function showRewardedAd() {
            const btn = document.getElementById('rewardedBtn');
            btn.classList.add('btn-loading');
            btn.disabled = true;
            
            // Günlük reklam limiti kontrolü
            if (userData.dailyAdCount >= 100) {
                showStatusMessage('Günlük reklam limitine ulaştınız. Yarın tekrar deneyin!', 'error');
                btn.classList.remove('btn-loading');
                btn.disabled = false;
                return;
            }
            
            // Son reklam tarihi kontrolü
            const today = new Date().toDateString();
            if (userData.lastAdDate !== today) {
                userData.dailyAdCount = 0;
                userData.lastAdDate = today;
            }
            
            try {
                // GigaPub reklam gösterimi
                if (window.gigapub) {
                    window.gigapub.showRewardedAd({
                        adUnitId: '986',
                        onReward: () => {
                            // Reklam başarıyla izlendi
                            userData.balance += appData.adReward;
                            userData.adCount++;
                            userData.dailyAdCount++;
                            userData.lastUpdated = Date.now();
                            
                            // JSONBin'e kaydet
                            appData.users[userData.userId] = userData;
                            saveAppData();
                            
                            // UI'ı güncelle
                            updateUI();
                            
                            showStatusMessage(`Tebrikler! ${appData.adReward.toFixed(3)} USDT kazandınız!`, 'success');
                            btn.classList.remove('btn-loading');
                            btn.disabled = false;
                        },
                        onClose: () => {
                            // Reklam kapatıldı
                            btn.classList.remove('btn-loading');
                            btn.disabled = false;
                        },
                        onError: (error) => {
                            // Reklam hatası
                            console.error('Reklam hatası:', error);
                            showStatusMessage('Reklam yüklenirken bir hata oluştu. Lütfen tekrar deneyin.', 'error');
                            btn.classList.remove('btn-loading');
                            btn.disabled = false;
                        }
                    });
                } else {
                    // GigaPub yoksa, test modu
                    setTimeout(() => {
                        userData.balance += appData.adReward;
                        userData.adCount++;
                        userData.dailyAdCount++;
                        userData.lastUpdated = Date.now();
                        
                        // JSONBin'e kaydet
                        appData.users[userData.userId] = userData;
                        saveAppData();
                        
                        // UI'ı güncelle
                        updateUI();
                        
                        showStatusMessage(`Tebrikler! ${appData.adReward.toFixed(3)} USDT kazandınız!`, 'success');
                        btn.classList.remove('btn-loading');
                        btn.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('Reklam gösterim hatası:', error);
                showStatusMessage('Reklam gösterilirken bir hata oluştu. Lütfen tekrar deneyin.', 'error');
                btn.classList.remove('btn-loading');
                btn.disabled = false;
            }
        }
        
        function processWithdrawal() {
            const address = document.getElementById('paymentAddress').value.trim();
            
            if (!address) {
                showStatusMessage('Lütfen geçerli bir USDT cüzdan adresi girin.', 'error');
                return;
            }
            
            if (userData.balance < appData.minWithdraw) {
                showStatusMessage(`Çekim yapmak için en az ${appData.minWithdraw.toFixed(2)} USDT'ye ihtiyacınız var.`, 'error');
                return;
            }
            
            // Çekim talebi oluştur
            const withdrawRequest = {
                userId: userData.userId,
                userName: userData.firstName,
                amount: userData.balance,
                address: address,
                timestamp: Date.now(),
                status: 'pending'
            };
            
            // Çekim talebini kaydet
            appData.withdrawRequests.push(withdrawRequest);
            
            // Kullanıcı bakiyesini sıfırla
            userData.withdrawHistory.push({
                amount: userData.balance,
                address: address,
                timestamp: Date.now(),
                status: 'pending'
            });
            
            userData.balance = 0;
            userData.lastUpdated = Date.now();
            
            // JSONBin'e kaydet
            appData.users[userData.userId] = userData;
            saveAppData();
            
            // UI'ı güncelle
            updateUI();
            
            showStatusMessage('Çekim talebiniz alındı. En kısa sürede işleme alınacaktır.', 'success');
            showView('home-view');
        }
        
        function submitReferralCode() {
            const code = document.getElementById('referralCodeInput').value.trim().toUpperCase();
            
            if (!code) {
                showStatusMessage('Lütfen bir referans kodu girin.', 'error');
                return;
            }
            
            if (userData.referredBy) {
                showStatusMessage('Zaten bir referans kodu kullandınız.', 'error');
                return;
            }
            
            // Kodu kendine kullanma kontrolü
            if (code === userData.referralCode) {
                showStatusMessage('Kendi referans kodunuzu kullanamazsınız.', 'error');
                return;
            }
            
            // Kodu kullanan kullanıcıyı bul
            let referrer = null;
            for (const userId in appData.users) {
                if (appData.users[userId].referralCode === code) {
                    referrer = appData.users[userId];
                    break;
                }
            }
            
            if (!referrer) {
                showStatusMessage('Geçersiz referans kodu.', 'error');
                return;
            }
            
            // Referansı kaydet
            userData.referredBy = referrer.userId;
            referrer.referrals.push(userData.userId);
            referrer.referralBonus += appData.referralReward;
            referrer.balance += appData.referralReward;
            referrer.lastUpdated = Date.now();
            
            // JSONBin'e kaydet
            appData.users[userData.userId] = userData;
            appData.users[referrer.userId] = referrer;
            saveAppData();
            
            // UI'ı güncelle
            updateUI();
            
            showStatusMessage(`Referans kodunuz başarıyla kullanıldı! ${appData.referralReward.toFixed(3)} USDT bonus kazandınız.`, 'success');
            document.getElementById('referralCodeInput').value = '';
        }
        
        function copyReferralCode() {
            const code = userData.referralCode;
            navigator.clipboard.writeText(code).then(() => {
                showStatusMessage('Referans kodu panoya kopyalandı!', 'success');
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showStatusMessage('Referans kodu panoya kopyalandı!', 'success');
            });
        }
        
        function copyReferralLink() {
            const link = `https://t.me/torre_ads_bot?start=${userData.referralCode}`;
            navigator.clipboard.writeText(link).then(() => {
                showStatusMessage('Referans linki panoya kopyalandı!', 'success');
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showStatusMessage('Referans linki panoya kopyalandı!', 'success');
            });
        }
        
        function updateTasksList() {
            const tasksList = document.getElementById('manualTasksList');
            tasksList.innerHTML = '';
            
            appData.manualTasks.forEach((task, index) => {
                const isCompleted = userData.completedTasks.includes(task.id);
                
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                        <div class="task-reward">Ödül: ${task.reward.toFixed(3)} USDT</div>
                    </div>
                    <button class="task-btn" ${isCompleted ? 'disabled' : ''} data-task-id="${task.id}">
                        ${isCompleted ? 'Tamamlandı' : 'Katıl'}
                    </button>
                `;
                
                tasksList.appendChild(taskElement);
                
                // Buton etkinliği ekle
                if (!isCompleted) {
                    const button = taskElement.querySelector('.task-btn');
                    button.addEventListener('click', () => completeTask(task.id, index));
                }
            });
        }
        
        function completeTask(taskId, taskIndex) {
            const task = appData.manualTasks[taskIndex];
            
            // Görevi tamamla
            userData.completedTasks.push(taskId);
            userData.taskEarnings += task.reward;
            userData.balance += task.reward;
            userData.lastUpdated = Date.now();
            
            // JSONBin'e kaydet
            appData.users[userData.userId] = userData;
            saveAppData();
            
            // UI'ı güncelle
            updateUI();
            
            showStatusMessage(`Tebrikler! ${task.reward.toFixed(3)} USDT kazandınız!`, 'success');
        }
        
        function updateAdminPanel() {
            // Genel istatistikler
            document.getElementById('totalUsers').textContent = Object.keys(appData.users).length;
            
            let totalAds = 0;
            let totalBalance = 0;
            let totalWithdrawals = 0;
            
            for (const userId in appData.users) {
                totalAds += appData.users[userId].adCount;
                totalBalance += appData.users[userId].balance;
                totalWithdrawals += appData.users[userId].withdrawHistory.length;
            }
            
            document.getElementById('totalAds').textContent = totalAds;
            document.getElementById('totalWithdrawals').textContent = totalWithdrawals;
            document.getElementById('totalBalance').textContent = `USDT ${totalBalance.toFixed(2)}`;
            
            // Çekim talepleri
            updateWithdrawRequestsList();
            
            // Görev listesi
            updateAdminTasksList();
        }
        
        function updateWithdrawRequestsList() {
            const requestsList = document.getElementById('withdrawRequestsList');
            requestsList.innerHTML = '';
            
            appData.withdrawRequests
                .filter(request => request.status === 'pending')
                .forEach((request, index) => {
                    const requestElement = document.createElement('div');
                    requestElement.className = 'withdraw-request-item';
                    requestElement.innerHTML = `
                        <div class="withdraw-request-info">
                            <div class="withdraw-request-user">${request.userName} (${request.userId})</div>
                            <div class="withdraw-request-details">
                                Miktar: ${request.amount.toFixed(3)} USDT<br>
                                Adres: ${request.address}<br>
                                Tarih: ${new Date(request.timestamp).toLocaleString()}
                            </div>
                        </div>
                        <div class="withdraw-request-actions">
                            <button class="withdraw-action-btn approve" data-index="${index}">Onayla</button>
                            <button class="withdraw-action-btn reject" data-index="${index}">Reddet</button>
                        </div>
                    `;
                    
                    requestsList.appendChild(requestElement);
                    
                    // Buton etkinlikleri
                    requestElement.querySelector('.approve').addEventListener('click', () => approveWithdrawal(index));
                    requestElement.querySelector('.reject').addEventListener('click', () => rejectWithdrawal(index));
                });
        }
        
        function updateAdminTasksList() {
            const tasksList = document.getElementById('adminTasksList');
            tasksList.innerHTML = '';
            
            appData.manualTasks.forEach((task, index) => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                        <div class="task-reward">Ödül: ${task.reward.toFixed(3)} USDT</div>
                        <div class="task-link">Link: ${task.link}</div>
                    </div>
                    <button class="admin-action-btn" data-task-index="${index}">Sil</button>
                `;
                
                tasksList.appendChild(taskElement);
                
                // Sil butonu etkinliği
                taskElement.querySelector('.admin-action-btn').addEventListener('click', () => deleteTask(index));
            });
        }
        
        function searchUser() {
            const searchTerm = document.getElementById('userSearch').value.trim();
            const userList = document.getElementById('adminUserList');
            userList.innerHTML = '';
            
            if (!searchTerm) {
                showStatusMessage('Lütfen bir arama terimi girin.', 'error');
                return;
            }
            
            let foundUsers = [];
            
            for (const userId in appData.users) {
                const user = appData.users[userId];
                if (userId.includes(searchTerm) || user.firstName.toLowerCase().includes(searchTerm.toLowerCase())) {
                    foundUsers.push(user);
                }
            }
            
            if (foundUsers.length === 0) {
                userList.innerHTML = '<div style="text-align: center; color: var(--tg-theme-hint-color); padding: 20px;">Kullanıcı bulunamadı.</div>';
                return;
            }
            
            foundUsers.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'admin-user-item';
                userElement.innerHTML = `
                    <div class="admin-user-info">
                        <div class="admin-user-id">${user.firstName} (${user.userId})</div>
                        <div class="admin-user-balance">
                            Bakiye: ${user.balance.toFixed(3)} USDT | 
                            Reklam: ${user.adCount} | 
                            Referans: ${user.referrals.length}
                        </div>
                    </div>
                    <div class="admin-user-actions">
                        <button class="admin-action-btn add-balance" data-user-id="${user.userId}">+ Bakiye</button>
                        <button class="admin-action-btn reset-ads" data-user-id="${user.userId}">Reklam Sıfırla</button>
                    </div>
                `;
                
                userList.appendChild(userElement);
                
                // Buton etkinlikleri
                userElement.querySelector('.add-balance').addEventListener('click', () => addUserBalance(user.userId));
                userElement.querySelector('.reset-ads').addEventListener('click', () => resetUserAds(user.userId));
            });
        }
        
        function addTask() {
            const title = document.getElementById('adminTaskTitle').value.trim();
            const description = document.getElementById('adminTaskDescription').value.trim();
            const link = document.getElementById('adminTaskLink').value.trim();
            const reward = parseFloat(document.getElementById('adminTaskReward').value);
            
            if (!title || !description || !link || isNaN(reward) || reward <= 0) {
                showStatusMessage('Lütfen tüm alanları doğru şekilde doldurun.', 'error');
                return;
            }
            
            const newTask = {
                id: 'task_' + Date.now(),
                title: title,
                description: description,
                link: link,
                reward: reward
            };
            
            appData.manualTasks.push(newTask);
            saveAppData();
            
            // Formu temizle
            document.getElementById('adminTaskTitle').value = '';
            document.getElementById('adminTaskDescription').value = '';
            document.getElementById('adminTaskLink').value = '';
            document.getElementById('adminTaskReward').value = '0.005';
            
            // UI'ı güncelle
            updateAdminTasksList();
            updateTasksList();
            
            showStatusMessage('Görev başarıyla eklendi!', 'success');
        }
        
        function deleteTask(index) {
            if (confirm('Bu görevi silmek istediğinizden emin misiniz?')) {
                appData.manualTasks.splice(index, 1);
                saveAppData();
                
                // UI'ı güncelle
                updateAdminTasksList();
                updateTasksList();
                
                showStatusMessage('Görev başarıyla silindi!', 'success');
            }
        }
        
        function approveWithdrawal(index) {
            const request = appData.withdrawRequests[index];
            request.status = 'approved';
            
            // Kullanıcının çekim geçmişini güncelle
            if (appData.users[request.userId]) {
                const user = appData.users[request.userId];
                const withdrawRecord = user.withdrawHistory.find(w => 
                    w.timestamp === request.timestamp && w.amount === request.amount
                );
                
                if (withdrawRecord) {
                    withdrawRecord.status = 'approved';
                    user.lastUpdated = Date.now();
                }
            }
            
            saveAppData();
            updateWithdrawRequestsList();
            
            showStatusMessage('Çekim talebi onaylandı!', 'success');
        }
        
        function rejectWithdrawal(index) {
            const request = appData.withdrawRequests[index];
            request.status = 'rejected';
            
            // Kullanıcının bakiyesini geri yükle
            if (appData.users[request.userId]) {
                const user = appData.users[request.userId];
                user.balance += request.amount;
                
                const withdrawRecord = user.withdrawHistory.find(w => 
                    w.timestamp === request.timestamp && w.amount === request.amount
                );
                
                if (withdrawRecord) {
                    withdrawRecord.status = 'rejected';
                }
                
                user.lastUpdated = Date.now();
            }
            
            saveAppData();
            updateWithdrawRequestsList();
            
            showStatusMessage('Çekim talebi reddedildi ve bakiye iade edildi!', 'success');
        }
        
        function addUserBalance(userId) {
            const amount = parseFloat(prompt('Eklemek istediğiniz USDT miktarını girin:'));
            
            if (isNaN(amount) || amount <= 0) {
                showStatusMessage('Geçersiz miktar!', 'error');
                return;
            }
            
            if (appData.users[userId]) {
                appData.users[userId].balance += amount;
                appData.users[userId].lastUpdated = Date.now();
                saveAppData();
                
                showStatusMessage(`${amount.toFixed(3)} USDT kullanıcıya eklendi!`, 'success');
                
                // UI'ı güncelle
                if (userId === userData.userId) {
                    userData = appData.users[userId];
                    updateUI();
                }
            }
        }
        
        function resetUserAds(userId) {
            if (appData.users[userId]) {
                appData.users[userId].dailyAdCount = 0;
                appData.users[userId].lastUpdated = Date.now();
                saveAppData();
                
                showStatusMessage('Kullanıcının günlük reklamları sıfırlandı!', 'success');
                
                // UI'ı güncelle
                if (userId === userData.userId) {
                    userData = appData.users[userId];
                    updateUI();
                }
            }
        }
        
        function resetAllDailyAds() {
            if (confirm('Tüm kullanıcıların günlük reklam sayılarını sıfırlamak istediğinizden emin misiniz?')) {
                for (const userId in appData.users) {
                    appData.users[userId].dailyAdCount = 0;
                    appData.users[userId].lastUpdated = Date.now();
                }
                
                saveAppData();
                
                // UI'ı güncelle
                if (appData.users[userData.userId]) {
                    userData = appData.users[userData.userId];
                    updateUI();
                }
                
                showStatusMessage('Tüm kullanıcıların günlük reklamları sıfırlandı!', 'success');
            }
        }
        
        function updateRewards() {
            const newAdReward = parseFloat(prompt('Yeni reklam ödülünü girin (USDT):', appData.adReward));
            const newReferralReward = parseFloat(prompt('Yeni referans ödülünü girin (USDT):', appData.referralReward));
            const newMinWithdraw = parseFloat(prompt('Yeni minimum çekim miktarını girin (USDT):', appData.minWithdraw));
            
            if (!isNaN(newAdReward) && newAdReward > 0) {
                appData.adReward = newAdReward;
            }
            
            if (!isNaN(newReferralReward) && newReferralReward > 0) {
                appData.referralReward = newReferralReward;
            }
            
            if (!isNaN(newMinWithdraw) && newMinWithdraw > 0) {
                appData.minWithdraw = newMinWithdraw;
            }
            
            saveAppData();
            updateUI();
            
            showStatusMessage('Ödüller başarıyla güncellendi!', 'success');
        }
        
        function clearAllData() {
            if (confirm('TÜM verileri silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                appData = {
                    adReward: 0.002,
                    minWithdraw: 0.50,
                    referralReward: 0.02,
                    manualTasks: [],
                    withdrawRequests: [],
                    users: {},
                    lastUpdated: Date.now()
                };
                
                saveAppData();
                
                // Yerel kullanıcı verilerini de sıfırla
                userData = {
                    userId: userData.userId,
                    balance: 0,
                    adCount: 0,
                    dailyAdCount: 0,
                    lastAdDate: '',
                    referralCode: generateReferralCode(),
                    referredBy: '',
                    referrals: [],
                    referralBonus: 0,
                    completedTasks: [],
                    taskEarnings: 0,
                    withdrawHistory: [],
                    paymentAddress: '',
                    firstName: userData.firstName,
                    lastUpdated: Date.now()
                };
                
                appData.users[userData.userId] = userData;
                saveAppData();
                
                updateUI();
                
                showStatusMessage('Tüm veriler başarıyla temizlendi!', 'success');
            }
        }
        
        // Uygulamayı başlat
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
