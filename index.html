<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TorreAds</title>
    
    <!-- GigaPub SDK -->
    <script src="https://ad.gigapub.tech/script?id=986"></script>

    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --tg-theme-bg-color: #121212; --tg-theme-text-color: #e0e0e0; --tg-theme-button-color: #007bff;
            --tg-theme-button-text-color: #ffffff; --tg-theme-hint-color: #8a8a8a; --success-color: #28a745;
            --warning-color: #ffc107; --danger-color: #dc3545; --secondary-bg-color: #1e1e1e; --border-color: #333333;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0;
            padding: 20px 15px 90px 15px; background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
            display: flex; flex-direction: column; align-items: center; text-align: center; min-height: 100vh; box-sizing: border-box;
        }
        .container { width: 100%; max-width: 500px; }
        .view { display: none; width: 100%; animation: fadeIn 0.3s ease-in-out; }
        #home-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { margin-bottom: 25px; }
        .header h1 { font-size: 32px; font-weight: 700; margin-bottom: 5px; color: #ffffff; }
        .header p { color: var(--tg-theme-hint-color); font-size: 16px; }
        .card {
            background-color: var(--secondary-bg-color); padding: 25px; border-radius: 16px; margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color);
        }
        .card h2 {
            margin: 0 0 12px 0; font-size: 16px; color: var(--tg-theme-hint-color); font-weight: 500;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .balance-amount { font-size: 42px; font-weight: 700; color: #ffffff; margin-bottom: 10px; }
        .ad-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; }
        .ad-info-item h3 { font-size: 20px; font-weight: 600; margin: 0 0 5px 0; color: #ffffff; }
        .ad-info-item p { font-size: 14px; color: var(--tg-theme-hint-color); margin: 0; }
        .ad-buttons { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        .btn {
            width: 100%; padding: 16px; font-size: 18px; font-weight: 600; border: none; border-radius: 12px; cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3); color: var(--tg-theme-button-text-color);
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #555; color: #888; cursor: not-allowed; box-shadow: none; transform: none; }
        #mainWithdrawBtn { background: linear-gradient(145deg, var(--success-color), #1e7e34); box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2); }
        #mainWithdrawBtn:disabled { background: #555; box-shadow: none; }
        .status-message {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 480px;
            padding: 12px 15px; border-radius: 10px; font-weight: 500; display: none; animation: fadeIn 0.3s;
            z-index: 1000; box-sizing: border-box;
        }
        .success { display: block; background-color: rgba(40, 167, 69, 0.25); border-left: 5px solid var(--success-color); color: var(--success-color); }
        .error { display: block; background-color: rgba(220, 53, 69, 0.25); border-left: 5px solid var(--danger-color); color: var(--danger-color); }
        .info { display: block; background-color: rgba(0, 123, 255, 0.25); border-left: 5px solid var(--tg-theme-button-color); color: #008cff; }
        .footer-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--secondary-bg-color); display: flex;
            justify-content: space-around; padding: 10px 0; box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
            border-top: 1px solid var(--border-color); z-index: 999;
        }
        .nav-btn {
            background: none; border: none; color: var(--tg-theme-hint-color); display: flex; flex-direction: column;
            align-items: center; font-size: 12px; font-weight: 500; cursor: pointer; padding: 5px 15px;
            border-radius: 12px; transition: color 0.2s, background-color 0.2s;
        }
        .nav-btn.active { color: var(--tg-theme-button-color); }
        .nav-btn:hover:not(.active) { color: #ffffff; }
        .nav-btn .icon { width: 28px; height: 28px; margin-bottom: 4px; }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--tg-theme-hint-color); font-size: 14px; font-weight: 500; }
        .input-group input {
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--border-color);
            background-color: #333; color: var(--tg-theme-text-color); font-size: 16px; box-sizing: border-box;
        }
        .input-group input:focus { outline: none; border-color: var(--tg-theme-button-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
        #referralLink {
            background-color: #111; padding: 15px; border-radius: 10px; word-wrap: break-word;
            border: 1px dashed var(--tg-theme-hint-color); margin-top: 15px; cursor: pointer; color: #e0e0e0;
            transition: background-color 0.2s; text-align: left;
        }
        #referralLink:hover { background-color: #2a2a2a; }
        
        /* Yeni referans giri≈ü kutusu stilleri */
        .referral-input-container {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-bg-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .referral-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .referral-input-group input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: #333;
            color: var(--tg-theme-text-color);
        }
        
        .referral-input-group button {
            padding: 12px 20px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Loading indicator */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* TON Price Chart Styles */
        .price-chart {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }
        
        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: bold;
        }
        
        .price-change {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .price-change.positive {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }
        
        .price-change.negative {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }
        
        .chart-placeholder {
            height: 60px;
            background: linear-gradient(90deg, #333 0%, #444 50%, #333 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }

        /* Referans kod kutusu */
        .referral-code-box {
            background-color: #111;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--tg-theme-hint-color);
            margin-top: 15px;
            cursor: pointer;
            color: #e0e0e0;
            transition: background-color 0.2s;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
        }
        
        .referral-code-box:hover {
            background-color: #2a2a2a;
        }

        /* Admin Panel Stilleri */
        .admin-panel {
            display: none;
            margin-top: 30px;
            padding: 15px;
            border: 1px solid var(--warning-color);
            border-radius: 10px;
            background-color: rgba(255, 193, 7, 0.1);
        }
        
        .admin-panel h3 {
            color: var(--warning-color);
            margin-top: 0;
        }
        
        .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .admin-btn {
            padding: 10px 15px;
            background: linear-gradient(145deg, var(--warning-color), #e0a800);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
        }
        
        .admin-btn.danger {
            background: linear-gradient(145deg, var(--danger-color), #c82333);
            color: white;
        }
        
        .admin-stats {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 14px;
            text-align: left;
        }
        
        /* Dil se√ßimi modalƒ± */
        .language-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .language-modal-content {
            background-color: var(--secondary-bg-color);
            padding: 25px;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .language-modal h2 {
            margin-top: 0;
            color: #ffffff;
            margin-bottom: 20px;
        }
        
        .language-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .language-option {
            padding: 12px;
            background-color: #333;
            border: none;
            border-radius: 8px;
            color: var(--tg-theme-text-color);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .language-option:hover {
            background-color: #444;
        }
        
        .language-option.selected {
            background-color: var(--tg-theme-button-color);
            color: white;
        }
        
        .language-confirm-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .language-confirm-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .language-confirm-checkbox input {
            width: 18px;
            height: 18px;
        }
        
        .language-confirm-btn {
            padding: 12px 24px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
        }
        
        .language-confirm-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        /* G√∂revler pazarƒ± */
        .tasks-container {
            margin-top: 20px;
        }
        
        .task-card {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-title {
            font-weight: bold;
            font-size: 16px;
        }
        
        .task-reward {
            background-color: var(--success-color);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .task-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 10px;
        }
        
        .task-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-progress-bar {
            height: 6px;
            background-color: #333;
            border-radius: 3px;
            flex-grow: 1;
            margin-right: 10px;
            overflow: hidden;
        }
        
        .task-progress-fill {
            height: 100%;
            background-color: var(--tg-theme-button-color);
            border-radius: 3px;
        }
        
        .task-expiry {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .task-button {
            width: 100%;
            padding: 10px;
            background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .task-button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        /* √áekim talepleri tablosu */
        .withdrawals-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .withdrawals-table th, .withdrawals-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .withdrawals-table th {
            color: var(--tg-theme-hint-color);
            font-weight: 500;
        }
        
        .withdrawal-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: rgba(255, 193, 7, 0.2);
            color: var(--warning-color);
        }
        
        .status-completed {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }
        
        .status-failed {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }
        
        /* Bakƒ±m modu */
        .maintenance-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .maintenance-content {
            max-width: 400px;
        }
    </style>
</head>
<body>
    <!-- Dil Se√ßimi Modalƒ± -->
    <div id="languageModal" class="language-modal">
        <div class="language-modal-content">
            <h2>Select Language / Dil Se√ßin</h2>
            <div class="language-options">
                <button class="language-option" data-lang="en">English</button>
                <button class="language-option" data-lang="tr">T√ºrk√ße</button>
                <button class="language-option" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
                <button class="language-option" data-lang="az">Az…ôrbaycanca</button>
                <button class="language-option" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                <button class="language-option" data-lang="es">Espa√±ol</button>
            </div>
            <div class="language-confirm-section">
                <div class="language-confirm-checkbox">
                    <input type="checkbox" id="languageConfirm">
                    <label for="languageConfirm">I confirm my language selection / Dil se√ßimimi onaylƒ±yorum</label>
                </div>
                <button class="language-confirm-btn" id="languageConfirmBtn" disabled>Confirm / Onayla</button>
            </div>
        </div>
    </div>

    <!-- Bakƒ±m Modu -->
    <div id="maintenanceMode" class="maintenance-mode" style="display: none;">
        <div class="maintenance-content">
            <h2>üõ†Ô∏è Maintenance Mode</h2>
            <p>The app is currently under maintenance. Please try again later.</p>
            <p id="maintenanceMessage"></p>
        </div>
    </div>

    <div class="container">
        <!-- Home / Task View -->
        <div id="home-view" class="view">
            <div class="header"><h1>TorreAds</h1><p>Watch Ads and Earn TON</p></div>
            
            <!-- TON Price Chart -->
            <div class="price-chart">
                <div class="price-info">
                    <div class="current-price">TON: $<span id="tonPrice">0.00</span></div>
                    <div class="price-change" id="priceChange">0.00%</div>
                </div>
                <div class="chart-placeholder" id="chartPlaceholder">
                    Live TON Price Chart
                </div>
            </div>
            
            <div class="card">
                <h2>Current Balance</h2>
                <div class="balance-amount" id="balanceDisplay">TON 0.00</div>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Total Ads Watched</p></div>
                    <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0 / 100</h3><p>Today's Ads</p></div>
                </div>
            </div>
            <div class="ad-buttons"><button class="btn" id="rewardedBtn">Watch Ad (+0.004 TON)</button></div>
            <button class="btn" id="mainWithdrawBtn" disabled>Reach 0.50 TON to Withdraw</button>
            
            <!-- G√∂revler Pazarƒ± -->
            <div class="card">
                <h2>Tasks Market</h2>
                <div class="tasks-container" id="tasksContainer">
                    <!-- G√∂revler burada dinamik olarak y√ºklenecek -->
                </div>
            </div>
            
            <!-- Geni≈ületilmi≈ü Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <h3>üëë Admin Panel</h3>
                <p id="userInfo"></p>
                
                <div class="admin-stats" id="adminStats">
                    <p><strong>Global Stats:</strong></p>
                    <p>Total Users: <span id="totalUsers">0</span></p>
                    <p>Total Ads Watched: <span id="totalAds">0</span></p>
                    <p>Total TON Distributed: <span id="totalTON">0.00</span></p>
                    <p>Total Referrals: <span id="totalReferrals">0</span></p>
                </div>
                
                <div class="admin-controls">
                    <button class="admin-btn" id="maintenanceBtn">Toggle Maintenance Mode</button>
                    <button class="admin-btn" id="resetAllBtn">Reset All User Stats</button>
                    <button class="admin-btn" id="resetReferralsBtn">Reset All Referrals</button>
                    <button class="admin-btn" id="viewWithdrawalsBtn">View Withdrawal Requests</button>
                    <button class="admin-btn" id="createTaskBtn">Create New Task</button>
                    <button class="admin-btn danger" id="deleteAllBtn">Delete All User Data</button>
                    <button class="admin-btn" id="refreshStatsBtn">Refresh Stats</button>
                </div>
                
                <!-- √áekim Talepleri Tablosu -->
                <div id="withdrawalsTableContainer" style="display: none; margin-top: 20px;">
                    <h4>Withdrawal Requests</h4>
                    <table class="withdrawals-table">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Username</th>
                                <th>Amount</th>
                                <th>Address</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsTableBody">
                            <!-- √áekim talepleri burada g√∂r√ºnecek -->
                        </tbody>
                    </table>
                </div>
                
                <!-- G√∂rev Olu≈üturma Formu -->
                <div id="createTaskForm" style="display: none; margin-top: 20px;">
                    <h4>Create New Task</h4>
                    <div class="input-group">
                        <label for="taskTitle">Task Title</label>
                        <input type="text" id="taskTitle" placeholder="Enter task title">
                    </div>
                    <div class="input-group">
                        <label for="taskDescription">Task Description</label>
                        <input type="text" id="taskDescription" placeholder="Enter task description">
                    </div>
                    <div class="input-group">
                        <label for="taskReward">Reward (TON)</label>
                        <input type="number" id="taskReward" step="0.001" min="0.001" value="0.004">
                    </div>
                    <div class="input-group">
                        <label for="taskMaxParticipants">Max Participants</label>
                        <input type="number" id="taskMaxParticipants" min="1" value="100">
                    </div>
                    <div class="input-group">
                        <label for="taskDuration">Duration (hours)</label>
                        <input type="number" id="taskDuration" min="1" value="48">
                    </div>
                    <div class="admin-controls">
                        <button class="admin-btn" id="submitTaskBtn">Create Task</button>
                        <button class="admin-btn danger" id="cancelTaskBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Withdraw View -->
        <div id="withdraw-view" class="view">
            <div class="header"><h1>Withdraw</h1><p>Request your earnings</p></div>
            <div class="card">
                <h2>Your Balance</h2>
                <div class="balance-amount" id="withdrawBalanceDisplay">TON 0.00</div>
                <p style="color: var(--tg-theme-hint-color); margin-top: 15px;">Minimum withdrawal is 0.50 TON.</p>
            </div>
            <div class="card">
                <h2>Payment Details</h2>
                <div class="input-group">
                    <label for="paymentAddress">Your TON Wallet Address</label>
                    <input type="text" id="paymentAddress" placeholder="e.g., EQ... (TON Address)">
                </div>
                <button class="btn" id="finalWithdrawBtn" disabled>Withdraw</button>
            </div>
        </div>
        
        <!-- Referral View -->
        <div id="referral-view" class="view">
            <div class="header"><h1>Referrals</h1><p>Invite friends and earn more!</p></div>
            <div class="card">
                <h2>Your Referral Stats</h2>
                <div class="ad-info-grid">
                    <div class="ad-info-item"><h3 id="referralCountDisplay">0</h3><p>Total Referrals</p></div>
                    <div class="ad-info-item"><h3 id="referralBonusDisplay">TON 0.00</h3><p>Referral Earnings</p></div>
                </div>
            </div>
            
            <!-- Manuel Referans Giri≈ü Kutusu -->
            <div class="card">
                <h2>Enter Referral Code</h2>
                <p>If someone referred you, enter their code here to get bonus!</p>
                <div class="referral-input-container">
                    <div class="referral-input-group">
                        <input type="text" id="referralCodeInput" placeholder="Enter referral code">
                        <button id="submitReferralBtn">Submit</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Your Referral Code</h2>
                <p>Share this code with your friends. You get 0.02 TON for each verified friend who joins!</p>
                <div class="referral-code-box" id="referralCodeBox" title="Click to copy">
                    <span id="userReferralCode">Loading...</span>
                </div>
                <p style="font-size:12px; color:var(--tg-theme-hint-color); margin-top:15px;">Click on the code above to copy it</p>
            </div>
        </div>

        <!-- Common Elements -->
        <div class="status-message" id="statusMessage"></div>
    </div>

    <!-- Footer Navigation -->
    <footer class="footer-nav">
        <button class="nav-btn active" id="navHome"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>Home</span></button>
        <button class="nav-btn" id="navWithdraw"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.31 8.91a1 1 0 0 0-1.42 0l-4.24 4.24-2.12-2.12a1 1 0 1 0-1.42 1.42l2.83 2.83a1 1 0 0 0 1.42 0l5-5a1 1 0 0 0 0-1.42zM20 12a8 8 0 1 1-8-8 8 8 0 0 1 8 8zm-2 0a6 6 0 1 0-6 6 6 6 0 0 0 6-6z"/></svg></span><span>Withdraw</span></button>
        <button class="nav-btn" id="navRefer"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V18h14v-1.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V18h6v-1.5c0-2.33-4.67-3.5-7-3.5z"/></svg></span><span>Referrals</span></button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tg = window.Telegram.WebApp;

            // --- DOM Elements ---
            const balanceDisplay = document.getElementById('balanceDisplay'), 
                  adCountDisplay = document.getElementById('adCountDisplay'),
                  dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay'), 
                  rewardedBtn = document.getElementById('rewardedBtn'),
                  mainWithdrawBtn = document.getElementById('mainWithdrawBtn'), 
                  statusMessage = document.getElementById('statusMessage'),
                  withdrawBalanceDisplay = document.getElementById('withdrawBalanceDisplay'), 
                  paymentAddressInput = document.getElementById('paymentAddress'),
                  finalWithdrawBtn = document.getElementById('finalWithdrawBtn'), 
                  referralCountDisplay = document.getElementById('referralCountDisplay'), 
                  referralBonusDisplay = document.getElementById('referralBonusDisplay'), 
                  adminPanel = document.getElementById('adminPanel'), 
                  userInfoDisplay = document.getElementById('userInfo'), 
                  referralCodeInput = document.getElementById('referralCodeInput'), 
                  submitReferralBtn = document.getElementById('submitReferralBtn'), 
                  userReferralCodeDisplay = document.getElementById('userReferralCode'),
                  referralCodeBox = document.getElementById('referralCodeBox'), 
                  tonPriceDisplay = document.getElementById('tonPrice'), 
                  priceChangeDisplay = document.getElementById('priceChange'), 
                  chartPlaceholder = document.getElementById('chartPlaceholder'),
                  totalUsersDisplay = document.getElementById('totalUsers'), 
                  totalAdsDisplay = document.getElementById('totalAds'),
                  totalTONDisplay = document.getElementById('totalTON'), 
                  totalReferralsDisplay = document.getElementById('totalReferrals'),
                  resetAllBtn = document.getElementById('resetAllBtn'), 
                  resetReferralsBtn = document.getElementById('resetReferralsBtn'),
                  deleteAllBtn = document.getElementById('deleteAllBtn'), 
                  refreshStatsBtn = document.getElementById('refreshStatsBtn'),
                  maintenanceBtn = document.getElementById('maintenanceBtn'),
                  viewWithdrawalsBtn = document.getElementById('viewWithdrawalsBtn'),
                  createTaskBtn = document.getElementById('createTaskBtn'),
                  withdrawalsTableContainer = document.getElementById('withdrawalsTableContainer'),
                  withdrawalsTableBody = document.getElementById('withdrawalsTableBody'),
                  createTaskForm = document.getElementById('createTaskForm'),
                  submitTaskBtn = document.getElementById('submitTaskBtn'),
                  cancelTaskBtn = document.getElementById('cancelTaskBtn'),
                  tasksContainer = document.getElementById('tasksContainer'),
                  languageModal = document.getElementById('languageModal'),
                  languageConfirm = document.getElementById('languageConfirm'),
                  languageConfirmBtn = document.getElementById('languageConfirmBtn'),
                  maintenanceMode = document.getElementById('maintenanceMode'),
                  maintenanceMessage = document.getElementById('maintenanceMessage');

            // --- App Constants & Configuration ---
            const ADMIN_ID = 6357701459;
            const BOT_USERNAME = 'TorreAds_Bot';
            const WEBAPP_URL = 'https://torreads.onrender.com';
            const WITHDRAW_WEBHOOK_URL = 'https://eo3h4zf914hhqv7.m.pipedream.net';
            
            // JSONBin.io Configuration - YENƒ∞ BIN ID
            const JSONBIN_BIN_ID = '68dcfa1fae596e708f0235a7';
            const JSONBIN_API_KEY = '$2a$10$t0i.TuifzioNY0cd8HzoDOxB94YLcVc.gbHkv.qmFQzFJcbl9uVrK';
            const JSONBIN_BASE_URL = 'https://api.jsonbin.io/v3/b';
            
            const WITHDRAW_THRESHOLD = 0.50;
            const AD_REWARD_CENTS = 0.4; // 0.004 TON
            const REFERRAL_BONUS_TON = 0.02; // Referans olana 0.02 TON
            const REFERRER_BONUS_TON = 0.02; // Referans verene 0.02 TON
            const DAILY_AD_LIMIT = 100;

            // Dil √ßevirileri
            const translations = {
                en: {
                    appTitle: "TorreAds",
                    appSubtitle: "Watch Ads and Earn TON",
                    currentBalance: "Current Balance",
                    totalAdsWatched: "Total Ads Watched",
                    todaysAds: "Today's Ads",
                    watchAd: "Watch Ad (+0.004 TON)",
                    reachToWithdraw: "Reach 0.50 TON to Withdraw",
                    goToWithdraw: "Go to Withdraw",
                    withdraw: "Withdraw",
                    withdrawTitle: "Withdraw",
                    withdrawSubtitle: "Request your earnings",
                    yourBalance: "Your Balance",
                    minimumWithdraw: "Minimum withdrawal is 0.50 TON.",
                    paymentDetails: "Payment Details",
                    walletAddress: "Your TON Wallet Address",
                    addressPlaceholder: "e.g., EQ... (TON Address)",
                    withdrawButton: "Withdraw",
                    referrals: "Referrals",
                    referralsSubtitle: "Invite friends and earn more!",
                    referralStats: "Your Referral Stats",
                    totalReferrals: "Total Referrals",
                    referralEarnings: "Referral Earnings",
                    enterReferralCode: "Enter Referral Code",
                    referralCodeDescription: "If someone referred you, enter their code here to get bonus!",
                    enterCodePlaceholder: "Enter referral code",
                    submit: "Submit",
                    yourReferralCode: "Your Referral Code",
                    shareCodeDescription: "Share this code with your friends. You get 0.02 TON for each verified friend who joins!",
                    clickToCopy: "Click on the code above to copy it",
                    home: "Home",
                    tasksMarket: "Tasks Market",
                    adminPanel: "üëë Admin Panel",
                    globalStats: "Global Stats:",
                    toggleMaintenance: "Toggle Maintenance Mode",
                    resetAllStats: "Reset All User Stats",
                    resetReferrals: "Reset All Referrals",
                    viewWithdrawals: "View Withdrawal Requests",
                    createTask: "Create New Task",
                    deleteAllData: "Delete All User Data",
                    refreshStats: "Refresh Stats",
                    withdrawalRequests: "Withdrawal Requests",
                    userID: "User ID",
                    username: "Username",
                    amount: "Amount",
                    address: "Address",
                    status: "Status",
                    actions: "Actions",
                    pending: "Pending",
                    completed: "Completed",
                    failed: "Failed",
                    approve: "Approve",
                    reject: "Reject",
                    createNewTask: "Create New Task",
                    taskTitle: "Task Title",
                    taskTitlePlaceholder: "Enter task title",
                    taskDescription: "Task Description",
                    taskDescriptionPlaceholder: "Enter task description",
                    taskReward: "Reward (TON)",
                    taskMaxParticipants: "Max Participants",
                    taskDuration: "Duration (hours)",
                    createTaskButton: "Create Task",
                    cancel: "Cancel",
                    maintenanceTitle: "üõ†Ô∏è Maintenance Mode",
                    maintenanceMessage: "The app is currently under maintenance. Please try again later.",
                    languageConfirm: "I confirm my language selection",
                    confirm: "Confirm"
                },
                tr: {
                    appTitle: "TorreAds",
                    appSubtitle: "Reklam ƒ∞zle ve TON Kazan",
                    currentBalance: "Mevcut Bakiye",
                    totalAdsWatched: "Toplam ƒ∞zlenen Reklam",
                    todaysAds: "Bug√ºnk√º Reklamlar",
                    watchAd: "Reklam ƒ∞zle (+0.004 TON)",
                    reachToWithdraw: "√áekim i√ßin 0.50 TON'a ula≈üƒ±n",
                    goToWithdraw: "√áekim Yap",
                    withdraw: "√áekim Yap",
                    withdrawTitle: "√áekim Yap",
                    withdrawSubtitle: "Kazancƒ±nƒ±zƒ± talep edin",
                    yourBalance: "Bakiyeniz",
                    minimumWithdraw: "Minimum √ßekim miktarƒ± 0.50 TON'dur.",
                    paymentDetails: "√ñdeme Detaylarƒ±",
                    walletAddress: "TON C√ºzdan Adresiniz",
                    addressPlaceholder: "√∂rn: EQ... (TON Adresi)",
                    withdrawButton: "√áekim Yap",
                    referrals: "Referanslar",
                    referralsSubtitle: "Arkada≈ülarƒ±nƒ± davet et ve daha fazla kazan!",
                    referralStats: "Referans ƒ∞statistikleriniz",
                    totalReferrals: "Toplam Referans",
                    referralEarnings: "Referans Kazan√ßlarƒ±",
                    enterReferralCode: "Referans Kodunu Girin",
                    referralCodeDescription: "Eƒüer birisi sizi referans ettiyse, bonus almak i√ßin kodunu buraya girin!",
                    enterCodePlaceholder: "Referans kodunu girin",
                    submit: "G√∂nder",
                    yourReferralCode: "Referans Kodunuz",
                    shareCodeDescription: "Bu kodu arkada≈ülarƒ±nƒ±zla payla≈üƒ±n. Katƒ±lan her onaylƒ± arkada≈ü i√ßin 0.02 TON kazanƒ±rsƒ±nƒ±z!",
                    clickToCopy: "Kopyalamak i√ßin yukarƒ±daki koda tƒ±klayƒ±n",
                    home: "Ana Sayfa",
                    tasksMarket: "G√∂revler Pazarƒ±",
                    adminPanel: "üëë Y√∂netici Paneli",
                    globalStats: "Genel ƒ∞statistikler:",
                    toggleMaintenance: "Bakƒ±m Modunu A√ß/Kapat",
                    resetAllStats: "T√ºm Kullanƒ±cƒ± ƒ∞statistiklerini Sƒ±fƒ±rla",
                    resetReferrals: "T√ºm Referanslarƒ± Sƒ±fƒ±rla",
                    viewWithdrawals: "√áekim Taleplerini G√∂r√ºnt√ºle",
                    createTask: "Yeni G√∂rev Olu≈ütur",
                    deleteAllData: "T√ºm Kullanƒ±cƒ± Verilerini Sil",
                    refreshStats: "ƒ∞statistikleri Yenile",
                    withdrawalRequests: "√áekim Talepleri",
                    userID: "Kullanƒ±cƒ± ID",
                    username: "Kullanƒ±cƒ± Adƒ±",
                    amount: "Miktar",
                    address: "Adres",
                    status: "Durum",
                    actions: "ƒ∞≈ülemler",
                    pending: "Beklemede",
                    completed: "Tamamlandƒ±",
                    failed: "Ba≈üarƒ±sƒ±z",
                    approve: "Onayla",
                    reject: "Reddet",
                    createNewTask: "Yeni G√∂rev Olu≈ütur",
                    taskTitle: "G√∂rev Ba≈ülƒ±ƒüƒ±",
                    taskTitlePlaceholder: "G√∂rev ba≈ülƒ±ƒüƒ±nƒ± girin",
                    taskDescription: "G√∂rev A√ßƒ±klamasƒ±",
                    taskDescriptionPlaceholder: "G√∂rev a√ßƒ±klamasƒ±nƒ± girin",
                    taskReward: "√ñd√ºl (TON)",
                    taskMaxParticipants: "Maksimum Katƒ±lƒ±mcƒ±",
                    taskDuration: "S√ºre (saat)",
                    createTaskButton: "G√∂rev Olu≈ütur",
                    cancel: "ƒ∞ptal",
                    maintenanceTitle: "üõ†Ô∏è Bakƒ±m Modu",
                    maintenanceMessage: "Uygulama ≈üu anda bakƒ±mda. L√ºtfen daha sonra tekrar deneyin.",
                    languageConfirm: "Dil se√ßimimi onaylƒ±yorum",
                    confirm: "Onayla"
                },
                ru: {
                    appTitle: "TorreAds",
                    appSubtitle: "–°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∫–ª–∞–º—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ TON",
                    currentBalance: "–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å",
                    totalAdsWatched: "–í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤",
                    todaysAds: "–†–µ–∫–ª–∞–º—ã —Å–µ–≥–æ–¥–Ω—è",
                    watchAd: "–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É (+0.004 TON)",
                    reachToWithdraw: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 0.50 TON –¥–ª—è –≤—ã–≤–æ–¥–∞",
                    goToWithdraw: "–í—ã–≤–µ—Å—Ç–∏",
                    withdraw: "–í—ã–≤–µ—Å—Ç–∏",
                    withdrawTitle: "–í—ã–≤–æ–¥",
                    withdrawSubtitle: "–ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Å–≤–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫",
                    yourBalance: "–í–∞—à –±–∞–ª–∞–Ω—Å",
                    minimumWithdraw: "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ 0.50 TON.",
                    paymentDetails: "–î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞",
                    walletAddress: "–í–∞—à TON –∫–æ—à–µ–ª–µ–∫",
                    addressPlaceholder: "–Ω–∞–ø—Ä–∏–º–µ—Ä, EQ... (TON –∞–¥—Ä–µ—Å)",
                    withdrawButton: "–í—ã–≤–µ—Å—Ç–∏",
                    referrals: "–†–µ—Ñ–µ—Ä–∞–ª—ã",
                    referralsSubtitle: "–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –±–æ–ª—å—à–µ!",
                    referralStats: "–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                    totalReferrals: "–í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤",
                    referralEarnings: "–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫",
                    enterReferralCode: "–í–≤–µ–¥–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥",
                    referralCodeDescription: "–ï—Å–ª–∏ –≤–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–≥–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞!",
                    enterCodePlaceholder: "–í–≤–µ–¥–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥",
                    submit: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
                    yourReferralCode: "–í–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥",
                    shareCodeDescription: "–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –∫–æ–¥–æ–º —Å –¥—Ä—É–∑—å—è–º–∏. –í—ã –ø–æ–ª—É—á–∏—Ç–µ 0.02 TON –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞!",
                    clickToCopy: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–¥ –≤—ã—à–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
                    home: "–ì–ª–∞–≤–Ω–∞—è",
                    tasksMarket: "–†—ã–Ω–æ–∫ –∑–∞–¥–∞–Ω–∏–π",
                    adminPanel: "üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
                    globalStats: "–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:",
                    toggleMaintenance: "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è",
                    resetAllStats: "–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
                    resetReferrals: "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã",
                    viewWithdrawals: "–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥",
                    createTask: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ",
                    deleteAllData: "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ",
                    refreshStats: "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
                    withdrawalRequests: "–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–≤–æ–¥",
                    userID: "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
                    username: "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
                    amount: "–°—É–º–º–∞",
                    address: "–ê–¥—Ä–µ—Å",
                    status: "–°—Ç–∞—Ç—É—Å",
                    actions: "–î–µ–π—Å—Ç–≤–∏—è",
                    pending: "–í –æ–∂–∏–¥–∞–Ω–∏–∏",
                    completed: "–ó–∞–≤–µ—Ä—à–µ–Ω–æ",
                    failed: "–ù–µ —É–¥–∞–ª–æ—Å—å",
                    approve: "–û–¥–æ–±—Ä–∏—Ç—å",
                    reject: "–û—Ç–∫–ª–æ–Ω–∏—Ç—å",
                    createNewTask: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ",
                    taskTitle: "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è",
                    taskTitlePlaceholder: "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è",
                    taskDescription: "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è",
                    taskDescriptionPlaceholder: "–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è",
                    taskReward: "–ù–∞–≥—Ä–∞–¥–∞ (TON)",
                    taskMaxParticipants: "–ú–∞–∫—Å. —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤",
                    taskDuration: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)",
                    createTaskButton: "–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ",
                    cancel: "–û—Ç–º–µ–Ω–∞",
                    maintenanceTitle: "üõ†Ô∏è –†–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è",
                    maintenanceMessage: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                    languageConfirm: "–Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –≤—ã–±–æ—Ä —è–∑—ã–∫–∞",
                    confirm: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"
                },
                az: {
                    appTitle: "TorreAds",
                    appSubtitle: "Reklamlara bax v…ô TON qazan",
                    currentBalance: "Cari Balans",
                    totalAdsWatched: "√úmumi Baxƒ±lan Reklamlar",
                    todaysAds: "Bug√ºnk√º Reklamlar",
                    watchAd: "Reklama Bax (+0.004 TON)",
                    reachToWithdraw: "√áƒ±xarmaq √º√ß√ºn 0.50 TON-a √ßatƒ±n",
                    goToWithdraw: "√áƒ±xar",
                    withdraw: "√áƒ±xar",
                    withdrawTitle: "√áƒ±xar",
                    withdrawSubtitle: "Qazancƒ±nƒ±zƒ± t…ôl…ôb edin",
                    yourBalance: "Balansƒ±nƒ±z",
                    minimumWithdraw: "Minimum √ßƒ±xarma m…ôbl…ôƒüi 0.50 TON-dur.",
                    paymentDetails: "√ñd…ôni≈ü T…ôf…ôrr√ºatlarƒ±",
                    walletAddress: "TON Pulqabƒ±nƒ±zƒ±n √únvanƒ±",
                    addressPlaceholder: "m…ôs: EQ... (TON √únvanƒ±)",
                    withdrawButton: "√áƒ±xar",
                    referrals: "Referallar",
                    referralsSubtitle: "Dostlarƒ±nƒ± d…ôv…ôt et v…ô daha √ßox qazan!",
                    referralStats: "Referal Statistikalarƒ±nƒ±z",
                    totalReferrals: "√úmumi Referallar",
                    referralEarnings: "Referal Qazanclarƒ±",
                    enterReferralCode: "Referal Kodunu Daxil Edin",
                    referralCodeDescription: "∆èg…ôr kims…ô sizi referal etmi≈üdirs…ô, bonus almaq √º√ß√ºn onun kodunu buraya daxil edin!",
                    enterCodePlaceholder: "Referal kodunu daxil edin",
                    submit: "T…ôqdim et",
                    yourReferralCode: "Referal Kodunuz",
                    shareCodeDescription: "Bu kodu dostlarƒ±nƒ±zla payla≈üƒ±n. Qo≈üulan h…ôr t…ôsdiql…ônmi≈ü dost √º√ß√ºn 0.02 TON qazanƒ±rsƒ±nƒ±z!",
                    clickToCopy: "Kopyalamaq √º√ß√ºn yuxarƒ±dakƒ± koda klikl…ôyin",
                    home: "Ana S…ôhif…ô",
                    tasksMarket: "Tap≈üƒ±rƒ±qlar Bazarƒ±",
                    adminPanel: "üëë Admin Paneli",
                    globalStats: "Qlobal Statistikalar:",
                    toggleMaintenance: "Baxƒ±m Rejimini A√ß/Baƒüla",
                    resetAllStats: "B√ºt√ºn ƒ∞stifad…ô√ßi Statistikalarƒ±nƒ± Sƒ±fƒ±rla",
                    resetReferrals: "B√ºt√ºn Referallarƒ± Sƒ±fƒ±rla",
                    viewWithdrawals: "√áƒ±xarma Sorƒüularƒ±nƒ± G√∂r√ºnt√ºl…ô",
                    createTask: "Yeni Tap≈üƒ±rƒ±q Yaradƒ±n",
                    deleteAllData: "B√ºt√ºn ƒ∞stifad…ô√ßi M…ôlumatlarƒ±nƒ± Sil",
                    refreshStats: "Statistikalarƒ± Yenil…ô",
                    withdrawalRequests: "√áƒ±xarma Sorƒüularƒ±",
                    userID: "ƒ∞stifad…ô√ßi ID",
                    username: "ƒ∞stifad…ô√ßi Adƒ±",
                    amount: "M…ôbl…ôƒü",
                    address: "√únvan",
                    status: "Status",
                    actions: "H…ôr…ôk…ôtl…ôr",
                    pending: "G√∂zl…ôm…ôd…ô",
                    completed: "Tamamlandƒ±",
                    failed: "Uƒüursuz",
                    approve: "T…ôsdiql…ô",
                    reject: "R…ôdd et",
                    createNewTask: "Yeni Tap≈üƒ±rƒ±q Yaradƒ±n",
                    taskTitle: "Tap≈üƒ±rƒ±q Ba≈ülƒ±ƒüƒ±",
                    taskTitlePlaceholder: "Tap≈üƒ±rƒ±q ba≈ülƒ±ƒüƒ±nƒ± daxil edin",
                    taskDescription: "Tap≈üƒ±rƒ±q T…ôsviri",
                    taskDescriptionPlaceholder: "Tap≈üƒ±rƒ±q t…ôsvirini daxil edin",
                    taskReward: "M√ºkafat (TON)",
                    taskMaxParticipants: "Maksimum ƒ∞≈ütirak√ßƒ±",
                    taskDuration: "M√ºdd…ôt (saat)",
                    createTaskButton: "Tap≈üƒ±rƒ±q Yaradƒ±n",
                    cancel: "L…ôƒüv et",
                    maintenanceTitle: "üõ†Ô∏è Baxƒ±m Rejimi",
                    maintenanceMessage: "T…ôtbiq hazƒ±rda baxƒ±m rejimind…ôdir. Z…ôhm…ôt olmasa sonra yenid…ôn c…ôhd edin.",
                    languageConfirm: "Dil se√ßimimi t…ôsdiql…ôyir…ôm",
                    confirm: "T…ôsdiql…ô"
                },
                hi: {
                    appTitle: "TorreAds",
                    appSubtitle: "‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§î‡§∞ TON ‡§ï‡§Æ‡§æ‡§è‡§Ç",
                    currentBalance: "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏",
                    totalAdsWatched: "‡§ï‡•Å‡§≤ ‡§¶‡•á‡§ñ‡•á ‡§ó‡§è ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§®",
                    todaysAds: "‡§Ü‡§ú ‡§ï‡•á ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§®",
                    watchAd: "‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç (+0.004 TON)",
                    reachToWithdraw: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è 0.50 TON ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö‡•á‡§Ç",
                    goToWithdraw: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ï‡§∞‡•á‡§Ç",
                    withdraw: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä",
                    withdrawTitle: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä",
                    withdrawSubtitle: "‡§Ö‡§™‡§®‡•Ä ‡§ï‡§Æ‡§æ‡§à ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç",
                    yourBalance: "‡§Ü‡§™‡§ï‡§æ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏",
                    minimumWithdraw: "‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä 0.50 TON ‡§π‡•à‡•§",
                    paymentDetails: "‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§µ‡§∞‡§£",
                    walletAddress: "‡§Ü‡§™‡§ï‡§æ TON ‡§µ‡•â‡§≤‡•á‡§ü ‡§™‡§§‡§æ",
                    addressPlaceholder: "‡§â‡§¶‡§æ: EQ... (TON ‡§™‡§§‡§æ)",
                    withdrawButton: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ï‡§∞‡•á‡§Ç",
                    referrals: "‡§∞‡•á‡§´‡§∞‡§≤",
                    referralsSubtitle: "‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§Ü‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§ï‡§Æ‡§æ‡§è‡§Ç!",
                    referralStats: "‡§Ü‡§™‡§ï‡§æ ‡§∞‡•á‡§´‡§∞‡§≤ ‡§∏‡•ç‡§ü‡•à‡§ü‡•ç‡§∏",
                    totalReferrals: "‡§ï‡•Å‡§≤ ‡§∞‡•á‡§´‡§∞‡§≤",
                    referralEarnings: "‡§∞‡•á‡§´‡§∞‡§≤ ‡§ï‡§Æ‡§æ‡§à",
                    enterReferralCode: "‡§∞‡•á‡§´‡§∞‡§≤ ‡§ï‡•ã‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                    referralCodeDescription: "‡§Ø‡§¶‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§®‡•á ‡§Ü‡§™‡§ï‡•ã ‡§∞‡•á‡§´‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à, ‡§§‡•ã ‡§¨‡•ã‡§®‡§∏ ‡§™‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§®‡§ï‡§æ ‡§ï‡•ã‡§° ‡§Ø‡§π‡§æ‡§Ç ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç!",
                    enterCodePlaceholder: "‡§∞‡•á‡§´‡§∞‡§≤ ‡§ï‡•ã‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                    submit: "‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç",
                    yourReferralCode: "‡§Ü‡§™‡§ï‡§æ ‡§∞‡•á‡§´‡§∞‡§≤ ‡§ï‡•ã‡§°",
                    shareCodeDescription: "‡§á‡§∏ ‡§ï‡•ã‡§° ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§¶‡•ã‡§∏‡•ç‡§§ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡•ã 0.02 TON ‡§Æ‡§ø‡§≤‡§§‡§æ ‡§π‡•à!",
                    clickToCopy: "‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§ï‡•ã‡§° ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç",
                    home: "‡§π‡•ã‡§Æ",
                    tasksMarket: "‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¨‡§æ‡§ú‡§æ‡§∞",
                    adminPanel: "üëë ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤",
                    globalStats: "‡§µ‡•à‡§∂‡•ç‡§µ‡§ø‡§ï ‡§Ü‡§Ç‡§ï‡§°‡§º‡•á:",
                    toggleMaintenance: "‡§∞‡§ñ‡§∞‡§ñ‡§æ‡§µ ‡§Æ‡•ã‡§° ‡§ü‡•â‡§ó‡§≤ ‡§ï‡§∞‡•á‡§Ç",
                    resetAllStats: "‡§∏‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§Ü‡§Ç‡§ï‡§°‡§º‡•á ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç",
                    resetReferrals: "‡§∏‡§≠‡•Ä ‡§∞‡•á‡§´‡§∞‡§≤ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç",
                    viewWithdrawals: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§¶‡•á‡§ñ‡•á‡§Ç",
                    createTask: "‡§®‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è‡§Ç",
                    deleteAllData: "‡§∏‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§°‡•á‡§ü‡§æ ‡§π‡§ü‡§æ‡§è‡§Ç",
                    refreshStats: "‡§Ü‡§Ç‡§ï‡§°‡§º‡•á ‡§§‡§æ‡§ú‡§º‡§æ ‡§ï‡§∞‡•á‡§Ç",
                    withdrawalRequests: "‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß",
                    userID: "‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ID",
                    username: "‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ",
                    amount: "‡§∞‡§æ‡§∂‡§ø",
                    address: "‡§™‡§§‡§æ",
                    status: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø",
                    actions: "‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à",
                    pending: "‡§≤‡§Ç‡§¨‡§ø‡§§",
                    completed: "‡§™‡•Ç‡§∞‡•ç‡§£",
                    failed: "‡§µ‡§ø‡§´‡§≤",
                    approve: "‡§Ö‡§®‡•Å‡§Æ‡•ã‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç",
                    reject: "‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç",
                    createNewTask: "‡§®‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è‡§Ç",
                    taskTitle: "‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï",
                    taskTitlePlaceholder: "‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                    taskDescription: "‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£",
                    taskDescriptionPlaceholder: "‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                    taskReward: "‡§á‡§®‡§æ‡§Æ (TON)",
                    taskMaxParticipants: "‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§™‡•ç‡§∞‡§§‡§ø‡§≠‡§æ‡§ó‡•Ä",
                    taskDuration: "‡§Ö‡§µ‡§ß‡§ø (‡§ò‡§Ç‡§ü‡•á)",
                    createTaskButton: "‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è‡§Ç",
                    cancel: "‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                    maintenanceTitle: "üõ†Ô∏è ‡§∞‡§ñ‡§∞‡§ñ‡§æ‡§µ ‡§Æ‡•ã‡§°",
                    maintenanceMessage: "‡§ê‡§™ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡§∞‡§ñ‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                    languageConfirm: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§ö‡§Ø‡§® ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Ç",
                    confirm: "‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç"
                },
                es: {
                    appTitle: "TorreAds",
                    appSubtitle: "Mira anuncios y gana TON",
                    currentBalance: "Saldo Actual",
                    totalAdsWatched: "Total de Anuncios Vistos",
                    todaysAds: "Anuncios de Hoy",
                    watchAd: "Ver Anuncio (+0.004 TON)",
                    reachToWithdraw: "Alcanza 0.50 TON para retirar",
                    goToWithdraw: "Ir a Retirar",
                    withdraw: "Retirar",
                    withdrawTitle: "Retirar",
                    withdrawSubtitle: "Solicita tus ganancias",
                    yourBalance: "Tu Saldo",
                    minimumWithdraw: "El retiro m√≠nimo es de 0.50 TON.",
                    paymentDetails: "Detalles de Pago",
                    walletAddress: "Tu Direcci√≥n de Cartera TON",
                    addressPlaceholder: "ej: EQ... (Direcci√≥n TON)",
                    withdrawButton: "Retirar",
                    referrals: "Referidos",
                    referralsSubtitle: "¬°Invita amigos y gana m√°s!",
                    referralStats: "Tus Estad√≠sticas de Referidos",
                    totalReferrals: "Total de Referidos",
                    referralEarnings: "Ganancias por Referidos",
                    enterReferralCode: "Ingresar C√≥digo de Referido",
                    referralCodeDescription: "¬°Si alguien te refiri√≥, ingresa su c√≥digo aqu√≠ para obtener bonificaci√≥n!",
                    enterCodePlaceholder: "Ingresar c√≥digo de referido",
                    submit: "Enviar",
                    yourReferralCode: "Tu C√≥digo de Referido",
                    shareCodeDescription: "Comparte este c√≥digo con tus amigos. ¬°Ganas 0.02 TON por cada amigo verificado que se una!",
                    clickToCopy: "Haz clic en el c√≥digo de arriba para copiarlo",
                    home: "Inicio",
                    tasksMarket: "Mercado de Tareas",
                    adminPanel: "üëë Panel de Administraci√≥n",
                    globalStats: "Estad√≠sticas Globales:",
                    toggleMaintenance: "Alternar Modo de Mantenimiento",
                    resetAllStats: "Restablecer Todas las Estad√≠sticas de Usuario",
                    resetReferrals: "Restablecer Todos los Referidos",
                    viewWithdrawals: "Ver Solicitudes de Retiro",
                    createTask: "Crear Nueva Tarea",
                    deleteAllData: "Eliminar Todos los Datos de Usuario",
                    refreshStats: "Actualizar Estad√≠sticas",
                    withdrawalRequests: "Solicitudes de Retiro",
                    userID: "ID de Usuario",
                    username: "Nombre de Usuario",
                    amount: "Cantidad",
                    address: "Direcci√≥n",
                    status: "Estado",
                    actions: "Acciones",
                    pending: "Pendiente",
                    completed: "Completado",
                    failed: "Fallido",
                    approve: "Aprobar",
                    reject: "Rechazar",
                    createNewTask: "Crear Nueva Tarea",
                    taskTitle: "T√≠tulo de la Tarea",
                    taskTitlePlaceholder: "Ingresa el t√≠tulo de la tarea",
                    taskDescription: "Descripci√≥n de la Tarea",
                    taskDescriptionPlaceholder: "Ingresa la descripci√≥n de la tarea",
                    taskReward: "Recompensa (TON)",
                    taskMaxParticipants: "M√°x. Participantes",
                    taskDuration: "Duraci√≥n (horas)",
                    createTaskButton: "Crear Tarea",
                    cancel: "Cancelar",
                    maintenanceTitle: "üõ†Ô∏è Modo de Mantenimiento",
                    maintenanceMessage: "La aplicaci√≥n est√° actualmente en mantenimiento. Por favor, int√©ntalo de nuevo m√°s tarde.",
                    languageConfirm: "Confirmo mi selecci√≥n de idioma",
                    confirm: "Confirmar"
                }
            };

            // --- Global Variables ---
            let userData = null;
            let globalData = null;
            let currentLanguage = 'en';
            let isAdmin = false;
            let maintenanceModeEnabled = false;
            let selectedLanguage = null;

            // --- Language Functions ---
            function setLanguage(lang) {
                currentLanguage = lang;
                localStorage.setItem('userLanguage', lang);
                updateUIWithTranslations();
            }

            function updateUIWithTranslations() {
                const t = translations[currentLanguage];
                
                // Ba≈ülƒ±klar
                document.querySelector('#home-view .header h1').textContent = t.appTitle;
                document.querySelector('#home-view .header p').textContent = t.appSubtitle;
                document.querySelector('#withdraw-view .header h1').textContent = t.withdrawTitle;
                document.querySelector('#withdraw-view .header p').textContent = t.withdrawSubtitle;
                document.querySelector('#referral-view .header h1').textContent = t.referrals;
                document.querySelector('#referral-view .header p').textContent = t.referralsSubtitle;
                
                // Ana sayfa
                document.querySelector('#home-view .card h2').textContent = t.currentBalance;
                document.querySelector('#home-view .ad-info-grid .ad-info-item:nth-child(1) p').textContent = t.totalAdsWatched;
                document.querySelector('#home-view .ad-info-grid .ad-info-item:nth-child(2) p').textContent = t.todaysAds;
                document.getElementById('rewardedBtn').textContent = t.watchAd;
                
                // √áekim sayfasƒ±
                document.querySelector('#withdraw-view .card h2').textContent = t.yourBalance;
                document.querySelector('#withdraw-view .card p').textContent = t.minimumWithdraw;
                document.querySelector('#withdraw-view .card:nth-child(3) h2').textContent = t.paymentDetails;
                document.querySelector('#withdraw-view .input-group label').textContent = t.walletAddress;
                document.getElementById('paymentAddress').placeholder = t.addressPlaceholder;
                document.getElementById('finalWithdrawBtn').textContent = t.withdrawButton;
                
                // Referans sayfasƒ±
                document.querySelector('#referral-view .card h2').textContent = t.referralStats;
                document.querySelector('#referral-view .ad-info-grid .ad-info-item:nth-child(1) p').textContent = t.totalReferrals;
                document.querySelector('#referral-view .ad-info-grid .ad-info-item:nth-child(2) p').textContent = t.referralEarnings;
                document.querySelector('#referral-view .card:nth-child(3) h2').textContent = t.enterReferralCode;
                document.querySelector('#referral-view .card:nth-child(3) p').textContent = t.referralCodeDescription;
                document.getElementById('referralCodeInput').placeholder = t.enterCodePlaceholder;
                document.getElementById('submitReferralBtn').textContent = t.submit;
                document.querySelector('#referral-view .card:nth-child(4) h2').textContent = t.yourReferralCode;
                document.querySelector('#referral-view .card:nth-child(4) p').textContent = t.shareCodeDescription;
                document.querySelector('#referral-view .card:nth-child(4) p:nth-child(3)').textContent = t.clickToCopy;
                
                // Navigasyon
                document.getElementById('navHome').querySelector('span:last-child').textContent = t.home;
                document.getElementById('navWithdraw').querySelector('span:last-child').textContent = t.withdraw;
                document.getElementById('navRefer').querySelector('span:last-child').textContent = t.referrals;
                
                // Admin panel
                document.querySelector('#adminPanel h3').textContent = t.adminPanel;
                document.querySelector('#adminStats p:first-child').innerHTML = `<strong>${t.globalStats}</strong>`;
                document.getElementById('maintenanceBtn').textContent = t.toggleMaintenance;
                document.getElementById('resetAllBtn').textContent = t.resetAllStats;
                document.getElementById('resetReferralsBtn').textContent = t.resetReferrals;
                document.getElementById('viewWithdrawalsBtn').textContent = t.viewWithdrawals;
                document.getElementById('createTaskBtn').textContent = t.createTask;
                document.getElementById('deleteAllBtn').textContent = t.deleteAllData;
                document.getElementById('refreshStatsBtn').textContent = t.refreshStats;
                
                // √áekim talepleri tablosu
                if (document.querySelector('#withdrawalsTableContainer h4')) {
                    document.querySelector('#withdrawalsTableContainer h4').textContent = t.withdrawalRequests;
                }
                
                // G√∂rev olu≈üturma formu
                if (document.querySelector('#createTaskForm h4')) {
                    document.querySelector('#createTaskForm h4').textContent = t.createNewTask;
                    document.querySelector('#createTaskForm .input-group:nth-child(1) label').textContent = t.taskTitle;
                    document.getElementById('taskTitle').placeholder = t.taskTitlePlaceholder;
                    document.querySelector('#createTaskForm .input-group:nth-child(2) label').textContent = t.taskDescription;
                    document.getElementById('taskDescription').placeholder = t.taskDescriptionPlaceholder;
                    document.querySelector('#createTaskForm .input-group:nth-child(3) label').textContent = t.taskReward;
                    document.querySelector('#createTaskForm .input-group:nth-child(4) label').textContent = t.taskMaxParticipants;
                    document.querySelector('#createTaskForm .input-group:nth-child(5) label').textContent = t.taskDuration;
                    document.getElementById('submitTaskBtn').textContent = t.createTaskButton;
                    document.getElementById('cancelTaskBtn').textContent = t.cancel;
                }
                
                // Bakƒ±m modu
                document.querySelector('.maintenance-content h2').textContent = t.maintenanceTitle;
                document.querySelector('.maintenance-content p:first-child').textContent = t.maintenanceMessage;
                
                // Dil onaylama
                document.querySelector('.language-confirm-checkbox label').textContent = t.languageConfirm;
                document.getElementById('languageConfirmBtn').textContent = t.confirm;
            }

            // --- Data Management Functions ---
            async function loadUserData() {
                try {
                    const userId = tg.initDataUnsafe.user?.id;
                    if (!userId) throw new Error('User ID not available');

                    // Global verileri y√ºkle
                    const globalResponse = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}/latest`, {
                        headers: { 'X-Master-Key': JSONBIN_API_KEY }
                    });
                    
                    if (!globalResponse.ok) throw new Error('Failed to load global data');
                    const globalResult = await globalResponse.json();
                    globalData = globalResult.record || { users: {}, tasks: [], withdrawals: [], maintenance: false, globalStats: {} };
                    
                    // Bakƒ±m modunu kontrol et
                    maintenanceModeEnabled = globalData.maintenance || false;
                    if (maintenanceModeEnabled) {
                        showMaintenanceMode();
                        return;
                    }
                    
                    // Kullanƒ±cƒ± verilerini y√ºkle veya olu≈ütur
                    if (!globalData.users[userId]) {
                        userData = {
                            balance: 0,
                            totalAds: 0,
                            dailyAds: 0,
                            lastAdDate: new Date().toDateString(),
                            referralCount: 0,
                            referralBonus: 0,
                            referralCode: generateReferralCode(),
                            referredBy: null,
                            completedTasks: []
                        };
                        globalData.users[userId] = userData;
                        await saveGlobalData();
                    } else {
                        userData = globalData.users[userId];
                        
                        // G√ºnl√ºk reklam sƒ±fƒ±rlama kontrol√º
                        const today = new Date().toDateString();
                        if (userData.lastAdDate !== today) {
                            userData.dailyAds = 0;
                            userData.lastAdDate = today;
                            await saveGlobalData();
                        }
                    }
                    
                    // Admin kontrol√º
                    isAdmin = userId === ADMIN_ID;
                    if (isAdmin) {
                        adminPanel.style.display = 'block';
                        userInfoDisplay.textContent = `Admin User: ${tg.initDataUnsafe.user?.username || 'N/A'} (ID: ${userId})`;
                        updateAdminStats();
                    }
                    
                    updateUI();
                    loadTasks();
                    
                } catch (error) {
                    console.error('Error loading user data:', error);
                    showStatus('Failed to load data. Please try again.', 'error');
                }
            }

            async function saveGlobalData() {
                try {
                    const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': JSONBIN_API_KEY
                        },
                        body: JSON.stringify(globalData)
                    });
                    
                    if (!response.ok) throw new Error('Failed to save data');
                } catch (error) {
                    console.error('Error saving data:', error);
                    throw error;
                }
            }

            function generateReferralCode() {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            }

            // --- UI Update Functions ---
            function updateUI() {
                if (!userData) return;
                
                // Ana sayfa g√ºncelleme
                balanceDisplay.textContent = `TON ${userData.balance.toFixed(3)}`;
                adCountDisplay.textContent = userData.totalAds;
                dailyAdCountDisplay.textContent = `${userData.dailyAds} / ${DAILY_AD_LIMIT}`;
                
                // √áekim butonunu g√ºncelle
                if (userData.balance >= WITHDRAW_THRESHOLD) {
                    mainWithdrawBtn.disabled = false;
                    mainWithdrawBtn.textContent = translations[currentLanguage].goToWithdraw;
                    mainWithdrawBtn.style.background = 'linear-gradient(145deg, var(--success-color), #1e7e34)';
                } else {
                    mainWithdrawBtn.disabled = true;
                    mainWithdrawBtn.textContent = `${translations[currentLanguage].reachToWithdraw}`;
                    mainWithdrawBtn.style.background = '#555';
                }
                
                // √áekim sayfasƒ± g√ºncelleme
                withdrawBalanceDisplay.textContent = `TON ${userData.balance.toFixed(3)}`;
                
                // Referans sayfasƒ± g√ºncelleme
                referralCountDisplay.textContent = userData.referralCount;
                referralBonusDisplay.textContent = `TON ${userData.referralBonus.toFixed(3)}`;
                userReferralCodeDisplay.textContent = userData.referralCode;
                
                // G√ºnl√ºk limit kontrol√º
                if (userData.dailyAds >= DAILY_AD_LIMIT) {
                    rewardedBtn.disabled = true;
                    rewardedBtn.textContent = 'Daily limit reached';
                } else {
                    rewardedBtn.disabled = false;
                    rewardedBtn.textContent = translations[currentLanguage].watchAd;
                }
                
                // √áekim butonunu g√ºncelle
                updateWithdrawButton();
            }

            function updateWithdrawButton() {
                if (userData.balance >= WITHDRAW_THRESHOLD && paymentAddressInput.value.trim()) {
                    finalWithdrawBtn.disabled = false;
                } else {
                    finalWithdrawBtn.disabled = true;
                }
            }

            function updateAdminStats() {
                if (!globalData || !isAdmin) return;
                
                const users = globalData.users;
                let totalUsers = 0;
                let totalAds = 0;
                let totalTON = 0;
                let totalReferrals = 0;
                
                for (const userId in users) {
                    totalUsers++;
                    totalAds += users[userId].totalAds || 0;
                    totalTON += users[userId].balance || 0;
                    totalReferrals += users[userId].referralCount || 0;
                }
                
                totalUsersDisplay.textContent = totalUsers;
                totalAdsDisplay.textContent = totalAds;
                totalTONDisplay.textContent = totalTON.toFixed(3);
                totalReferralsDisplay.textContent = totalReferrals;
            }

            // --- Status Message Functions ---
            function showStatus(message, type = 'info') {
                statusMessage.textContent = message;
                statusMessage.className = `status-message ${type}`;
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }

            // --- Navigation Functions ---
            function showView(viewId) {
                document.querySelectorAll('.view').forEach(view => {
                    view.style.display = 'none';
                });
                document.getElementById(viewId).style.display = 'block';
                
                // Navigasyon butonlarƒ±nƒ± g√ºncelle
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (viewId === 'home-view') {
                    document.getElementById('navHome').classList.add('active');
                } else if (viewId === 'withdraw-view') {
                    document.getElementById('navWithdraw').classList.add('active');
                    updateWithdrawButton();
                } else if (viewId === 'referral-view') {
                    document.getElementById('navRefer').classList.add('active');
                }
            }

            // --- Event Listeners ---
            document.getElementById('navHome').addEventListener('click', () => showView('home-view'));
            document.getElementById('navWithdraw').addEventListener('click', () => showView('withdraw-view'));
            document.getElementById('navRefer').addEventListener('click', () => showView('referral-view'));

            // Dil se√ßimi event listener'larƒ±
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    // T√ºm se√ßeneklerden se√ßili sƒ±nƒ±fƒ±nƒ± kaldƒ±r
                    document.querySelectorAll('.language-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Bu se√ßeneƒüi se√ßili yap
                    this.classList.add('selected');
                    selectedLanguage = this.getAttribute('data-lang');
                });
            });

            // Dil onaylama checkbox'ƒ±
            languageConfirm.addEventListener('change', function() {
                languageConfirmBtn.disabled = !this.checked;
            });

            // Dil onaylama butonu
            languageConfirmBtn.addEventListener('click', function() {
                if (selectedLanguage) {
                    setLanguage(selectedLanguage);
                    languageModal.style.display = 'none';
                    showStatus('Language changed successfully!', 'success');
                }
            });

            // Reklam izleme butonu
            rewardedBtn.addEventListener('click', async () => {
                if (!userData) return;
                
                if (userData.dailyAds >= DAILY_AD_LIMIT) {
                    showStatus('Daily ad limit reached. Try again tomorrow.', 'error');
                    return;
                }
                
                rewardedBtn.classList.add('btn-loading');
                
                try {
                    // Gigapub reklam g√∂sterimi
                    if (typeof window.showGiga === 'function') {
                        await new Promise((resolve, reject) => {
                            window.showGiga({
                                placementId: '986',
                                onReward: resolve,
                                onClose: resolve,
                                onError: reject
                            });
                        });
                    } else {
                        // Fallback: Manuel √∂d√ºl
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                    
                    // Ba≈üarƒ±lƒ± reklam izleme
                    userData.balance += AD_REWARD_CENTS;
                    userData.totalAds++;
                    userData.dailyAds++;
                    
                    // Global istatistikleri g√ºncelle
                    if (!globalData.globalStats) globalData.globalStats = {};
                    globalData.globalStats.totalAds = (globalData.globalStats.totalAds || 0) + 1;
                    globalData.globalStats.totalTON = (globalData.globalStats.totalTON || 0) + AD_REWARD_CENTS;
                    
                    await saveGlobalData();
                    updateUI();
                    if (isAdmin) updateAdminStats();
                    
                    showStatus(`Success! You earned ${AD_REWARD_CENTS} TON.`, 'success');
                    
                } catch (error) {
                    console.error('Error showing ad:', error);
                    showStatus('Failed to show ad. Please try again.', 'error');
                } finally {
                    rewardedBtn.classList.remove('btn-loading');
                }
            });

            // √áekim adresi giri≈üi
            paymentAddressInput.addEventListener('input', updateWithdrawButton);

            // √áekim butonu
            finalWithdrawBtn.addEventListener('click', async () => {
                if (!userData || userData.balance < WITHDRAW_THRESHOLD) {
                    showStatus(`Minimum withdrawal is ${WITHDRAW_THRESHOLD} TON.`, 'error');
                    return;
                }
                
                const address = paymentAddressInput.value.trim();
                if (!address) {
                    showStatus('Please enter a valid TON wallet address.', 'error');
                    return;
                }
                
                finalWithdrawBtn.classList.add('btn-loading');
                
                try {
                    const userId = tg.initDataUnsafe.user?.id;
                    const username = tg.initDataUnsafe.user?.username || 'Unknown';
                    const amount = userData.balance;
                    
                    // √áekim talebini olu≈ütur
                    const withdrawal = {
                        userId: userId,
                        username: username,
                        amount: amount,
                        address: address,
                        status: 'pending',
                        timestamp: new Date().toISOString()
                    };
                    
                    if (!globalData.withdrawals) globalData.withdrawals = [];
                    globalData.withdrawals.push(withdrawal);
                    
                    // Kullanƒ±cƒ± bakiyesini sƒ±fƒ±rla
                    userData.balance = 0;
                    
                    await saveGlobalData();
                    updateUI();
                    
                    // Webhook'a √ßekim talebini g√∂nder
                    await fetch(WITHDRAW_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(withdrawal)
                    });
                    
                    showStatus(`Withdrawal request for ${amount.toFixed(3)} TON submitted successfully!`, 'success');
                    paymentAddressInput.value = '';
                    
                } catch (error) {
                    console.error('Error processing withdrawal:', error);
                    showStatus('Failed to process withdrawal. Please try again.', 'error');
                } finally {
                    finalWithdrawBtn.classList.remove('btn-loading');
                }
            });

            // Referans kodunu kopyalama
            referralCodeBox.addEventListener('click', () => {
                navigator.clipboard.writeText(userData.referralCode).then(() => {
                    showStatus('Referral code copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    showStatus('Failed to copy referral code.', 'error');
                });
            });

            // Referans kodunu g√∂nderme
            submitReferralBtn.addEventListener('click', async () => {
                const code = referralCodeInput.value.trim().toUpperCase();
                if (!code) {
                    showStatus('Please enter a referral code.', 'error');
                    return;
                }
                
                if (userData.referredBy) {
                    showStatus('You have already used a referral code.', 'error');
                    return;
                }
                
                // Kullanƒ±cƒ± kendi kodunu giremez
                if (code === userData.referralCode) {
                    showStatus('You cannot use your own referral code.', 'error');
                    return;
                }
                
                submitReferralBtn.classList.add('btn-loading');
                
                try {
                    // Referans koduna sahip kullanƒ±cƒ±yƒ± bul
                    let referrer = null;
                    for (const userId in globalData.users) {
                        if (globalData.users[userId].referralCode === code) {
                            referrer = globalData.users[userId];
                            break;
                        }
                    }
                    
                    if (!referrer) {
                        showStatus('Invalid referral code.', 'error');
                        return;
                    }
                    
                    // Referans i≈ülemini kaydet
                    userData.referredBy = code;
                    referrer.referralCount = (referrer.referralCount || 0) + 1;
                    referrer.referralBonus = (referrer.referralBonus || 0) + REFERRER_BONUS_TON;
                    referrer.balance = (referrer.balance || 0) + REFERRER_BONUS_TON;
                    
                    // Referans olan kullanƒ±cƒ±ya da bonus ver
                    userData.balance += REFERRAL_BONUS_TON;
                    
                    await saveGlobalData();
                    updateUI();
                    
                    showStatus(`Success! You received ${REFERRAL_BONUS_TON} TON bonus.`, 'success');
                    referralCodeInput.value = '';
                    
                } catch (error) {
                    console.error('Error applying referral code:', error);
                    showStatus('Failed to apply referral code. Please try again.', 'error');
                } finally {
                    submitReferralBtn.classList.remove('btn-loading');
                }
            });

            // TON fiyatƒ±nƒ± g√ºncelleme
            async function updateTONPrice() {
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd&include_24hr_change=true');
                    const data = await response.json();
                    
                    if (data['the-open-network']) {
                        const price = data['the-open-network'].usd;
                        const change = data['the-open-network'].usd_24h_change;
                        
                        tonPriceDisplay.textContent = price.toFixed(2);
                        
                        if (change > 0) {
                            priceChangeDisplay.textContent = `+${change.toFixed(2)}%`;
                            priceChangeDisplay.className = 'price-change positive';
                        } else {
                            priceChangeDisplay.textContent = `${change.toFixed(2)}%`;
                            priceChangeDisplay.className = 'price-change negative';
                        }
                    }
                } catch (error) {
                    console.error('Error fetching TON price:', error);
                }
            }

            // --- Admin Functions ---
            resetAllBtn.addEventListener('click', async () => {
                if (!isAdmin || !confirm('Are you sure you want to reset ALL user stats? This cannot be undone.')) return;
                
                try {
                    for (const userId in globalData.users) {
                        globalData.users[userId].balance = 0;
                        globalData.users[userId].totalAds = 0;
                        globalData.users[userId].dailyAds = 0;
                        globalData.users[userId].lastAdDate = new Date().toDateString();
                    }
                    
                    await saveGlobalData();
                    updateUI();
                    updateAdminStats();
                    
                    showStatus('All user stats have been reset.', 'success');
                } catch (error) {
                    console.error('Error resetting user stats:', error);
                    showStatus('Failed to reset user stats.', 'error');
                }
            });

            resetReferralsBtn.addEventListener('click', async () => {
                if (!isAdmin || !confirm('Are you sure you want to reset ALL referrals? This cannot be undone.')) return;
                
                try {
                    for (const userId in globalData.users) {
                        globalData.users[userId].referralCount = 0;
                        globalData.users[userId].referralBonus = 0;
                        globalData.users[userId].referredBy = null;
                    }
                    
                    await saveGlobalData();
                    updateUI();
                    updateAdminStats();
                    
                    showStatus('All referrals have been reset.', 'success');
                } catch (error) {
                    console.error('Error resetting referrals:', error);
                    showStatus('Failed to reset referrals.', 'error');
                }
            });

            deleteAllBtn.addEventListener('click', async () => {
                if (!isAdmin || !confirm('Are you sure you want to delete ALL user data? This cannot be undone.')) return;
                
                try {
                    globalData.users = {};
                    globalData.withdrawals = [];
                    globalData.tasks = [];
                    globalData.globalStats = {};
                    
                    await saveGlobalData();
                    updateUI();
                    updateAdminStats();
                    
                    showStatus('All user data has been deleted.', 'success');
                } catch (error) {
                    console.error('Error deleting user data:', error);
                    showStatus('Failed to delete user data.', 'error');
                }
            });

            refreshStatsBtn.addEventListener('click', () => {
                if (!isAdmin) return;
                updateAdminStats();
                showStatus('Stats refreshed.', 'info');
            });

            maintenanceBtn.addEventListener('click', async () => {
                if (!isAdmin) return;
                
                maintenanceModeEnabled = !maintenanceModeEnabled;
                globalData.maintenance = maintenanceModeEnabled;
                
                await saveGlobalData();
                
                if (maintenanceModeEnabled) {
                    showMaintenanceMode();
                } else {
                    hideMaintenanceMode();
                }
                
                showStatus(`Maintenance mode ${maintenanceModeEnabled ? 'enabled' : 'disabled'}.`, 'info');
            });

            viewWithdrawalsBtn.addEventListener('click', () => {
                if (!isAdmin) return;
                
                if (withdrawalsTableContainer.style.display === 'none') {
                    loadWithdrawalsTable();
                    withdrawalsTableContainer.style.display = 'block';
                } else {
                    withdrawalsTableContainer.style.display = 'none';
                }
            });

            createTaskBtn.addEventListener('click', () => {
                if (!isAdmin) return;
                
                if (createTaskForm.style.display === 'none') {
                    createTaskForm.style.display = 'block';
                } else {
                    createTaskForm.style.display = 'none';
                }
            });

            submitTaskBtn.addEventListener('click', async () => {
                if (!isAdmin) return;
                
                const title = document.getElementById('taskTitle').value.trim();
                const description = document.getElementById('taskDescription').value.trim();
                const reward = parseFloat(document.getElementById('taskReward').value);
                const maxParticipants = parseInt(document.getElementById('taskMaxParticipants').value);
                const duration = parseInt(document.getElementById('taskDuration').value);
                
                if (!title || !description || isNaN(reward) || isNaN(maxParticipants) || isNaN(duration)) {
                    showStatus('Please fill all fields with valid values.', 'error');
                    return;
                }
                
                if (reward <= 0) {
                    showStatus('Reward must be greater than 0.', 'error');
                    return;
                }
                
                try {
                    const task = {
                        id: Date.now().toString(),
                        title: title,
                        description: description,
                        reward: reward,
                        maxParticipants: maxParticipants,
                        currentParticipants: 0,
                        duration: duration, // hours
                        createdAt: new Date().toISOString(),
                        participants: [],
                        status: 'active'
                    };
                    
                    if (!globalData.tasks) globalData.tasks = [];
                    globalData.tasks.push(task);
                    
                    await saveGlobalData();
                    loadTasks();
                    
                    document.getElementById('taskTitle').value = '';
                    document.getElementById('taskDescription').value = '';
                    document.getElementById('taskReward').value = '0.004';
                    document.getElementById('taskMaxParticipants').value = '100';
                    document.getElementById('taskDuration').value = '48';
                    
                    createTaskForm.style.display = 'none';
                    
                    showStatus('Task created successfully!', 'success');
                } catch (error) {
                    console.error('Error creating task:', error);
                    showStatus('Failed to create task.', 'error');
                }
            });

            cancelTaskBtn.addEventListener('click', () => {
                createTaskForm.style.display = 'none';
            });

            // √áekim taleplerini y√ºkle
            function loadWithdrawalsTable() {
                if (!globalData.withdrawals || !isAdmin) return;
                
                withdrawalsTableBody.innerHTML = '';
                
                globalData.withdrawals.forEach((withdrawal, index) => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${withdrawal.userId}</td>
                        <td>${withdrawal.username}</td>
                        <td>${withdrawal.amount.toFixed(3)} TON</td>
                        <td>${withdrawal.address}</td>
                        <td><span class="withdrawal-status status-${withdrawal.status}">${withdrawal.status}</span></td>
                        <td>
                            ${withdrawal.status === 'pending' ? 
                                `<button class="admin-btn" onclick="approveWithdrawal(${index})">${translations[currentLanguage].approve}</button>
                                 <button class="admin-btn danger" onclick="rejectWithdrawal(${index})">${translations[currentLanguage].reject}</button>` : 
                                ''}
                        </td>
                    `;
                    
                    withdrawalsTableBody.appendChild(row);
                });
            }

            // √áekim talebini onayla (global fonksiyon)
            window.approveWithdrawal = async function(index) {
                if (!isAdmin) return;
                
                try {
                    globalData.withdrawals[index].status = 'completed';
                    await saveGlobalData();
                    loadWithdrawalsTable();
                    showStatus('Withdrawal approved.', 'success');
                } catch (error) {
                    console.error('Error approving withdrawal:', error);
                    showStatus('Failed to approve withdrawal.', 'error');
                }
            };

            // √áekim talebini reddet (global fonksiyon)
            window.rejectWithdrawal = async function(index) {
                if (!isAdmin) return;
                
                try {
                    globalData.withdrawals[index].status = 'failed';
                    
                    // Bakiyeyi kullanƒ±cƒ±ya iade et
                    const withdrawal = globalData.withdrawals[index];
                    if (globalData.users[withdrawal.userId]) {
                        globalData.users[withdrawal.userId].balance += withdrawal.amount;
                    }
                    
                    await saveGlobalData();
                    loadWithdrawalsTable();
                    showStatus('Withdrawal rejected.', 'success');
                } catch (error) {
                    console.error('Error rejecting withdrawal:', error);
                    showStatus('Failed to reject withdrawal.', 'error');
                }
            };

            // G√∂revleri y√ºkle
            function loadTasks() {
                if (!globalData.tasks || !userData) return;
                
                tasksContainer.innerHTML = '';
                
                const now = new Date();
                const activeTasks = globalData.tasks.filter(task => {
                    if (task.status !== 'active') return false;
                    
                    const createdAt = new Date(task.createdAt);
                    const expiryTime = new Date(createdAt.getTime() + task.duration * 60 * 60 * 1000);
                    
                    // S√ºresi dolmu≈ü g√∂revleri kapat
                    if (now > expiryTime) {
                        task.status = 'expired';
                        return false;
                    }
                    
                    // Kotasƒ± dolmu≈ü g√∂revleri kapat
                    if (task.currentParticipants >= task.maxParticipants) {
                        task.status = 'completed';
                        return false;
                    }
                    
                    return true;
                });
                
                if (activeTasks.length === 0) {
                    tasksContainer.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">No active tasks available.</p>';
                    return;
                }
                
                activeTasks.forEach(task => {
                    const taskCard = document.createElement('div');
                    taskCard.className = 'task-card';
                    
                    const createdAt = new Date(task.createdAt);
                    const expiryTime = new Date(createdAt.getTime() + task.duration * 60 * 60 * 1000);
                    const timeLeft = Math.max(0, expiryTime - now);
                    const hoursLeft = Math.floor(timeLeft / (60 * 60 * 1000));
                    const minutesLeft = Math.floor((timeLeft % (60 * 60 * 1000)) / (60 * 1000));
                    
                    const progressPercent = (task.currentParticipants / task.maxParticipants) * 100;
                    
                    const hasParticipated = userData.completedTasks && userData.completedTasks.includes(task.id);
                    
                    taskCard.innerHTML = `
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                            <div class="task-reward">+${task.reward.toFixed(3)} TON</div>
                        </div>
                        <div class="task-description">${task.description}</div>
                        <div class="task-progress">
                            <div class="task-progress-bar">
                                <div class="task-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div>${task.currentParticipants}/${task.maxParticipants}</div>
                        </div>
                        <div class="task-expiry">Time left: ${hoursLeft}h ${minutesLeft}m</div>
                        <button class="task-button" ${hasParticipated ? 'disabled' : ''} 
                                onclick="completeTask('${task.id}')">
                            ${hasParticipated ? 'Completed' : 'Start Task'}
                        </button>
                    `;
                    
                    tasksContainer.appendChild(taskCard);
                });
            }

            // G√∂revi tamamla (global fonksiyon)
            window.completeTask = async function(taskId) {
                if (!userData) return;
                
                try {
                    const task = globalData.tasks.find(t => t.id === taskId);
                    if (!task || task.status !== 'active') {
                        showStatus('Task not available.', 'error');
                        return;
                    }
                    
                    // Kullanƒ±cƒ± zaten bu g√∂revi tamamlamƒ±≈ü mƒ±?
                    if (userData.completedTasks && userData.completedTasks.includes(taskId)) {
                        showStatus('You have already completed this task.', 'error');
                        return;
                    }
                    
                    // G√∂rev kotasƒ± dolmu≈ü mu?
                    if (task.currentParticipants >= task.maxParticipants) {
                        task.status = 'completed';
                        await saveGlobalData();
                        showStatus('This task is no longer available.', 'error');
                        loadTasks();
                        return;
                    }
                    
                    // G√∂revi tamamla
                    userData.balance += task.reward;
                    task.currentParticipants += 1;
                    
                    if (!userData.completedTasks) userData.completedTasks = [];
                    userData.completedTasks.push(taskId);
                    
                    if (!task.participants) task.participants = [];
                    task.participants.push({
                        userId: tg.initDataUnsafe.user?.id,
                        username: tg.initDataUnsafe.user?.username || 'Unknown',
                        completedAt: new Date().toISOString()
                    });
                    
                    // Kotasƒ± doldu mu?
                    if (task.currentParticipants >= task.maxParticipants) {
                        task.status = 'completed';
                    }
                    
                    await saveGlobalData();
                    updateUI();
                    loadTasks();
                    
                    showStatus(`Task completed! You earned ${task.reward.toFixed(3)} TON.`, 'success');
                } catch (error) {
                    console.error('Error completing task:', error);
                    showStatus('Failed to complete task.', 'error');
                }
            };

            // Bakƒ±m modunu g√∂ster
            function showMaintenanceMode() {
                maintenanceMode.style.display = 'flex';
                document.querySelector('.container').style.display = 'none';
                document.querySelector('.footer-nav').style.display = 'none';
            }

            // Bakƒ±m modunu gizle
            function hideMaintenanceMode() {
                maintenanceMode.style.display = 'none';
                document.querySelector('.container').style.display = 'block';
                document.querySelector('.footer-nav').style.display = 'flex';
            }

            // --- App Initialization ---
            async function initApp() {
                // Telegram Web App'ƒ± geni≈ület
                tg.expand();
                
                // Dil ayarƒ±nƒ± y√ºkle
                const savedLanguage = localStorage.getItem('userLanguage');
                if (savedLanguage && translations[savedLanguage]) {
                    setLanguage(savedLanguage);
                } else {
                    // Varsayƒ±lan dil se√ßimi modalƒ±nƒ± g√∂ster
                    languageModal.style.display = 'flex';
                }
                
                // TON fiyatƒ±nƒ± g√ºncelle
                updateTONPrice();
                setInterval(updateTONPrice, 60000); // Her dakika g√ºncelle
                
                // Kullanƒ±cƒ± verilerini y√ºkle
                await loadUserData();
            }

            // Uygulamayƒ± ba≈ülat
            initApp();
        });
    </script>
</body>
</html>
