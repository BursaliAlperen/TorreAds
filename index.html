<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TorreAds - TON Ödül Kazan</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; background: #f0f0f0; }
  #balance-display { font-size: 2em; margin-bottom: 20px; }
  #watch-ad-button { padding: 15px 30px; font-size: 18px; cursor: pointer; }
  .toast-visible { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #4caf50; color: white; padding: 10px 20px; border-radius: 5px; opacity: 1; transition: opacity 0.5s; }
  .toast-hidden { opacity: 0; }
</style>
</head>
    <script src='//libtl.com/sdk.js' data-zone='9441902' data-sdk='show_9441902'></script>
<body>

  <h1>TorreAds - TON Ödül Kazan</h1>
  <div>Mevcut Bakiyeniz:</div>
  <div id="balance-display">0.0000 TON</div>

  <button id="watch-ad-button">Reklam İzle & 0.0001 TON Kazan</button>

  <div id="toast" class="toast-hidden"></div>

  <!-- Reklam SDK -->
  <script src="//libtl.com/sdk.js" data-zone="9441902" data-sdk="show_9441902"></script>

  <script>
    const watchAdButton = document.getElementById("watch-ad-button");
    const balanceDisplay = document.getElementById("balance-display");
    const toast = document.getElementById("toast");

    // Kullanıcı id simülasyonu
    const uid = localStorage.getItem("uid") || (function(){
      const id = Math.random().toString(36).substring(2,15);
      localStorage.setItem("uid", id);
      return id;
    })();

    // Bakiye güncelleme fonksiyonu
    async function fetchBalance() {
      try {
        const res = await fetch(`/api/bakiye/${uid}`);
        if(!res.ok) throw new Error("Bakiye alınamadı");
        const data = await res.json();
        balanceDisplay.textContent = data.bakiye.toFixed(4) + " TON";
      } catch(e) {
        console.error(e);
      }
    }

    // Ödül ekleme fonksiyonu
    async function rewardUser(amount) {
      try {
        const res = await fetch("/api/odul", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ uid: uid, miktar: amount }),
        });
        if(!res.ok) throw new Error("Ödül verilemedi");
        const data = await res.json();
        balanceDisplay.textContent = data.yeni_bakiye.toFixed(4) + " TON";
        showToast("Tebrikler! 0.0001 TON hesabınıza eklendi.");
      } catch(e) {
        console.error(e);
        showToast("Ödül eklenirken hata oluştu.", true);
      }
    }

    function showToast(message, error = false) {
      toast.textContent = message;
      toast.style.backgroundColor = error ? "#e53935" : "#4caf50";
      toast.classList.remove("toast-hidden");
      toast.classList.add("toast-visible");
      setTimeout(() => {
        toast.classList.remove("toast-visible");
        toast.classList.add("toast-hidden");
      }, 3000);
    }

    watchAdButton.addEventListener("click", async () => {
      watchAdButton.disabled = true;

      try {
        // Reklamı göster
        await show_9441902('pop');

        // 18 saniyelik sayaç
        let counter = 18;
        watchAdButton.textContent = `Lütfen bekleyin... ${counter}s`;

        const interval = setInterval(() => {
          counter--;
          if (counter <= 0) {
            clearInterval(interval);
            watchAdButton.textContent = "Reklam İzle & 0.0001 TON Kazan";
            watchAdButton.disabled = false;
            rewardUser(0.0001);
          } else {
            watchAdButton.textContent = `Lütfen bekleyin... ${counter}s`;
          }
        }, 1000);
      } catch(e) {
        showToast("Reklam gösterilirken hata veya iptal edildi.", true);
        watchAdButton.textContent = "Reklam İzle & 0.0001 TON Kazan";
        watchAdButton.disabled = false;
      }
    });

    // Sayfa açıldığında bakiye çek
    fetchBalance();
  </script>

</body>
</html>
