<!DOCTYPE html>
<html lang="tr">  
<head>  
    <script src='//libtl.com/sdk.js' data-zone='9441902' data-sdk='show_9441902'></script>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Reklam Ä°zle - Ã–dÃ¼l Kazan</title>  
    <style>  
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');  
        body {  
            font-family: 'Roboto', sans-serif;  
            background-color: #f0f2f5;  
            color: #333;  
            margin: 0;  
            padding: 0;  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            height: 100vh;  
            text-align: center;  
        }  
        .container {  
            background-color: white;  
            padding: 2rem 1.5rem;  
            border-radius: 12px;  
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);  
            max-width: 90%;  
            width: 400px;  
            position: relative;  
        }  
        .balance {  
            background-color: #e8f0fe;  
            color: #1a73e8;  
            padding: 0.75rem;  
            border-radius: 8px;  
            margin-bottom: 1.5rem;  
            font-weight: 700;  
            font-size: 1.1rem;  
        }  
        h1 {  
            color: #1a73e8;  
            margin-bottom: 0.5rem;  
        }  
        p {  
            font-size: 1.1rem;  
            color: #5f6368;  
            margin-bottom: 2rem;  
        }  
        .reward-info {  
            font-size: 0.95rem;  
            color: #5f6368;  
            margin-top: -1.5rem;  
            margin-bottom: 2rem;  
            line-height: 1.4;  
        }  
        .watch-button {  
            display: inline-block;  
            background-color: #1a73e8;  
            color: white;  
            padding: 1rem 2rem;  
            border-radius: 8px;  
            text-decoration: none;  
            font-size: 1.2rem;  
            font-weight: 700;  
            transition: background-color 0.3s, transform 0.2s;  
            cursor: pointer;  
            border: none;  
            width: 100%;  
        }  
        .watch-button:hover:not(:disabled) {  
            background-color: #1558b8;  
            transform: translateY(-2px);  
        }  
        .watch-button:disabled {  
            background-color: #a0c3f0;  
            cursor: not-allowed;  
        }  
        .message-box {  
            margin-top: 1.5rem;  
            padding: 1rem;  
            border-radius: 8px;  
            font-weight: 500;  
            display: none;  
            text-align: center;  
            border: 1px solid transparent;  
        }  
        .message-box.success {  
            background-color: #d4edda;  
            color: #155724;  
            border-color: #c3e6cb;  
        }  
        .message-box.error {  
            background-color: #f8d7da;  
            color: #721c24;  
            border-color: #f5c6cb;  
        }  
    </style>  
</head>  
<body>  
    <div class="container">  
        <div class="balance">Bakiyeniz: <span id="balance-amount">0.0000</span> TON</div>  
        <h1>Reklam Ä°zle, Ã–dÃ¼l Kazan!</h1>  
        <p>Ã–dÃ¼l kazanmak iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayarak bir reklam izleyin.</p>  
        <p class="reward-info">  
            Reklam baÅŸÄ±na <b>0.0001 TON</b> kazanÄ±n.<br>  
            Ã–deme iÃ§in Telegram'dan <b>@torreads</b> ile iletiÅŸime geÃ§in.<br><br>  
            <span style="color: #d93025; font-weight: bold;">  
                Minimum Ã¶deme tutarÄ±: 0.75 TON.<br>  
                Bu tutarÄ±n altÄ±ndaki bakiyeler Ã¶denmeyecektir.  
            </span>  
        </p>  
        <button id="watch-ad-button" class="watch-button">Reklam Ä°zle</button>  
        <div id="message-box" class="message-box"></div>  
    </div>  

    <!-- Monetag SDK -->  
    <script src='//libtl.com/sdk.js' data-zone='9441902'></script>  

    <script type="module">  
        // Flask backend API URL, port ve path ihtiyacÄ±nÄ±za gÃ¶re deÄŸiÅŸtirin
        const API_BASE_URL = 'http://localhost:8000/api';  
        const REWARD_AMOUNT = 0.0001;  

        const balanceElement = document.getElementById('balance-amount');  
        const watchButton = document.getElementById('watch-ad-button');  
        const messageBox = document.getElementById('message-box');  

        // KullanÄ±cÄ± ID'si: Bunu gerÃ§ek uygulamada dinamik yapmalÄ±sÄ±n, ÅŸimdilik localStorage kullanÄ±yoruz
        function getOrSetUserId() {  
            let uid = localStorage.getItem('user_uid');  
            if (!uid) {  
                uid = crypto.randomUUID();  
                localStorage.setItem('user_uid', uid);  
            }  
            return uid;  
        }  
        const uid = getOrSetUserId();

        // Backend'den bakiye Ã§ek
        async function fetchBalance() {  
            try {  
                const res = await fetch(`${API_BASE_URL}/bakiye/${uid}`);  
                if (!res.ok) {  
                    throw new Error('Bakiye alÄ±namadÄ±');  
                }  
                const data = await res.json();  
                if (data.bakiye !== undefined) {  
                    updateBalanceDisplay(data.bakiye);  
                } else {  
                    updateBalanceDisplay(0);  
                }  
            } catch (error) {  
                console.error(error);  
                updateBalanceDisplay(0);  
            }  
        }  

        // Bakiye gÃ¶sterimi gÃ¼ncelle
        function updateBalanceDisplay(amount) {  
            balanceElement.textContent = parseFloat(amount).toFixed(4);  
        }  

        // Ã–dÃ¼l backend'e POST at
        async function claimReward() {  
            try {  
                const response = await fetch(`${API_BASE_URL}/odul`, {  
                    method: 'POST',  
                    headers: { 'Content-Type': 'application/json' },  
                    body: JSON.stringify({ uid: uid, miktar: REWARD_AMOUNT }),  
                });  

                const data = await response.json();  

                if (response.ok && data.success !== false) {  
                    updateBalanceDisplay(data.yeni_bakiye);  
                    showMessage(`BaÅŸarÄ±yla Ã¶dÃ¼l eklendi! Yeni bakiyeniz: ${data.yeni_bakiye.toFixed(4)} TON.`, 'success');  
                } else {  
                    showMessage(data.error || 'Ã–dÃ¼l alÄ±namadÄ±.', 'error');  
                }  
            } catch (error) {  
                console.error('Ã–dÃ¼l isteÄŸi baÅŸarÄ±sÄ±z:', error);  
                showMessage('Sunucuya baÄŸlanÄ±lamadÄ±. LÃ¼tfen daha sonra tekrar deneyin.', 'error');  
            }  
        }  

        function showMessage(text, type) {  
            messageBox.textContent = text;  
            messageBox.className = `message-box ${type}`;  
            messageBox.style.display = 'block';  
        }  

        function hideMessage() {  
            messageBox.style.display = 'none';  
        }  

        // SDK hazÄ±r mÄ± kontrolÃ¼
        function checkSdkReady() {  
            return new Promise((resolve, reject) => {  
                let attempts = 0;  
                const maxAttempts = 10;  
                const intervalTime = 500;  

                const intervalId = setInterval(() => {  
                    if (typeof show_9441902 === 'function') {  
                        clearInterval(intervalId);  
                        resolve();  
                    } else {  
                        attempts++;  
                        if (attempts >= maxAttempts) {  
                            clearInterval(intervalId);  
                            reject(new Error('Reklam altyapÄ±sÄ± yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.'));  
                        }  
                    }  
                }, intervalTime);  
            });  
        }  

        watchButton.addEventListener('click', async () => {  
            watchButton.disabled = true;  
            watchButton.textContent = 'Reklam YÃ¼kleniyor...';  
            hideMessage();  

            try {  
                await checkSdkReady();  
                await show_9441902();  // Reklam gÃ¶ster  
                alert(`ðŸŽ‰ ${REWARD_AMOUNT} TON kazandÄ±nÄ±z!`);  
                await claimReward();  

            } catch (error) {  
                console.error('Reklam sÃ¼reci baÅŸarÄ±sÄ±z:', error);  
                showMessage(error.message || 'Reklam gÃ¶sterilemedi veya erken kapatÄ±ldÄ±.', 'error');  
            } finally {  
                watchButton.disabled = false;  
                watchButton.textContent = 'Yeni Reklam Ä°zle';  
            }  
        });  

        // Sayfa yÃ¼klenince bakiye Ã§ek ve gÃ¶ster
        fetchBalance();  
    </script>  
</body>  
</html>
