<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reklam İzle ve Kazan</title>
<script src='//libtl.com/sdk.js' data-zone='9441902' data-sdk='show_9441902'></script>
</head>
<body style="text-align:center; padding:50px; font-family:sans-serif;">

<h1>🎬 Reklam İzle, Kazan!</h1>
<button id="watchAdBtn" disabled>🎥 Reklam İzleniyor...</button>
<p id="status"></p>

<script>
  // SDK'nın yüklendiğini kontrol eden fonksiyon (promise döner)
  

// Rewarded Popup

show_9441902('pop').then(() => {
    // user watch ad till the end or close it in interstitial format
    // your code to reward user for rewarded format
}).catch(e => {
    // user get error during playing ad
    // do nothing or whatever you want
})
        }
      };
      check();
    });
  }

  const btn = document.getElementById('watchAdBtn');
  const status = document.getElementById('status');

  // Token oluşturma ve localStorage'da saklama
  function getUserToken() {
    let token = localStorage.getItem('userToken');
    if (!token) {
      token = crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2);
      localStorage.setItem('userToken', token);
    }
    return token;
  }

  // Butonu aktif hale getir ve reklam izleme fonksiyonunu ata
  waitForSdkLoaded().then(() => {
    btn.textContent = "🎥 Reklamı İzle";
    btn.disabled = false;
    status.textContent = "Reklam izlemeye hazır.";
  }).catch(e => {
    status.textContent = "❌ Reklam altyapısı yüklenemedi. Sayfayı yenileyin.";
    console.error(e);
  });

  btn.addEventListener('click', () => {
    btn.disabled = true;
    status.textContent = "Reklam yükleniyor...";
    show_9441902().then(() => {
      alert("🎉 0.0001 TON kazandınız!");
      // Ödül kaydı backend'e gönder
      fetch('/api/reward', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          token: getUserToken(),
          timestamp: Date.now()
        })
      }).then(res => res.json())
        .then(data => {
          if (data.status === 'success') {
            status.textContent = `Bakiyeniz: ${data.balance} TON`;
          } else if (data.status === 'limit_reached') {
            status.textContent = "Günlük reklam izleme limitine ulaştınız.";
          } else {
            status.textContent = "Sunucu hatası.";
          }
        }).catch(() => {
          status.textContent = "Sunucuya bağlanılamadı.";
        }).finally(() => {
          btn.disabled = false;
          btn.textContent = "🎥 Reklamı İzle";
        });
    }).catch(() => {
      alert("Reklam gösterilemedi, lütfen tekrar deneyin.");
      status.textContent = "Reklam yüklenemedi.";
      btn.disabled = false;
      btn.textContent = "🎥 Reklamı İzle";
    });
  });
</script>
</body>
</html></html>
